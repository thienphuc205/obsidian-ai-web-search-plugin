/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var R=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var Q=(M,h)=>{for(var e in h)R(M,e,{get:h[e],enumerable:!0})},J=(M,h,e,n)=>{if(h&&typeof h=="object"||typeof h=="function")for(let t of G(h))!j.call(M,t)&&t!==e&&R(M,t,{get:()=>h[t],enumerable:!(n=Y(h,t))||n.enumerable});return M};var X=M=>J(R({},"__esModule",{value:!0}),M);var ee={};Q(ee,{GeminiChatView:()=>I,default:()=>_});module.exports=X(ee);var g=require("obsidian"),w=class{constructor(){this.debugMode=!0}static getInstance(){return w.instance||(w.instance=new w),w.instance}debug(h,e){this.debugMode&&console.log(`[AI Web Search Debug] ${h}`,e||"")}info(h,e){console.log(`[AI Web Search Info] ${h}`,e||"")}warn(h,e){console.warn(`[AI Web Search Warning] ${h}`,e||"")}error(h,e){console.error(`[AI Web Search Error] ${h}`,e||"")}},S=class{constructor(){this.metrics=new Map}static getInstance(){return S.instance||(S.instance=new S),S.instance}startTimer(h){this.metrics.set(h,Date.now())}endTimer(h){let e=this.metrics.get(h);if(!e)return 0;let n=Date.now()-e;return this.metrics.delete(h),w.getInstance().debug(`Performance: ${h} took ${n}ms`),n}logMetrics(h,e,n){w.getInstance().info(`Performance Metric: ${h}`,{duration:`${e}ms`,timestamp:new Date().toISOString(),...n})}},P=class{static validateApiKey(h){return typeof h=="string"&&h.length>0&&h.trim().length>0}static validateUrl(h){try{return new URL(h),!0}catch(e){return!1}}static validateYouTubeUrl(h){return this.validateUrl(h)?/^https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)/.test(h):!1}static validateQuery(h){return typeof h=="string"&&h.trim().length>0&&h.length<=1e4}static validateResearchMode(h){return["quick","comprehensive","deep","reasoning","youtube"].includes(h)}static validateProvider(h){return["gemini","perplexity","tavily","exa"].includes(h)}static sanitizeInput(h){return h.trim().replace(/[<>]/g,"")}},Z={provider:"gemini",geminiApiKey:"",perplexityApiKey:"",tavilyApiKey:"",exaApiKey:"",insertMode:"replace",maxResults:5,includeImages:!1,chatFolderName:"AI Web Search Chats",chatNoteTemplate:"timestamp-query",chatSaveEnabled:!0,geminiModel:"gemini-2.5-flash",geminiTemperature:.7,geminiTopP:.8,geminiTopK:40,geminiMaxOutputTokens:2e3,geminiHarassmentFilter:"BLOCK_MEDIUM_AND_ABOVE",geminiHateSpeechFilter:"BLOCK_MEDIUM_AND_ABOVE",geminiSexuallyExplicitFilter:"BLOCK_MEDIUM_AND_ABOVE",geminiDangerousContentFilter:"BLOCK_MEDIUM_AND_ABOVE",perplexityModel:"sonar-pro",perplexityTemperature:.5,perplexityMaxTokens:1500,perplexityTopP:.8,perplexityTopK:30,perplexityFrequencyPenalty:0,perplexityPresencePenalty:0,perplexityReturnCitations:!0,perplexityReturnImages:!1,perplexityReturnRelated:!1,perplexitySearchDomainFilter:"",tavilySearchDepth:"basic",tavilyMaxResults:5,tavilyIncludeDomains:"",tavilyExcludeDomains:"",tavilyIncludeAnswer:!0,tavilyIncludeRawContent:!1,tavilyIncludeImages:!1,tavilyTopic:"",tavilyDays:7,exaSearchType:"auto",exaUseAutoprompt:!1,exaCategory:"",exaNumResults:10,exaIncludeDomains:"",exaExcludeDomains:"",exaStartCrawlDate:"",exaEndCrawlDate:"",exaStartPublishedDate:"",exaEndPublishedDate:"",exaIncludeText:!0,exaIncludeHighlights:!0,researchModeConfigs:{quick:{geminiModel:"gemini-2.5-flash-lite",perplexityModel:"sonar",geminiParams:{temperature:.5,topP:.7,topK:20,maxOutputTokens:1e3,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"},perplexityParams:{temperature:.4,max_tokens:800,top_p:.7,stream:!1,search_domain_filter:[],search_recency_filter:"day",return_related_questions:!1,return_citations:!0,return_images:!1}},comprehensive:{geminiModel:"gemini-2.5-flash",perplexityModel:"sonar-pro",geminiParams:{temperature:.7,topP:.8,topK:40,maxOutputTokens:2e3,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"},perplexityParams:{temperature:.6,max_tokens:2e3,top_p:.8,stream:!1,search_domain_filter:[],search_recency_filter:"week",return_related_questions:!0,return_citations:!0,return_images:!0}},deep:{geminiModel:"gemini-2.5-pro",perplexityModel:"sonar-deep-research",geminiParams:{temperature:.8,topP:.9,topK:60,maxOutputTokens:4e3,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"},perplexityParams:{temperature:.7,max_tokens:4e3,top_p:.9,stream:!1,search_domain_filter:[],search_recency_filter:"month",return_related_questions:!0,return_citations:!0,return_images:!0}},reasoning:{geminiModel:"gemini-2.5-pro",perplexityModel:"sonar-reasoning",geminiParams:{temperature:.3,topP:.6,topK:20,maxOutputTokens:3e3,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"},perplexityParams:{temperature:.2,max_tokens:3e3,top_p:.6,stream:!1,search_domain_filter:[],search_recency_filter:"month",return_related_questions:!1,return_citations:!0,return_images:!1}},youtube:{geminiModel:"gemini-2.5-pro",geminiParams:{temperature:.3,topP:.8,topK:40,maxOutputTokens:2048,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"}}},tavilyParams:{query:"",search_depth:"basic",include_answer:!0,include_images:!1,include_raw_content:!1,max_results:5,include_domains:[],exclude_domains:[],auto_parameters:{topic:"general",search_depth:"basic"},days:null,api_format:"json"},exaParams:{query:"",type:"auto",category:"",numResults:10,includeDomains:[],excludeDomains:[],startCrawlDate:"",endCrawlDate:"",startPublishedDate:"",endPublishedDate:"",includeText:[],excludeText:[],getText:!0,getHighlights:!0,getSummary:!0,userLocation:"US"},enableCustomPrompts:!1,quickPrompt:`### \u26A1 Quick Research Framework for Obsidian

You are an expert researcher providing rapid, actionable insights optimized for Obsidian knowledge management.

**Query:** "{query}"

## \u{1F3AF} Key Findings
- **Finding 1**: [Concise insight with evidence] [^1]
- **Finding 2**: [Supporting data or trend] [^2]
- **Finding 3**: [Practical application] [^3]

## \u{1F4DA} Essential Context
**Background**: Brief context explaining why this matters [^4]

**Current Status**: What's happening now in this space [^5]

## \u{1F517} Knowledge Connections
*For your Obsidian vault:*
- Consider linking to: [[Research Methods]], [[Data Analysis]], [[{query}]]
- Related concepts: #quick-research #data #analysis
- External resource: [Primary Source](https://example.com) - Why this matters

## \u{1F4D6} References
[^1]: Author, "Title," *Publication*, Date. Available: URL
[^2]: Organization, "Report Title," Date. Link: URL
[^3]: Expert Name, "Analysis," *Journal*, Date. URL: URL
[^4]: Institution, "Background Study," Date. Source: URL
[^5]: Recent Study, "Current Trends," Date. Available: URL

**Standards**: 250-350 words, 5+ authoritative sources, Obsidian-optimized formatting`,comprehensivePrompt:`### \u{1F50D} Comprehensive Research Analysis for Obsidian Knowledge Management

You are a senior researcher conducting systematic analysis with full documentation for professional knowledge management.

**Research Topic:** "{query}"

## \u{1F4CB} Executive Summary
[2-3 sentence overview highlighting key themes, significance, and main conclusions] [^1][^2]

## \uFFFD Detailed Analysis

### Core Concepts & Definitions
- **Primary Concept**: Definition, significance, and applications [^3]
- **Secondary Concept**: Supporting framework and methodology [^4]
- **Key Metrics**: Quantitative measures and benchmarks [^5]

### Current Landscape Analysis
**Market/Field Overview**: Present state, major players, trends [^6][^7]

**Recent Developments**: Latest changes, innovations, disruptions [^8][^9]

**Challenges & Opportunities**: Current obstacles and emerging possibilities [^10]

### Multi-Perspective Examination
#### Academic Perspective
Research findings, peer-reviewed insights, theoretical frameworks [^11][^12]

#### Industry Application
Real-world implementations, case studies, best practices [^13][^14]

#### Critical Analysis
Limitations, controversies, knowledge gaps, bias considerations [^15][^16]

## \u{1F310} External Resources & Further Reading
- [Primary Research Database](https://example.com) - Comprehensive academic sources
- [Industry Analysis Portal](https://example.com) - Current market data and trends
- [Expert Commentary Hub](https://example.com) - Professional insights and opinions
- [Technical Documentation](https://example.com) - Implementation guides and standards

## \u{1F517} Obsidian Vault Integration
**Suggested Note Creation:**
- [[{query} - Overview]] - Main topic summary
- [[{query} - Analysis]] - Detailed findings
- [[{query} - Sources]] - Reference compilation
- [[Research Methodology]] - Link to analysis methods

**Recommended Tags:** #comprehensive-research #analysis #{topic-specific} #academic #industry

**Cross-References:** [[Research Framework]], [[Data Sources]], [[Analysis Methods]]

## \u{1F4DA} Complete Source Documentation
[^1]: Lead Author et al., "Primary Study Title," *Journal Name*, Vol. X(Y), pp. Pages, Year. DOI: doi Available: URL
[^2]: Organization Name, "Report Title," *Publication Series*, Date. Retrieved from: URL
[^3]: Expert Author, "Definitional Framework," *Academic Press*, Year, pp. Pages. ISBN: isbn
[^4]: Research Team, "Supporting Analysis," *Conference Proceedings*, Location, Date. Link: URL
[^5]: Data Institution, "Metrics Report," *Statistical Series*, Year. Dataset: URL
[^6]: Market Analyst, "Industry Overview," *Business Journal*, Date. Available: URL
[^7]: Think Tank, "Sector Analysis," *Policy Report*, Year. Source: URL
[^8]: News Source, "Recent Development," *Publication*, Date. Article: URL
[^9]: Innovation Hub, "Trend Analysis," *Tech Report*, Date. Link: URL
[^10]: Strategy Firm, "Opportunity Assessment," *Consulting Report*, Year. URL: URL
[^11]: Academic Institution, "Research Findings," *University Press*, Year. Study: URL
[^12]: Scholar Name, "Theoretical Framework," *Academic Journal*, Vol(Issue), Year. DOI: URL
[^13]: Company/Org, "Case Study," *Implementation Report*, Date. Reference: URL
[^14]: Industry Expert, "Best Practices Guide," *Professional Publication*, Year. Guide: URL
[^15]: Critical Analyst, "Limitation Study," *Review Journal*, Vol(Issue), Year. Analysis: URL
[^16]: Independent Researcher, "Bias Assessment," *Methodology Journal*, Date. Paper: URL

**Quality Standards:** 600-800 words, 16+ high-quality citations, full Obsidian integration, professional-grade analysis`,deepPrompt:`### \u{1F3AF} Deep Research Investigation for Advanced Knowledge Systems

You are a leading domain expert conducting comprehensive multi-dimensional analysis for research-grade documentation.

**Research Question:** "{query}"

## \u{1F3AF} Research Framework
**Scope**: Comprehensive interdisciplinary investigation
**Methodology**: Systematic evidence synthesis across multiple domains
**Output Standard**: Research-grade documentation with complete source verification

## \u{1F4DA} Foundational Analysis

### Historical Development & Context
**Evolution Timeline**: Key developments, paradigm shifts, milestone events [^1][^2][^3]

**Foundational Theories**: Core theoretical frameworks and their originators [^4][^5]

**Paradigm Changes**: Major shifts in understanding or approach [^6][^7]

### Theoretical Framework Deep Dive
#### Primary Theoretical Approach
- **Core Principles**: Fundamental assumptions and logical structure [^8][^9]
- **Key Contributors**: Major theorists and their specific contributions [^10][^11]
- **Applications**: Real-world implementations and use cases [^12][^13]

#### Alternative Theoretical Perspectives
- **Competing Framework A**: Different approach, strengths, limitations [^14][^15]
- **Competing Framework B**: Third perspective, synthesis opportunities [^16][^17]
- **Integration Analysis**: How different theories complement or conflict [^18][^19]

## \u{1F52C} Multi-Dimensional Evidence Analysis

### Dimension 1: Empirical Research Evidence
**Methodology Review**: Research designs, sample sizes, statistical power [^20][^21]
- Finding A: [Specific result with confidence intervals/effect sizes] [^22]
- Finding B: [Replication studies and meta-analysis results] [^23]
- Finding C: [Longitudinal data and trend analysis] [^24]

### Dimension 2: Professional Practice Integration
**Implementation Studies**: Real-world effectiveness, scalability, constraints [^25][^26]
- Case Study A: [Successful implementation with metrics] [^27]
- Case Study B: [Failed implementation with lessons learned] [^28]
- Best Practice Synthesis: [Evidence-based recommendations] [^29][^30]

### Dimension 3: Cross-Disciplinary Connections
**Field Integration Analysis**: How this topic connects across disciplines [^31][^32]
- **Connection to [[Field A]]**: Shared concepts, methodologies, applications [^33]
- **Connection to [[Field B]]**: Collaborative opportunities, knowledge transfer [^34]
- **Emerging Interdisciplinary Approaches**: New synthesis areas [^35][^36]

### Dimension 4: Future Trajectory Analysis
**Trend Identification**: Statistical analysis of development patterns [^37][^38]
- **Short-term (1-2 years)**: Predictable developments, ongoing projects [^39]
- **Medium-term (3-5 years)**: Probable innovations, market evolution [^40]
- **Long-term (5+ years)**: Potential paradigm shifts, disruptive possibilities [^41]

## \u2696\uFE0F Critical Evaluation & Synthesis

### Strengths & Robust Evidence
**High-Confidence Findings**: Well-supported conclusions with strong evidence [^42][^43]

**Methodological Strengths**: Rigorous research designs, large samples [^44][^45]

### Limitations & Knowledge Gaps
**Identified Weaknesses**: Methodological limitations, sample constraints [^46][^47]

**Research Gaps**: Areas needing investigation, unanswered questions [^48][^49]

### Controversy & Debate Analysis
**Major Debates**: Unresolved questions, competing evidence [^50][^51]

**Bias Assessment**: Potential conflicts of interest, funding influences [^52][^53]

## \u{1F310} Comprehensive Resource Ecosystem

### Primary Research Sources
- [Leading Research Institution Database](https://example.com) - Peer-reviewed studies and data
- [Government Research Portal](https://example.com) - Official statistics and policy research
- [International Organization Hub](https://example.com) - Global standards and comparative studies

### Secondary Analysis Sources
- [Expert Analysis Platform](https://example.com) - Professional commentary and interpretation
- [Industry Intelligence Service](https://example.com) - Market analysis and trend reporting
- [Academic Review Consortium](https://example.com) - Systematic reviews and meta-analyses

### Specialized Databases & Tools
- [Specialized Database A](https://example.com) - Domain-specific research repository
- [Analytical Tool B](https://example.com) - Data analysis and visualization platform
- [Professional Network C](https://example.com) - Expert community and collaboration space

## \u{1F517} Advanced Knowledge Graph Integration

### Core Note Architecture
**Primary Notes to Create:**
- [[{query} - Deep Analysis]] - Main research compilation
- [[{query} - Theoretical Framework]] - Conceptual foundations
- [[{query} - Evidence Base]] - Empirical findings summary
- [[{query} - Methodology Review]] - Research methods analysis
- [[{query} - Future Research]] - Gaps and opportunities
- [[{query} - Implementation Guide]] - Practical applications

### Cross-Reference Network
**Foundational Connections:**
- [[Research Methodology]] - Link to methods discussion
- [[Statistical Analysis]] - Connect to analytical approaches
- [[Literature Review]] - Reference review techniques
- [[Critical Thinking]] - Link to evaluation frameworks

**Domain-Specific Links:**
- [[{topic} Theory]] - Theoretical foundations
- [[{topic} Applications]] - Practical implementations
- [[{topic} Research]] - Ongoing investigations

### Tagging Strategy
**Primary Tags:** #deep-research #evidence-based #multi-dimensional #academic
**Domain Tags:** #{field-specific} #{methodology-type} #{application-area}
**Status Tags:** #comprehensive #verified #research-grade

## \u{1F4CA} Research Synthesis & Conclusions

### Primary Conclusions
**High-Confidence Conclusions**: Well-supported findings with quantified certainty [^54][^55]

**Moderate-Confidence Insights**: Probable conclusions with noted limitations [^56][^57]

**Preliminary Findings**: Early indicators requiring further investigation [^58][^59]

### Strategic Implications
**For Researchers**: Priority areas for future investigation [^60]

**For Practitioners**: Evidence-based implementation recommendations [^61]

**For Policymakers**: Regulatory and policy considerations [^62]

### Research Roadmap
**Immediate Priorities**: Critical gaps requiring urgent investigation
**Medium-term Goals**: Systematic research program development
**Long-term Vision**: Transformative research possibilities

---
### Complete Academic Bibliography
[Complete 62 reference citations with DOI and URLs where available]
[^1] through [^62]: [Standard academic citation format with Author, Title, Journal/Publisher, Year, DOI/URL]

**Research Standards:** 1200-1500 words, 62+ peer-reviewed citations, complete methodological documentation, research-grade analysis suitable for academic publication`,reasoningPrompt:`### \u{1F9E0} Advanced Logical Reasoning & Critical Analysis Framework

You are a master logician and critical thinking expert conducting systematic reasoning analysis optimized for Obsidian knowledge systems.

**Reasoning Challenge:** "{query}"

## \u{1F3AF} Logical Framework Definition
**Primary Objective**: Deconstruct arguments, evaluate evidence quality, identify logical fallacies, and synthesize sound conclusions

**Reasoning Standards**: Formal logic principles, evidence hierarchy, bias mitigation, uncertainty quantification

**Output Goal**: Rigorous logical analysis suitable for decision-making and knowledge building

## \u{1F4DA} Premise Deconstruction & Evidence Hierarchy

### Core Premise Identification
**Premise 1**: [Explicit statement]
- *Source Quality*: [Peer-reviewed/Expert opinion/Anecdotal] [^1]
- *Evidence Strength*: [Strong/Moderate/Weak with justification]
- *Logical Role*: [Foundation/Supporting/Contingent]

**Premise 2**: [Supporting statement]
- *Source Quality*: [Academic/Professional/Popular media] [^2]
- *Evidence Strength*: [Quantified confidence level]
- *Logical Role*: [How this supports the argument] [^3]

**Premise 3**: [Additional evidence]
- *Source Quality*: [Primary/Secondary/Tertiary source] [^4]
- *Evidence Strength*: [Statistical significance if applicable]
- *Logical Role*: [Necessary/Sufficient/Contributing condition] [^5]

### Evidence Quality Assessment Matrix
#### Tier 1: High-Quality Evidence
- **Systematic Reviews & Meta-Analyses**: [Citations with effect sizes] [^6][^7]
- **Randomized Controlled Studies**: [Sample sizes, controls, replication] [^8][^9]
- **Peer-Reviewed Research**: [Journal impact factors, citation counts] [^10][^11]

#### Tier 2: Moderate-Quality Evidence
- **Expert Consensus**: [Professional qualifications, agreement level] [^12][^13]
- **Observational Studies**: [Methodology, confounding controls] [^14][^15]
- **Government/Institutional Reports**: [Methodology transparency] [^16][^17]

#### Tier 3: Supporting Evidence
- **Expert Opinion**: [Individual expertise, potential bias] [^18][^19]
- **Case Studies**: [Generalizability limitations] [^20][^21]
- **Preliminary Research**: [Sample limitations, replication needs] [^22][^23]

## \u{1F50D} Cognitive Bias Detection & Mitigation

### Identified Potential Biases
#### Confirmation Bias Assessment
**Evidence**: Tendency to favor information supporting existing beliefs [^24]
- *Detection Methods*: Look for contradictory evidence actively sought [^25]
- *Mitigation Strategy*: Steel-man opposing arguments [^26]
- *Quality Check*: Proportion of disconfirming evidence considered [^27]

#### Anchoring Bias Analysis
**Evidence**: Over-reliance on first information encountered [^28]
- *Detection*: Trace reasoning from initial assumptions [^29]
- *Mitigation*: Consider alternative starting points [^30]
- *Validation*: Test conclusions from different entry points [^31]

#### Availability Heuristic Check
**Evidence**: Overestimate probability of easily recalled events [^32]
- *Detection*: Analyze if vivid examples dominate reasoning [^33]
- *Mitigation*: Seek base rate statistics [^34]
- *Correction*: Weight evidence by actual frequency data [^35]

#### Selection & Sampling Bias
**Evidence**: Non-representative data leading to skewed conclusions [^36]
- *Detection*: Examine data collection methodology [^37]
- *Mitigation*: Seek diverse data sources [^38]
- *Validation*: Cross-reference with population statistics [^39]

### Bias Mitigation Protocols
**Protocol 1**: Systematic Devil's Advocate Analysis [^40]
**Protocol 2**: Red Team Critical Review [^41]
**Protocol 3**: Blind Spot Identification Matrix [^42]

## \u26D3\uFE0F Logical Structure Analysis & Inference Mapping

### Argument Mapping & Logical Flow
#### Primary Logical Chain
**Step 1**: [Premise A] + [Premise B] \u2192 [Intermediate Conclusion X] [^43]
- *Logic Type*: [Deductive/Inductive/Abductive]
- *Validity Check*: [Valid/Invalid with explanation]
- *Soundness Assessment*: [Sound/Unsound with reasoning]

**Step 2**: [Intermediate Conclusion X] + [Premise C] \u2192 [Secondary Conclusion Y] [^44]
- *Logical Operator*: [AND/OR/IF-THEN relationship]
- *Strength Assessment*: [Strong/Moderate/Weak inference]
- *Alternative Explanations*: [List competing interpretations] [^45]

**Step 3**: [Secondary Conclusion Y] + [Additional Evidence] \u2192 [Final Conclusion Z] [^46]
- *Confidence Level*: [Quantified certainty with bounds]
- *Assumptions Required*: [Explicit unstated assumptions]
- *Logical Dependencies*: [What must be true for conclusion to hold] [^47]

#### Alternative Logical Pathways
**Pathway A**: Different evidence combination leading to same conclusion [^48]
**Pathway B**: Same evidence leading to different conclusions [^49]
**Pathway C**: Null hypothesis testing and falsification attempts [^50]

### Formal Logic Application
#### Syllogistic Analysis
- **Major Premise**: [Universal statement] [^51]
- **Minor Premise**: [Specific application] [^52]
- **Conclusion**: [Logical necessity] [^53]
- **Validity Test**: [Form analysis independent of content]

#### Propositional Logic Structure
- **If P then Q**: [Conditional statement analysis] [^54]
- **P or Q**: [Disjunctive reasoning examination] [^55]
- **P and Q**: [Conjunctive logic verification] [^56]
- **Not P**: [Negation and contradiction testing] [^57]

## \u{1F4CA} Uncertainty Quantification & Probability Assessment

### Statistical Confidence Analysis
**Confidence Intervals**: [Range estimates with statistical basis] [^58]
- *Primary Finding*: [Point estimate \xB1 margin of error] [^59]
- *Secondary Finding*: [Probability bounds with assumptions] [^60]
- *Tertiary Finding*: [Conditional probabilities] [^61]

### Sensitivity Analysis Protocol
**Assumption Variation Testing**: How conclusions change with different assumptions [^62]
- *Robust Findings*: [Conclusions stable across assumption changes] [^63]
- *Sensitive Findings*: [Results dependent on specific assumptions] [^64]
- *Critical Dependencies*: [Assumptions that dramatically affect conclusions] [^65]

### Scenario Analysis Framework
**Best Case Scenario**: [Optimistic but realistic assessment] [^66]
**Most Likely Scenario**: [Central tendency with highest probability] [^67]
**Worst Case Scenario**: [Pessimistic but plausible assessment] [^68]
**Black Swan Considerations**: [Low probability, high impact possibilities] [^69]

## \u2696\uFE0F Limitation Acknowledgment & Knowledge Boundaries

### Methodological Constraints
**Data Limitations**: [Sample sizes, time ranges, scope boundaries] [^70]
**Measurement Limitations**: [Precision, accuracy, reliability issues] [^71]
**Analytical Limitations**: [Model assumptions, statistical power] [^72]

### Scope & Generalizability Boundaries
**Population Limits**: [Demographics, geographic, temporal boundaries] [^73]
**Context Constraints**: [Environmental, cultural, institutional factors] [^74]
**Domain Boundaries**: [Where findings apply vs. don't apply] [^75]

### Acknowledged Uncertainties
**Known Unknowns**: [Identified gaps in knowledge/data] [^76]
**Model Limitations**: [Simplifications and assumptions required] [^77]
**Future Contingencies**: [How changing conditions affect conclusions] [^78]

## \u{1F517} Obsidian Knowledge Integration & Decision Framework

### Core Knowledge Architecture
**Central Analysis Note**: [[{query} - Logical Analysis]] - Complete reasoning documentation
**Evidence Base Note**: [[{query} - Evidence Evaluation]] - Source quality assessment
**Bias Assessment Note**: [[{query} - Cognitive Bias Check]] - Bias detection and mitigation
**Logic Structure Note**: [[{query} - Argument Map]] - Formal logical analysis
**Uncertainty Note**: [[{query} - Confidence Assessment]] - Probability and limitations

### Cross-Reference Network
**Methodological Links**:
- [[Critical Thinking Methods]] - Link to reasoning frameworks
- [[Logical Fallacies]] - Connect to error identification
- [[Evidence Evaluation]] - Reference quality assessment
- [[Bias Mitigation]] - Link to objectivity tools
- [[Decision Theory]] - Connect to choice frameworks

**Domain-Specific Connections**:
- [[{topic} Controversies]] - Related debates and disputes
- [[{topic} Evidence Base]] - Field-specific research
- [[{topic} Expert Opinion]] - Professional consensus

### Tagging Strategy
**Method Tags**: #logical-analysis #critical-thinking #evidence-based #bias-checked
**Quality Tags**: #high-confidence #moderate-confidence #preliminary #needs-verification
**Process Tags**: #systematic #peer-reviewed #multi-perspective #uncertainty-quantified

## \u{1F3AF} Synthesis & Actionable Conclusions

### Primary Conclusions (High Confidence)
**Conclusion 1**: [Statement with confidence level 90-95%] [^79]
- *Supporting Evidence*: [Tier 1 sources, replication, expert consensus]
- *Logical Basis*: [Deductive reasoning, validated premises]
- *Practical Implication*: [What this means for decisions/actions]

**Conclusion 2**: [Statement with confidence level 85-90%] [^80]
- *Supporting Evidence*: [Multiple independent confirmations]
- *Logical Basis*: [Strong inductive reasoning]
- *Uncertainty Range*: [Bounds on confidence]

### Secondary Conclusions (Moderate Confidence)
**Provisional Finding**: [Statement with confidence level 70-85%] [^81]
- *Evidence Gaps*: [What additional evidence would increase confidence]
- *Alternative Explanations*: [Competing hypotheses not yet ruled out]
- *Contingencies*: [Conditions under which this may not hold]

### Research & Decision Recommendations
**Immediate Actions**: Evidence-based steps with high confidence [^82]
**Conditional Actions**: Steps dependent on additional verification [^83]
**Future Investigation**: Priority areas for reducing uncertainty [^84]

### Meta-Analysis of Reasoning Process
**Reasoning Quality Assessment**: [Self-evaluation of logical rigor]
**Bias Mitigation Success**: [How well cognitive biases were addressed]
**Uncertainty Management**: [Appropriateness of confidence claims]

---
### Complete Logical Evidence Bibliography
[Complete 84 reference citations with appropriate academic formatting]
[^1] through [^84]: [Standard academic citation format with Author, Title, Journal/Publisher, Year, DOI/URL]

**Reasoning Standards:** 1000-1300 words, 84+ citations supporting complete logical documentation, systematic bias detection, uncertainty quantification, full Obsidian integration, professional-grade logical analysis suitable for critical decision-making`,youtubePrompt:`### \u{1F3AC} Comprehensive YouTube Video Analysis for Professional Knowledge Management

You are a media analysis expert creating research-grade video documentation optimized for Obsidian's knowledge management capabilities.

**Video URL:** {url}

## \u{1F4FA} Video Intelligence Profile

### Essential Metadata
**Title**: [Extract and verify video title] [^1]
**Creator/Channel**: [Channel name, subscriber count, verification status] [^2]
**Publication Date**: [Upload date, recency relevance] [^3]
**Duration**: [Total length, content density analysis] [^4]
**View Metrics**: [View count, engagement rate, trending status] [^5]
**Content Category**: [Educational/Entertainment/News/Tutorial/Review] [^6]

### Content Classification & Quality Assessment
**Content Type**: [Lecture/Discussion/Demonstration/Interview/Documentary] [^7]
**Target Audience**: [Academic/Professional/General public/Specialized] [^8]
**Production Quality**: [Professional/Semi-professional/Amateur with quality indicators] [^9]
**Educational Value**: [High/Medium/Low with justification] [^10]

## \u{1F3AF} Executive Summary & Strategic Overview
**Core Purpose**: [2-3 sentence description of video's main objective and unique value] [^11]

**Key Value Proposition**: [What makes this video worth watching/referencing] [^12]

**Relevance Score**: [High/Medium/Low with context for your research/work] [^13]

## \u{1F4DA} Structured Content Analysis

### Primary Topic Architecture
#### Topic 1: [Main Subject Area]
**Time Range**: [Start-End timestamps] [^14]
- **Core Concepts**: [Key ideas presented with timestamp references] [^15]
- **Supporting Evidence**: [Data, examples, case studies mentioned] [^16]
- **Expert Claims**: [Specific assertions with speaker credentials] [^17]
- **Practical Applications**: [How this applies to real-world scenarios] [^18]

#### Topic 2: [Secondary Focus Area]
**Time Range**: [Start-End timestamps] [^19]
- **Theoretical Framework**: [Conceptual models or theories discussed] [^20]
- **Methodological Approaches**: [Techniques, processes, or systems explained] [^21]
- **Comparative Analysis**: [How this compares to alternatives] [^22]
- **Implementation Considerations**: [Practical constraints and requirements] [^23]

#### Topic 3: [Additional Content Area]
**Time Range**: [Start-End timestamps] [^24]
- **Emerging Trends**: [Future developments or innovations mentioned] [^25]
- **Industry Insights**: [Market perspective or professional viewpoints] [^26]
- **Technical Details**: [Specific procedures, formulas, or specifications] [^27]
- **Success Metrics**: [How effectiveness or progress is measured] [^28]

### Critical Information Extraction
#### Quantitative Data Points
- **Statistic 1**: [Specific number/percentage with context] [^29] *(Timestamp: [MM:SS])*
- **Statistic 2**: [Performance metric or research finding] [^30] *(Timestamp: [MM:SS])*
- **Statistic 3**: [Market data or comparative figures] [^31] *(Timestamp: [MM:SS])*

#### Qualitative Insights
- **Expert Opinion 1**: [Professional judgment or recommendation] [^32] *(Timestamp: [MM:SS])*
- **Case Study**: [Real-world example or success story] [^33] *(Timestamp: [MM:SS])*
- **Best Practice**: [Recommended approach or methodology] [^34] *(Timestamp: [MM:SS])*

### Notable Quotations & Key Statements
> **"[Significant Quote 1]"** - [Speaker Name/Role] [^35] *(Timestamp: [MM:SS])*
> *Context: [Why this quote is important for your knowledge base]*

> **"[Significant Quote 2]"** - [Speaker Name/Role] [^36] *(Timestamp: [MM:SS])*
> *Application: [How this applies to practical work/research]*

> **"[Significant Quote 3]"** - [Speaker Name/Role] [^37] *(Timestamp: [MM:SS])*
> *Implication: [What this means for the field/industry]*

## \u{1F50D} Critical Evaluation & Source Verification

### Speaker Credibility Assessment
**Primary Speaker**: [Name, title, institutional affiliation] [^38]
- **Expertise Level**: [Recognized expert/Practitioner/Thought leader] [^39]
- **Relevant Credentials**: [Degrees, certifications, experience] [^40]
- **Publication Record**: [Books, papers, previous media appearances] [^41]
- **Potential Conflicts**: [Financial interests, organizational bias] [^42]

**Additional Contributors**: [Other speakers or experts featured] [^43]

### Content Verification & Fact-Checking
#### Claims Requiring Verification
- **Claim 1**: [Specific assertion made] [^44]
  - *Verification Status*: [Confirmed/Disputed/Unverified]
  - *Supporting Source*: [Independent verification if available] [^45]
- **Claim 2**: [Statistical or factual statement] [^46]
  - *Source Quality*: [Primary/Secondary/Tertiary data source]
  - *Methodology*: [How data was collected/analyzed] [^47]

#### Bias & Limitation Analysis
**Potential Biases Detected**: [Commercial/Ideological/Selection biases] [^48]
**Methodological Limitations**: [Sample size/Time period/Scope constraints] [^49]
**Perspective Gaps**: [Missing viewpoints or alternative approaches] [^50]

### Educational & Research Value Assessment
**Strengths**:
- [What the video does exceptionally well] [^51]
- [Unique insights or perspectives provided] [^52]
- [Quality of explanation or demonstration] [^53]

**Limitations**:
- [Areas where content could be stronger] [^54]
- [Missing context or important considerations] [^55]
- [Potential oversimplifications] [^56]

## \u{1F310} Extended Research & Verification Resources

### Primary Source Verification
- [Original Research Paper](https://example.com) - Core study referenced in video [^57]
- [Official Documentation](https://example.com) - Authoritative source for claims [^58]
- [Government/Institutional Data](https://example.com) - Statistical verification [^59]

### Expert Perspective & Commentary
- [Expert Analysis Article](https://example.com) - Independent expert view on topic [^60]
- [Professional Industry Report](https://example.com) - Industry context and trends [^61]
- [Academic Review](https://example.com) - Scholarly perspective on subject [^62]

### Additional Learning Resources
- [Comprehensive Course/Tutorial](https://example.com) - Deeper learning on the topic [^63]
- [Technical Documentation](https://example.com) - Implementation guides and details [^64]
- [Community Discussion](https://example.com) - Ongoing conversation and updates [^65]

### Contradictory or Alternative Viewpoints
- [Alternative Perspective](https://example.com) - Different approach or opinion [^66]
- [Critical Analysis](https://example.com) - Challenges or limitations discussed [^67]
- [Debate/Discussion](https://example.com) - Multiple viewpoints presented [^68]

## \u{1F517} Obsidian Knowledge Integration Strategy

### Core Note Architecture for Your Vault
**Primary Analysis Note**: [[{video-topic} - Video Analysis]] - This comprehensive analysis
**Topic Deep Dive**: [[{video-topic} - Core Concepts]] - Extract key concepts for separate development
**Speaker Profile**: [[{speaker-name} - Expert Profile]] - Track this expert's contributions
**Methodology Notes**: [[{method/technique} - Implementation]] - Practical application guidance
**Research Trail**: [[{video-topic} - Source Verification]] - Fact-checking and validation

### Strategic Cross-Referencing
**Conceptual Links**:
- [[Video Analysis Methodology]] - Link to your analysis framework
- [[Expert Opinion Tracking]] - Connect to expert knowledge system
- [[Research Verification]] - Link to fact-checking protocols
- [[Learning Resources]] - Connect to educational content organization

**Topic-Specific Connections**:
- [[{main-topic}]] - Primary subject area
- [[{secondary-topic}]] - Related concepts and ideas
- [[{industry/field}]] - Broader context and applications
- [[{methodology/technique}]] - Specific approaches discussed

**Temporal & Project Links**:
- [[Current Research Projects]] - How this relates to ongoing work
- [[Future Learning Goals]] - What to explore next
- [[Industry Trend Tracking]] - How this fits broader patterns

### Advanced Tagging Strategy
**Content Tags**: #video-analysis #expert-opinion #educational-content #research-source
**Quality Tags**: #high-credibility #verified-claims #comprehensive #well-sourced
**Topic Tags**: #{main-topic} #{industry} #{methodology} #{application-area}
**Status Tags**: #fully-analyzed #partially-verified #requires-follow-up #implementation-ready
**Utility Tags**: #reference-material #teaching-resource #practical-guide #theoretical-framework

### Implementation Roadmap
**Immediate Actions** (Next 24-48 hours):
1. Create linked notes for key concepts identified
2. Verify 2-3 most important claims through independent sources
3. Add to relevant project notes or research areas

**Short-term Development** (Next week):
1. Explore 3-5 additional resources from reference list
2. Connect with related content in your vault
3. Create implementation plan if applicable

**Long-term Integration** (Next month):
1. Track speaker for additional content
2. Monitor topic for new developments
3. Assess impact on related research or projects

## \u{1F4CA} Video Analysis Metrics & Quality Assessment

### Content Quality Scorecard
- **Information Density**: [High/Medium/Low] - Amount of useful information per minute
- **Source Attribution**: [Excellent/Good/Poor] - How well claims are sourced
- **Practical Applicability**: [High/Medium/Low] - Real-world utility of content
- **Educational Structure**: [Excellent/Good/Poor] - Logical flow and clarity
- **Update Frequency**: [Current/Recent/Outdated] - Relevance of information

### Recommendation Score
**Overall Rating**: [Essential/Recommended/Optional/Skip] [^69]
**Best Use Case**: [Research reference/Learning resource/Background info/Entertainment]
**Target Audience Match**: [Perfect fit/Good match/Partial relevance/Poor fit]
**Follow-up Priority**: [High/Medium/Low] - Should you seek more from this source?

---
### Complete Video Documentation Bibliography
[Complete 69 reference citations with timestamps and external verification]
[^1] through [^69]: [Standard academic citation format with Video metadata, timestamps, and external source verification]

**Analysis Standards:** 800-1000 words comprehensive documentation, 69+ citations including timestamps and external verification, complete Obsidian integration with linking strategy, research-grade video analysis suitable for professional knowledge management and academic reference.`,providerSearchModes:{gemini:!0,perplexity:!0,tavily:!0,exa:!0},contextMemoryEnabled:!0,maxContextMessages:10,contextMemoryStrategy:"recent",configurationPresets:{QuickFactCheck:{description:"Fast, concise answers for quick verification.",modeName:"quick",provider:"perplexity",parameters:{temperature:.2,max_tokens:500,search_recency_filter:"day"}},DeepDiveAnalysis:{description:"In-depth academic research for detailed papers.",modeName:"deep",provider:"gemini",parameters:{temperature:.8,topP:.9,maxOutputTokens:4e3}},CreativeBrainstorming:{description:"Generate creative ideas and outlines.",modeName:"comprehensive",provider:"gemini",parameters:{temperature:1.2,topP:.95}}},uiPreferences:{showAdvancedSettings:!1,showParameterTooltips:!0,autoSaveSettings:!0,showPerformanceMetrics:!1,compactMode:!1},researchModeModels:{quick:"gemini-2.5-flash-lite",comprehensive:"gemini-2.5-flash",deep:"gemini-2.5-pro",reasoning:"gemini-2.5-pro",youtube:"gemini-2.5-pro"}},D="gemini-chat-view",_=class extends g.Plugin{getCurrentResearchMode(){var e,n;try{let t=(n=(e=this.app.workspace.getLeavesOfType(D))==null?void 0:e[0])==null?void 0:n.view,s=t==null?void 0:t.currentResearchMode;return s&&P.validateResearchMode(s.id)?s.id:"comprehensive"}catch(t){return w.getInstance().warn("Failed to get current research mode, using default",t),"comprehensive"}}async onload(){let e=w.getInstance(),n=S.getInstance(),t="plugin-load";try{e.info("Plugin loading started"),n.startTimer(t),await this.loadSettings(),this.injectEnhancedCSS(),this.registerView(D,r=>new I(r,this)),this.addRibbonIcon("message-circle","Open AI Web Search Chat",()=>{this.activateView()}),this.addCommand({id:"gemini-web-search-selection",name:"Search Web for Selected Text",editorCallback:async(r,l)=>{let o=r.getSelection();o?await this.searchWeb(o,"replace"):new g.Notice("Please select some text first")}}),this.addCommand({id:"gemini-web-search-append",name:"Search Web for Selected Text (Append)",editorCallback:async(r,l)=>{let o=r.getSelection();o?await this.searchWeb(o,"append"):new g.Notice("Please select some text first")}}),this.addCommand({id:"open-ai-chat",name:"Open AI Web Search Chat",callback:()=>{this.activateView()}}),this.addCommand({id:"gemini-web-search-prompt",name:"AI Web Search: Custom query",editorCallback:(r,l)=>{this.promptForCustomSearch(r)}}),this.addCommand({id:"gemini-new-chat",name:"AI Web Search: Start New Chat",callback:()=>{this.activateView().then(()=>{var l;let r=(l=this.app.workspace.getLeavesOfType(D)[0])==null?void 0:l.view;r&&r.clearChat()})}}),this.addCommand({id:"test-perplexity-api",name:"AI Web Search: Test Perplexity API",callback:async()=>{await this.testPerplexityAPI()}}),this.addRibbonIcon("search","AI Web Search",()=>{this.showSearchModal()}),this.addSettingTab(new B(this.app,this));let s=n.endTimer(t);e.info(`Plugin loaded successfully in ${s}ms`)}catch(s){e.error("Plugin loading failed",s),new g.Notice(`AI Web Search Plugin failed to load: ${s}`)}}async loadSettings(){this.settings=Object.assign({},Z,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}showSearchModal(){new N(this.app,this).open()}async activateView(){let{workspace:e}=this.app,n=null,t=e.getLeavesOfType(D);t.length>0?n=t[0]:(n=e.getRightLeaf(!1),n&&await n.setViewState({type:D,active:!0})),n&&e.revealLeaf(n)}async performWebSearch(e){let n=w.getInstance(),t=S.getInstance(),s=`web-search-${this.settings.provider}-${Date.now()}`;try{if(t.startTimer(s),n.debug("Starting web search",{provider:this.settings.provider,query:P.sanitizeInput(e).substring(0,100)+"..."}),!P.validateQuery(e))throw new Error("Invalid search query provided");if(!P.validateProvider(this.settings.provider))throw new Error(`Invalid provider: ${this.settings.provider}`);let r;switch(this.settings.provider){case"gemini":r=await this.searchWithGemini(e);break;case"perplexity":r=await this.searchWithPerplexity(e);break;case"tavily":r=await this.searchWithTavily(e);break;case"exa":r=await this.searchWithExa(e);break;default:throw new Error(`Invalid provider: ${this.settings.provider}`)}let l=t.endTimer(s);return t.logMetrics("web-search",l,{provider:this.settings.provider,queryLength:e.length,resultLength:r.length}),r}catch(r){t.endTimer(s),n.error("Web search failed",r);let l=r instanceof Error?r.message:String(r);return`Search failed for: "${e}"

Error: ${l}

Please check your API configuration and try again.`}}async performGeminiChat(e,n){var r,l,o,i;if(!this.settings.geminiApiKey)throw new Error("Gemini API key not configured");let t=w.getInstance();t.debug("Starting Gemini chat",{query:e,historyLength:n.length});let s=[];n.forEach(a=>{s.push({role:a.role==="user"?"user":"model",parts:[{text:a.content}]})}),s.push({role:"user",parts:[{text:e}]});try{let c=(await(0,g.requestUrl)({url:`https://generativelanguage.googleapis.com/v1beta/models/${this.settings.geminiModel}:generateContent`,method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":this.settings.geminiApiKey},body:JSON.stringify({contents:s,generationConfig:{temperature:.7,maxOutputTokens:2048,topP:.8,topK:40}})})).json;if(c.candidates&&((i=(o=(l=(r=c.candidates[0])==null?void 0:r.content)==null?void 0:l.parts)==null?void 0:o[0])!=null&&i.text))return c.candidates[0].content.parts[0].text;throw new Error("No valid response from Gemini API")}catch(a){t.error("Gemini chat failed",a);let c=a instanceof Error?a.message:String(a);throw new Error(`Gemini chat failed: ${c}`)}}async performPerplexityChat(e,n){var l,o;if(!this.settings.perplexityApiKey)throw new Error("Perplexity API key not configured");let t=w.getInstance();t.debug("Starting Perplexity chat",{query:e,historyLength:n.length});let s=[];n.forEach(i=>{s.push({role:i.role,content:i.content})}),s.push({role:"user",content:e});let r={model:this.settings.perplexityModel,messages:s,temperature:this.settings.perplexityTemperature,max_tokens:this.settings.perplexityMaxTokens,top_p:this.settings.perplexityTopP,top_k:this.settings.perplexityTopK,frequency_penalty:this.settings.perplexityFrequencyPenalty,presence_penalty:this.settings.perplexityPresencePenalty};try{let a=(await(0,g.requestUrl)({url:"https://api.perplexity.ai/chat/completions",method:"POST",headers:{Authorization:`Bearer ${this.settings.perplexityApiKey}`,"Content-Type":"application/json"},body:JSON.stringify(r)})).json;if(a.choices&&((o=(l=a.choices[0])==null?void 0:l.message)!=null&&o.content))return a.choices[0].message.content;throw new Error("No valid response from Perplexity API")}catch(i){t.error("Perplexity chat failed",i);let a=i instanceof Error?i.message:String(i);throw new Error(`Perplexity chat failed: ${a}`)}}async searchWithGemini(e){var r,l,o;let n=w.getInstance(),t=S.getInstance(),s=`gemini-search-${Date.now()}`;try{if(t.startTimer(s),n.debug("Starting Gemini search",{queryLength:e.length}),!P.validateApiKey(this.settings.geminiApiKey))throw new Error("Gemini API key not configured or invalid");let i=(r=this.app.workspace.getLeavesOfType(D)[0])==null?void 0:r.view,a=i==null?void 0:i.currentResearchMode,c=this.settings.researchModeConfigs.comprehensive.geminiParams;if(a&&P.validateResearchMode(a.id))switch(a.id){case"quick":c=this.settings.researchModeConfigs.quick.geminiParams;break;case"comprehensive":c=this.settings.researchModeConfigs.comprehensive.geminiParams;break;case"deep":c=this.settings.researchModeConfigs.deep.geminiParams;break;case"reasoning":c=this.settings.researchModeConfigs.reasoning.geminiParams;break;case"youtube":c=this.settings.researchModeConfigs.youtube.geminiParams;break}let d=e;if(this.settings.enableCustomPrompts&&a)switch(a.id){case"quick":d=this.settings.quickPrompt.replace("{query}",e);break;case"comprehensive":d=this.settings.comprehensivePrompt.replace("{query}",e);break;case"deep":d=this.settings.deepPrompt.replace("{query}",e);break;case"reasoning":d=this.settings.reasoningPrompt.replace("{query}",e);break;case"youtube":d=`Analyze this YouTube video and provide a comprehensive summary and insights: ${e}`;break;default:d=this.settings.comprehensivePrompt.replace("{query}",e)}else if(a)switch(a.id){case"quick":d=`### Task: Provide Quick and Accurate Response

You are a domain expert with extensive knowledge. Please answer the following question concisely and accurately:

**Question:** "${e}"

**Output Requirements:**
- Provide direct and concise answers (2-3 sentences maximum)
- Focus on the 2-3 most important points
- Use clear, easy-to-understand language
- If uncertain, state "Need more information to provide accurate answer"

**Format:** Direct answer without lengthy explanations.`;break;case"comprehensive":d=`### Framework: Comprehensive Analysis

**Task:** Comprehensive analysis of the topic: "${e}"

**Response Structure:**
1. **Overview** (2-3 introductory sentences)
2. **Key Aspects** (3-4 important dimensions)
3. **Context and Applications** (why this matters)
4. **Concrete Examples** (1-2 illustrative cases)
5. **Conclusions and Future Directions**

**Requirements:** 400-600 words, professional but accessible, cite sources when available.`;break;case"deep":d=`### Framework: Deep Research

**Task:** In-depth research on: "${e}"

**Analysis includes:**
1. **Foundation Analysis** - History, origins, definitions
2. **Current Landscape** - Present state, trends  
3. **Multiple Perspectives** - Views from different fields
4. **Deep Analysis** - Causes, effects, interconnections
5. **Future Implications** - Projected impacts, practical applications
6. **Critical Assessment** - Strengths, limitations, controversies

**Requirements:** 800-1200 words, comprehensive and insightful perspective, clear structure.`;break;case"reasoning":d=`### Framework: Logical Reasoning

**Analysis Task:** "${e}"

**Thinking Process:**
1. **Problem Decomposition** - Identify core components
2. **Multi-dimensional Analysis** - Logic, context, different perspectives
3. **Evidence Evaluation** - Categorize reliability levels
4. **Synthetic Reasoning** - Logic chain and alternative hypotheses
5. **Structured Conclusion** - Conclusion, confidence level, limitations

**Requirements:** Critical thinking, excellent logical analysis, self-check for logical gaps.`;break;case"youtube":d=`### YouTube Video Analysis for Obsidian Knowledge Management

**Video URL:** ${e}

You are a media analysis expert creating comprehensive video documentation for academic and professional knowledge management.

## \u{1F4FA} Video Documentation Framework

### Basic Information
**Title**: [Extract video title]  
**Creator/Channel**: [Channel name and credentials]  
**Duration**: [Video length]  
**Upload Date**: [Publication date]  
**URL**: [Video URL] [^1]

### Content Analysis Structure

## \u{1F3AF} Executive Summary
Brief overview of video's main purpose and key value (2-3 sentences)

## \u{1F4DA} Content Breakdown

### Primary Topics Covered
1. **Topic 1**: Key points and insights [^2]
2. **Topic 2**: Supporting arguments and evidence [^3]  
3. **Topic 3**: Practical applications discussed [^4]

### Key Insights and Data
- **Important Statistic/Claim 1**: [Quote with timestamp] [^5]
- **Important Statistic/Claim 2**: [Quote with timestamp] [^6]
- **Important Statistic/Claim 3**: [Quote with timestamp] [^7]

### Notable Quotes
> "Significant quote 1" - [Speaker name, timestamp] [^8]
> "Significant quote 2" - [Speaker name, timestamp] [^9]

## \u{1F50D} Critical Evaluation

### Credibility Assessment
- **Speaker Credentials**: [Qualifications and expertise] [^10]
- **Source Quality**: [Evidence quality and citations used] [^11]
- **Bias Considerations**: [Potential limitations or perspectives] [^12]

### Educational Value
- **Target Audience**: [Who benefits most from this content]
- **Learning Outcomes**: [What viewers should understand]
- **Practical Applications**: [How to apply the information]

## \u{1F310} Related Resources
For additional context and verification:
- [Primary Source/Research](https://example.com) - Original research mentioned
- [Expert Analysis](https://example.com) - Related expert commentary  
- [Institutional Resource](https://example.com) - Official documentation

## \u{1F517} Knowledge Vault Integration
**Suggested Internal Links**: [[Video Analysis Method]], [[Research Methodology]], [[Topic Category]]  
**Recommended Tags**: #video-analysis #[topic-specific] #[creator-name] #research  
**Related Notes**: Consider creating [[Follow-up Research]] and [[Implementation Plan]]

---
### Video Citations and References
[^1]: Video Source: [Creator Name]. "[Video Title]." YouTube, [Upload Date]. [Full URL]
[^2]: Reference for Topic 1 information - timestamp or external source
[^3]: Reference for Topic 2 content - timestamp or supporting research
[^4]: Reference for Topic 3 applications - timestamp or related documentation
[^5]: Timestamp reference for statistic/claim 1 - [mm:ss format]
[^6]: Timestamp reference for statistic/claim 2 - [mm:ss format]  
[^7]: Timestamp reference for statistic/claim 3 - [mm:ss format]
[^8]: Quote reference with exact timestamp - [mm:ss format]
[^9]: Quote reference with exact timestamp - [mm:ss format]
[^10]: Speaker credential source - website, LinkedIn, or institutional affiliation
[^11]: Source quality documentation - research papers, data sources referenced
[^12]: Bias analysis source - independent evaluation or comparative analysis

**Analysis Standards:**
- 600-800 words with comprehensive video documentation
- Minimum 12 citations including timestamps and external sources
- Full Obsidian compatibility with internal linking
- Professional media analysis suitable for academic reference
- Include actionable insights and practical applications`;break;default:d=`Please provide comprehensive analysis on: "${e}" with accurate information and reliable sources.`}let p=`https://generativelanguage.googleapis.com/v1beta/models/${this.settings.geminiModel}:generateContent?key=${this.settings.geminiApiKey}`,m;if((a==null?void 0:a.id)==="youtube"&&(i!=null&&i.getVideoContext())){let k=i.getVideoContext();if(!k)return"Error: No video context available";let E=k.url;m={contents:[{parts:[{text:i.isValidYouTubeUrl(e)?d:`Based on the YouTube video at ${E}, please answer this question: "${e}"

**Context:** You are analyzing the video content to provide a specific answer.
**Requirements:** 
- Focus on answering the specific question asked
- Reference relevant parts of the video content
- Provide accurate and detailed information
- Include timestamps or specific examples when relevant`},{fileData:{mimeType:"video/*",fileUri:E}}]}],generationConfig:{temperature:c.temperature,topP:c.topP,topK:c.topK,maxOutputTokens:c.maxOutputTokens}}}else m={contents:[{parts:[{text:d}]}],tools:[{google_search:{}}],generationConfig:{temperature:c.temperature,topP:c.topP,topK:c.topK,maxOutputTokens:c.maxOutputTokens}};let y=(l=(await(0,g.requestUrl)({url:p,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).json.candidates)==null?void 0:l[0];if(!y)throw new Error("No response from Gemini");let x=y.content.parts[0].text;if((o=y.groundingMetadata)!=null&&o.groundingChunks){x+=`

--- 
**Sources:**
`;let k=new Set;y.groundingMetadata.groundingChunks.forEach(E=>{var O;(O=E.web)!=null&&O.uri&&k.add(`- [${E.web.title||E.web.uri}](${E.web.uri})`)}),x+=Array.from(k).join(`
`)}let A=t.endTimer(s);return t.logMetrics("gemini-search",A,{queryLength:e.length,resultLength:x.length,researchMode:a==null?void 0:a.id}),x}catch(i){t.endTimer(s),n.error("Gemini search failed",i);let a=i instanceof Error?i.message:String(i);throw new Error(`Gemini search failed: ${a}`)}}async searchWeb(e,n){try{let t;switch(this.settings.provider){case"gemini":t=await this.searchWithGemini(e);break;case"perplexity":t=await this.searchWithPerplexity(e);break;case"tavily":t=await this.searchWithTavily(e);break;case"exa":t=await this.searchWithExa(e);break;default:throw new Error(`Unknown provider: ${this.settings.provider}`)}this.insertResult(t,n)}catch(t){new g.Notice(`Search failed: ${t.message}`)}}async searchWithPerplexity(e){var r,l;if(!this.settings.perplexityApiKey)throw new Error("Perplexity API key not configured");if(!this.settings.perplexityApiKey.startsWith("pplx-"))throw new Error('Invalid Perplexity API key format. Must start with "pplx-"');let n=w.getInstance(),t=S.getInstance(),s=`perplexity-search-${Date.now()}`;try{t.startTimer(s),n.debug("Starting Perplexity search",{query:e});let o=this.getCurrentResearchMode(),i,a;o==="youtube"?(i=this.settings.researchModeConfigs.comprehensive.perplexityParams,a=this.settings.researchModeConfigs.comprehensive.perplexityModel):(i=this.settings.researchModeConfigs[o].perplexityParams,a=this.settings.researchModeConfigs[o].perplexityModel);let c={"llama-3.1-sonar-small-128k-online":"sonar","llama-3.1-sonar-large-128k-online":"sonar-pro","llama-3.1-sonar-huge-128k-online":"sonar-pro","llama-3.1-70b-instruct":"sonar-reasoning","llama-3.1-8b-instruct":"sonar"};c[a]&&(n.info(`Migrating old model ${a} to ${c[a]}`),a=c[a],o==="youtube"?this.settings.researchModeConfigs.comprehensive.perplexityModel=a:this.settings.researchModeConfigs[o].perplexityModel=a,await this.saveSettings()),["sonar","sonar-pro","sonar-reasoning","sonar-reasoning-pro","sonar-deep-research"].includes(a)||(n.warn(`Invalid model ${a}, falling back to sonar`),a="sonar");let p={model:a,messages:[{role:"user",content:e}],max_tokens:i.max_tokens||1e3,temperature:i.temperature||.7,return_citations:!0,return_related_questions:!1,return_images:!1};n.debug("Perplexity API request details",{model:a,currentMode:o,params:p,apiKeyPrefix:this.settings.perplexityApiKey.substring(0,8)+"..."}),Object.keys(p).forEach(x=>{p[x]===void 0&&delete p[x]}),n.debug("Perplexity API request",{model:a,params:p});let m=await(0,g.requestUrl)({url:"https://api.perplexity.ai/chat/completions",method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.settings.perplexityApiKey}`},body:JSON.stringify(p)}),f=t.endTimer(s);if(t.logMetrics("Perplexity Search",f,{queryLength:e.length,model:a,maxTokens:i.max_tokens}),m.status!==200)throw n.error("Perplexity API error",{status:m.status,statusText:m.text,headers:m.headers,requestBody:p}),new Error(`Perplexity search failed: Request failed, status ${m.status}. Response: ${m.text}`);let u=m.json;n.debug("Perplexity search results received",{choices:((r=u.choices)==null?void 0:r.length)||0,model:u.model});let y=`# Perplexity Search Results

**Query:** ${e}

`;if(y+=`**Model:** ${u.model||a}

`,u.choices&&u.choices.length>0){let x=u.choices[0];x.message&&x.message.content&&(y+=`## AI Response

${x.message.content}

`),x.citations&&x.citations.length>0&&(y+=`## Sources

`,x.citations.forEach((A,k)=>{y+=`${k+1}. [${A.title||A.url}](${A.url})
`}),y+=`
`),x.related_questions&&x.related_questions.length>0&&(y+=`## Related Questions

`,x.related_questions.forEach(A=>{y+=`- ${A}
`}),y+=`
`)}return u.usage&&(y+=`## Usage Statistics

`,y+=`- **Prompt Tokens:** ${u.usage.prompt_tokens||"N/A"}
`,y+=`- **Completion Tokens:** ${u.usage.completion_tokens||"N/A"}
`,y+=`- **Total Tokens:** ${u.usage.total_tokens||"N/A"}

`),y+=`
---
*Search performed using Perplexity API (${a}) on ${new Date().toISOString()}*
`,n.info("Perplexity search completed successfully",{duration:f,model:u.model,tokensUsed:((l=u.usage)==null?void 0:l.total_tokens)||0}),y}catch(o){let i=t.endTimer(s);throw n.error("Perplexity search failed",o),t.logMetrics("Perplexity Search (Failed)",i,{error:o.message,queryLength:e.length}),new Error(`Perplexity search failed: ${o.message}`)}}async searchWithTavily(e){var r,l;if(!this.settings.tavilyApiKey)throw new Error("Tavily API key not configured");let n=w.getInstance(),t=S.getInstance(),s=`tavily-search-${Date.now()}`;try{t.startTimer(s),n.debug("Starting Tavily search",{query:e});let o={api_key:this.settings.tavilyApiKey,query:e,search_depth:this.settings.tavilySearchDepth,include_answer:this.settings.tavilyIncludeAnswer,include_images:this.settings.tavilyIncludeImages,include_raw_content:this.settings.tavilyIncludeRawContent,max_results:this.settings.tavilyMaxResults,include_domains:this.settings.tavilyIncludeDomains?this.settings.tavilyIncludeDomains.split(",").map(p=>p.trim()):void 0,exclude_domains:this.settings.tavilyExcludeDomains?this.settings.tavilyExcludeDomains.split(",").map(p=>p.trim()):void 0,topic:this.settings.tavilyTopic,days:this.settings.tavilyDays};Object.keys(o).forEach(p=>{o[p]===void 0&&delete o[p]}),n.debug("Tavily API request body",o);let i=await(0,g.requestUrl)({url:"https://api.tavily.com/search",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),a=t.endTimer(s);if(t.logMetrics("Tavily Search",a,{queryLength:e.length,maxResults:this.settings.tavilyMaxResults,searchDepth:this.settings.tavilySearchDepth}),i.status!==200)throw new Error(`Tavily API error: ${i.status} - ${i.text}`);let c=i.json;n.debug("Tavily search results received",{resultsCount:((r=c.results)==null?void 0:r.length)||0,hasAnswer:!!c.answer});let d=`# Tavily Search Results

**Query:** ${e}

`;return c.answer&&(d+=`## AI Summary

${c.answer}

`),c.results&&c.results.length>0&&(d+=`## Search Results

`,c.results.forEach((p,m)=>{d+=`### ${m+1}. ${p.title}

`,p.url&&(d+=`**URL:** [${p.url}](${p.url})

`),p.content&&(d+=`**Content:** ${p.content}

`),p.score&&(d+=`**Relevance Score:** ${(p.score*100).toFixed(1)}%

`),d+=`---

`})),this.settings.tavilyIncludeImages&&c.images&&c.images.length>0&&(d+=`## Related Images

`,c.images.forEach((p,m)=>{p.url&&(d+=`![Image ${m+1}](${p.url})

`)})),d+=`
---
*Search performed using Tavily API on ${new Date().toISOString()}*
`,n.info("Tavily search completed successfully",{resultsCount:((l=c.results)==null?void 0:l.length)||0,duration:a}),d}catch(o){let i=t.endTimer(s);throw n.error("Tavily search failed",o),t.logMetrics("Tavily Search (Failed)",i,{error:o.message,queryLength:e.length}),new Error(`Tavily search failed: ${o.message}`)}}async searchWithExa(e){var r,l,o;if(!this.settings.exaApiKey)throw new Error("Exa API key not configured");let n=w.getInstance(),t=S.getInstance(),s=`exa-search-${Date.now()}`;try{t.startTimer(s),n.debug("Starting Exa search",{query:e});let i={query:e,type:this.settings.exaSearchType,numResults:this.settings.exaNumResults,includeDomains:this.settings.exaIncludeDomains?this.settings.exaIncludeDomains.split(",").map(m=>m.trim()):void 0,excludeDomains:this.settings.exaExcludeDomains?this.settings.exaExcludeDomains.split(",").map(m=>m.trim()):void 0,startCrawlDate:this.settings.exaStartCrawlDate||void 0,endCrawlDate:this.settings.exaEndCrawlDate||void 0,startPublishedDate:this.settings.exaStartPublishedDate||void 0,endPublishedDate:this.settings.exaEndPublishedDate||void 0,category:this.settings.exaCategory||void 0,useAutoprompt:this.settings.exaUseAutoprompt,contents:{text:this.settings.exaIncludeText,highlights:this.settings.exaIncludeHighlights}};Object.keys(i).forEach(m=>{i[m]===void 0&&delete i[m]}),i.contents&&(Object.keys(i.contents).forEach(m=>{i.contents[m]===void 0&&delete i.contents[m]}),Object.keys(i.contents).length===0&&delete i.contents),n.debug("Exa API request body",i);let a=await(0,g.requestUrl)({url:"https://api.exa.ai/search",method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.settings.exaApiKey},body:JSON.stringify(i)}),c=t.endTimer(s);if(t.logMetrics("Exa Search",c,{queryLength:e.length,numResults:this.settings.exaParams.numResults,searchType:this.settings.exaParams.type}),a.status!==200)throw new Error(`Exa API error: ${a.status} - ${a.text}`);let d=a.json;n.debug("Exa search results received",{resultsCount:((r=d.results)==null?void 0:r.length)||0,searchType:d.resolvedSearchType});let p=`# Exa Search Results

**Query:** ${e}

`;return d.resolvedSearchType&&(p+=`**Search Type:** ${d.resolvedSearchType}

`),d.context&&(p+=`## AI Context Summary

${d.context}

`),d.results&&d.results.length>0&&(p+=`## Search Results

`,d.results.forEach((m,f)=>{if(p+=`### ${f+1}. ${m.title}

`,m.url&&(p+=`**URL:** [${m.url}](${m.url})

`),m.author&&(p+=`**Author:** ${m.author}

`),m.publishedDate){let u=new Date(m.publishedDate).toLocaleDateString();p+=`**Published:** ${u}

`}m.score&&(p+=`**Relevance Score:** ${(m.score*100).toFixed(1)}%

`),m.text&&(p+=`**Content:**
${m.text}

`),m.highlights&&m.highlights.length>0&&(p+=`**Key Highlights:**
`,m.highlights.forEach(u=>{p+=`- ${u}
`}),p+=`
`),m.summary&&(p+=`**Summary:** ${m.summary}

`),m.subpages&&m.subpages.length>0&&(p+=`**Related Pages:**
`,m.subpages.slice(0,3).forEach(u=>{p+=`- [${u.title}](${u.url})
`}),p+=`
`),p+=`---

`})),d.costDollars&&(p+=`## Search Cost

`,p+=`**Total Cost:** $${d.costDollars.total}

`),p+=`
---
*Search performed using Exa API on ${new Date().toISOString()}*
`,n.info("Exa search completed successfully",{resultsCount:((l=d.results)==null?void 0:l.length)||0,duration:c,cost:((o=d.costDollars)==null?void 0:o.total)||0}),p}catch(i){let a=t.endTimer(s);throw n.error("Exa search failed",i),t.logMetrics("Exa Search (Failed)",a,{error:i.message,queryLength:e.length}),new Error(`Exa search failed: ${i.message}`)}}insertResult(e,n){let t=this.app.workspace.getActiveViewOfType(g.MarkdownView);if(!t){new g.Notice("No active markdown view");return}let s=t.editor;if(n==="replace")s.replaceSelection(e);else{let r=s.getCursor();s.replaceRange(`

`+e,r)}}promptForCustomSearch(e){let n=prompt("Enter your search query:");n&&this.searchWeb(n,"append")}async testPerplexityAPI(){try{let e=await this.searchWithPerplexity("test query");new g.Notice("Perplexity API test successful"),console.log("Perplexity test result:",e)}catch(e){new g.Notice(`Perplexity API test failed: ${e.message}`),console.error("Perplexity test error:",e)}}injectEnhancedCSS(){let e=`
		/* Enhanced Settings CSS for AI Web Search Plugin */
		.gemini-settings-container {
			font-family: var(--font-interface);
			line-height: var(--line-height-normal);
		}
		
		/* Chat Container - Responsive and Theme-aware */
		.gemini-chat-container {
			display: flex;
			flex-direction: column;
			height: 100%;
			background: var(--background-primary);
			color: var(--text-normal);
			font-family: var(--font-interface);
		}
		
		/* Chat Header - Mobile-responsive */
		.gemini-chat-header {
			padding: var(--size-4-2) var(--size-4-3);
			border-bottom: 1px solid var(--background-modifier-border);
			background: var(--background-secondary);
			flex-shrink: 0;
		}
		
		.title-container {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: var(--size-4-1);
			flex-wrap: wrap;
			gap: var(--size-4-1);
		}
		
		.title-container h3 {
			margin: 0;
			font-size: var(--font-ui-medium);
			font-weight: var(--font-weight-medium);
			color: var(--text-normal);
		}
		
		/* New Chat Button - Touch-friendly */
		.new-chat-button {
			display: flex;
			align-items: center;
			gap: var(--size-2-1);
			padding: var(--size-2-1) var(--size-4-1);
			background: var(--interactive-accent);
			color: var(--text-on-accent);
			border: none;
			border-radius: var(--radius-s);
			cursor: pointer;
			font-size: var(--font-ui-small);
			font-weight: var(--font-weight-medium);
			transition: all 0.2s ease;
			min-height: 32px; /* Touch-friendly minimum */
		}
		
		.new-chat-button:hover {
			background: var(--interactive-accent-hover);
			transform: translateY(-1px);
		}
		
		.new-chat-button svg {
			width: 14px;
			height: 14px;
			flex-shrink: 0;
		}
		
		/* Provider Container - Responsive */
		.provider-container {
			display: flex;
			align-items: center;
			gap: var(--size-2-2);
			flex-wrap: wrap;
		}
		
		.provider-label {
			font-size: var(--font-ui-small);
			color: var(--text-muted);
			font-weight: var(--font-weight-medium);
		}
		
		.provider-dropdown {
			padding: var(--size-2-1) var(--size-2-3);
			background: var(--background-primary);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			color: var(--text-normal);
			font-size: var(--font-ui-small);
			min-width: 160px;
			cursor: pointer;
		}
		
		.provider-dropdown:focus {
			outline: 2px solid var(--interactive-accent);
			outline-offset: 2px;
		}
		
		/* Model Selection Container */
		.model-container {
			display: flex;
			align-items: center;
			gap: var(--size-2-2);
			margin-left: var(--size-4-2);
		}
		
		.model-label {
			font-size: var(--font-ui-small);
			color: var(--text-muted);
			font-weight: var(--font-weight-medium);
		}
		
		.model-dropdown {
			padding: var(--size-2-1) var(--size-2-3);
			background: var(--background-primary);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			color: var(--text-normal);
			font-size: var(--font-ui-small);
			min-width: 200px;
			cursor: pointer;
		}
		
		.model-dropdown:focus {
			outline: 2px solid var(--interactive-accent);
			outline-offset: 2px;
		}
		
		/* Messages Container - Responsive and scrollable */
		.gemini-chat-messages {
			flex: 1;
			overflow-y: auto;
			padding: var(--size-4-2);
			scroll-behavior: smooth;
		}
		
		/* Message Styling - Improved readability */
		.message {
			margin-bottom: var(--size-4-3);
			padding: var(--size-4-2);
			border-radius: var(--radius-m);
			word-wrap: break-word;
			line-height: var(--line-height-normal);
		}
		
		.message.user {
			background: var(--background-modifier-form-field);
			border: 1px solid var(--background-modifier-border);
			margin-left: 10%;
		}
		
		.message.assistant {
			background: var(--background-secondary);
			border: 1px solid var(--background-modifier-border);
			margin-right: 10%;
		}
		
		.message.system {
			background: var(--background-modifier-success);
			border: 1px solid var(--color-green);
			text-align: center;
			font-style: italic;
			margin: var(--size-4-1) 20%;
		}
		
		/* Message Role Headers */
		.message-role, .message-role-header {
			font-weight: var(--font-weight-bold);
			font-size: var(--font-ui-small);
			color: var(--text-accent);
			margin-bottom: var(--size-2-2);
			display: flex;
			align-items: center;
			justify-content: space-between;
		}
		
		/* Message Content - Responsive text */
		.message-content {
			font-size: max(var(--font-ui-medium), 16px); /* Minimum 16px for mobile */
			color: var(--text-normal);
			white-space: pre-wrap;
			word-break: break-word;
		}
		
		.message-content.selectable-text {
			user-select: text;
			-webkit-user-select: text;
		}
		
		/* Copy Button - Touch-friendly */
		.copy-button {
			background: var(--interactive-normal);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			padding: var(--size-2-1) var(--size-2-2);
			font-size: var(--font-ui-smaller);
			color: var(--text-muted);
			cursor: pointer;
			transition: all 0.2s ease;
			min-height: 28px;
			min-width: 60px;
		}
		
		.copy-button:hover {
			background: var(--interactive-hover);
			color: var(--text-normal);
		}
		
		/* Progress Bar - Smooth animations */
		.progress-container {
			margin: var(--size-2-2) 0;
		}
		
		.progress-bar {
			width: 100%;
			height: 4px;
			background: var(--background-modifier-border);
			border-radius: var(--radius-s);
			overflow: hidden;
		}
		
		.progress-bar-fill {
			height: 100%;
			background: var(--interactive-accent);
			transition: width 0.3s ease;
			border-radius: inherit;
		}
		
		.thinking-text {
			color: var(--text-muted);
			font-style: italic;
			margin-top: var(--size-2-2);
		}
		
		/* Input Container - Responsive and accessible */
		.gemini-chat-input-container {
			padding: var(--size-4-2);
			background: var(--background-primary);
			border-top: 1px solid var(--background-modifier-border);
			flex-shrink: 0;
		}
		
		.input-group {
			display: flex;
			flex-direction: column;
			gap: var(--size-2-3);
		}
		
		.gemini-chat-input {
			width: 100%;
			min-height: 60px;
			max-height: 200px;
			padding: var(--size-4-1) var(--size-4-2);
			background: var(--background-primary);
			border: 2px solid var(--background-modifier-border);
			border-radius: var(--radius-m);
			color: var(--text-normal);
			font-size: max(var(--font-ui-medium), 16px); /* Minimum 16px for mobile */
			font-family: var(--font-interface);
			resize: vertical;
			line-height: var(--line-height-normal);
		}
		
		.gemini-chat-input:focus {
			outline: none;
			border-color: var(--interactive-accent);
			box-shadow: 0 0 0 2px var(--interactive-accent-hover);
		}
		
		.gemini-chat-input::placeholder {
			color: var(--text-faint);
		}
		
		/* Button Group - Responsive layout */
		.button-group {
			display: flex;
			gap: var(--size-2-2);
			flex-wrap: wrap;
		}
		
		.send-button, .save-button {
			flex: 1;
			min-width: 100px;
			padding: var(--size-2-3) var(--size-4-2);
			border: none;
			border-radius: var(--radius-m);
			font-size: var(--font-ui-medium);
			font-weight: var(--font-weight-medium);
			cursor: pointer;
			transition: all 0.2s ease;
			min-height: 40px; /* Touch-friendly */
		}
		
		.send-button {
			background: var(--interactive-accent);
			color: var(--text-on-accent);
		}
		
		.send-button:hover {
			background: var(--interactive-accent-hover);
		}
		
		.save-button {
			background: var(--interactive-normal);
			color: var(--text-normal);
			border: 1px solid var(--background-modifier-border);
		}
		
		.save-button:hover {
			background: var(--interactive-hover);
		}
		
		/* Research Mode Buttons - Mobile-first responsive */
		.research-mode-container-bottom {
			margin-top: var(--size-4-2);
			padding-top: var(--size-4-1);
			border-top: 1px solid var(--background-modifier-border);
		}
		
		.research-mode-label-small {
			font-size: var(--font-ui-small);
			color: var(--text-muted);
			margin-bottom: var(--size-2-2);
			font-weight: var(--font-weight-medium);
		}
		
		.research-mode-buttons-bottom {
			display: flex;
			gap: var(--size-2-1);
			flex-wrap: wrap;
		}
		
		.research-mode-btn-small {
			flex: 1;
			min-width: calc(50% - var(--size-2-1)); /* 2 per row on mobile */
			padding: var(--size-2-1) var(--size-2-2);
			background: var(--background-secondary);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			color: var(--text-normal);
			font-size: max(var(--font-ui-small), 14px); /* Minimum readable size */
			font-weight: var(--font-weight-medium);
			cursor: pointer;
			transition: all 0.2s ease;
			text-align: center;
			min-height: 36px; /* Touch-friendly */
		}
		
		.research-mode-btn-small:hover {
			background: var(--interactive-hover);
			border-color: var(--interactive-accent);
		}
		
		.research-mode-btn-small.active {
			background: var(--interactive-accent);
			color: var(--text-on-accent);
			border-color: var(--interactive-accent);
		}
		
		/* Advanced Settings - Responsive tabs */
		.setting-section {
			margin-bottom: var(--size-4-3);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-m);
			overflow: hidden;
			background: var(--background-primary);
		}
		
		.advanced-tabs-container {
			display: flex;
			border-bottom: 1px solid var(--background-modifier-border);
			overflow-x: auto;
			scrollbar-width: none;
			-ms-overflow-style: none;
		}
		
		.advanced-tabs-container::-webkit-scrollbar {
			display: none;
		}
		
		.advanced-tab {
			flex: 1;
			min-width: 100px;
			padding: var(--size-4-1) var(--size-4-2);
			background: var(--background-secondary);
			border: none;
			cursor: pointer;
			transition: all 0.2s ease;
			font-size: var(--font-ui-medium);
			color: var(--text-normal);
			white-space: nowrap;
		}
		
		.advanced-tab:hover {
			background: var(--interactive-hover);
		}
		
		.advanced-tab.active {
			background: var(--background-primary);
			border-bottom: 2px solid var(--interactive-accent);
			color: var(--text-accent);
		}
		
		.advanced-content {
			padding: var(--size-4-3);
		}
		
		.settings-help-text {
			font-size: var(--font-ui-small);
			color: var(--text-muted);
			margin-top: var(--size-2-2);
			line-height: var(--line-height-normal);
		}
		
		/* Markdown Content Styling */
		.message-content h1, .message-content h2, .message-content h3 {
			color: var(--text-normal);
			margin: var(--size-4-2) 0 var(--size-2-3) 0;
			font-weight: var(--font-weight-bold);
		}
		
		.message-content h1 { font-size: var(--font-ui-large); }
		.message-content h2 { font-size: var(--font-ui-medium); }
		.message-content h3 { font-size: var(--font-ui-medium); }
		
		.message-content p {
			margin: var(--size-2-3) 0;
			line-height: var(--line-height-normal);
		}
		
		.message-content ul, .message-content ol {
			margin: var(--size-2-3) 0;
			padding-left: var(--size-4-4);
		}
		
		.message-content li {
			margin: var(--size-2-1) 0;
			line-height: var(--line-height-normal);
		}
		
		.message-content code {
			background: var(--background-modifier-border);
			padding: var(--size-2-1) var(--size-2-2);
			border-radius: var(--radius-s);
			font-family: var(--font-monospace);
			font-size: var(--font-ui-small);
			color: var(--text-normal);
		}
		
		.message-content pre {
			background: var(--background-modifier-border);
			padding: var(--size-4-2);
			border-radius: var(--radius-m);
			overflow-x: auto;
			margin: var(--size-4-2) 0;
		}
		
		.message-content .external-link {
			color: var(--text-accent);
			text-decoration: underline;
			text-decoration-color: var(--text-accent);
		}
		
		.message-content .external-link:hover {
			color: var(--text-accent-hover);
		}
		
		.message-content .citation-link {
			color: var(--text-accent);
			text-decoration: none;
			font-weight: var(--font-weight-medium);
			cursor: pointer;
		}
		
		.message-content .citation-link:hover {
			background: var(--background-modifier-hover);
			border-radius: var(--radius-s);
			padding: 0 var(--size-2-1);
		}
		
		/* Responsive Design - Mobile adjustments */
		@media (max-width: 768px) {
			.title-container {
				flex-direction: column;
				align-items: stretch;
				gap: var(--size-2-2);
			}
			
			.provider-container {
				justify-content: center;
				flex-direction: column;
				align-items: stretch;
			}
			
			.model-container {
				margin-left: 0;
				margin-top: var(--size-2-2);
			}
			
			.provider-dropdown,
			.model-dropdown {
				width: 100%;
			}
			
			.message.user {
				margin-left: 5%;
			}
			
			.message.assistant {
				margin-right: 5%;
			}
			
			.message.system {
				margin: var(--size-2-2) 10%;
			}
			
			.research-mode-btn-small {
				min-width: calc(100% - var(--size-2-1)); /* Full width on very small screens */
			}
			
			.button-group {
				flex-direction: column;
			}
			
			.send-button, .save-button {
				flex: none;
			}
		}
		
		/* Animation for clearing chat */
		.clearing {
			opacity: 0;
			transform: translateY(-10px);
			transition: all 0.2s ease;
		}
		
		/* Focus visible for accessibility */
		.research-mode-btn-small:focus-visible,
		.new-chat-button:focus-visible,
		.copy-button:focus-visible,
		.send-button:focus-visible,
		.save-button:focus-visible {
			outline: 2px solid var(--interactive-accent);
			outline-offset: 2px;
		}
		`,n=document.createElement("style");n.textContent=e,document.head.appendChild(n)}},I=class extends g.ItemView{constructor(e,n){super(e);this.currentVideoContext=null;this.plugin=n}getViewType(){return D}getDisplayText(){return"AI Web Search Chat"}getIcon(){return"message-circle"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("gemini-chat-container");let n=e.createEl("div",{cls:"gemini-chat-header"}),t=n.createEl("div",{cls:"title-container"});t.createEl("h3",{text:"AI Web Search Chat"});let s=t.createEl("button",{cls:"new-chat-button",title:"Start a new conversation (Ctrl/Cmd + N)",attr:{"aria-label":"Start new chat conversation",role:"button"}});s.innerHTML=`
			<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
				<line x1="12" y1="8" x2="12" y2="16"></line>
				<line x1="8" y1="12" x2="16" y2="12"></line>
			</svg>
			<span>New Chat</span>
		`,s.addEventListener("click",()=>{this.clearChat()}),this.containerEl.addEventListener("keydown",f=>{(f.ctrlKey||f.metaKey)&&f.key==="n"&&!f.shiftKey&&!f.altKey&&(f.preventDefault(),this.clearChat())});let r=n.createEl("div",{cls:"provider-container"});r.createEl("span",{text:"Provider: ",cls:"provider-label"});let l=r.createEl("select",{cls:"provider-dropdown"}),o=l.createEl("option",{value:"gemini",text:`Google Gemini ${this.checkApiKey("gemini")?"\u2713":"\u26A0\uFE0F"}`}),i=l.createEl("option",{value:"perplexity",text:`Perplexity AI ${this.checkApiKey("perplexity")?"\u2713":"\u26A0\uFE0F"}`}),a=l.createEl("option",{value:"tavily",text:`Tavily Search ${this.checkApiKey("tavily")?"\u2713":"\u26A0\uFE0F"}`}),c=l.createEl("option",{value:"exa",text:`Exa AI Search ${this.checkApiKey("exa")?"\u2713":"\u26A0\uFE0F"}`});l.value=this.plugin.settings.provider;let d=n.createEl("div",{cls:"model-container"});d.createEl("span",{text:"Model: ",cls:"model-label"});let p=d.createEl("select",{cls:"model-dropdown"});this.updateModelDropdown(p,this.plugin.settings.provider),l.addEventListener("change",async f=>{var y;let u=f.target.value;this.plugin.settings.provider=u,this.updateModelDropdown(p,u),((y=this.currentResearchMode)==null?void 0:y.id)==="youtube"&&u!=="gemini"&&(new g.Notice("\u26A0\uFE0F YouTube mode requires Gemini provider"),l.value="gemini",this.plugin.settings.provider="gemini",this.updateModelDropdown(p,"gemini")),await this.plugin.saveSettings()}),p.addEventListener("change",async f=>{let u=f.target.value;await this.updateModelForCurrentMode(u)}),this.messageContainer=e.createEl("div",{cls:"gemini-chat-messages"}),this.inputContainer=e.createEl("div",{cls:"gemini-chat-input-container"}),this.createInputArea(),this.currentResearchMode={id:"comprehensive",label:"\u{1F50D} Comprehensive",description:"Balanced research with detailed analysis",model:"gemini-2.5-flash",perplexityModel:"sonar-pro",exaSearchType:"auto",exaCategory:""},this.checkApiKey(this.plugin.settings.provider)?this.addMessage("system",`Welcome! Ask me anything and I'll search the web for you using ${this.plugin.settings.provider}.`):this.addMessage("system",`\u26A0\uFE0F Welcome! Please configure your ${this.plugin.settings.provider} API key in plugin settings before starting.`)}createInputArea(){var c;this.inputContainer.empty();let e=this.inputContainer.createEl("div",{cls:"input-group"}),n=e.createEl("textarea",{cls:"gemini-chat-input",attr:{placeholder:"Ask anything...",rows:"3"}}),t=e.createEl("div",{cls:"button-group"}),s=t.createEl("button",{cls:"send-button",text:"Send"}),r=t.createEl("button",{cls:"save-button",text:"Send & Save",attr:{title:"Send query and save chat to folder"}}),l=this.inputContainer.createEl("div",{cls:"research-mode-container-bottom"});l.createEl("div",{text:"Research Mode:",cls:"research-mode-label-small"});let o=l.createEl("div",{cls:"research-mode-buttons-bottom"});[{id:"quick",label:"\u26A1 Quick",description:"Fast answers",model:"gemini-2.5-flash-lite",perplexityModel:"sonar",exaSearchType:"fast",exaCategory:""},{id:"comprehensive",label:"\u{1F50D} Comprehensive",description:"Balanced research",model:"gemini-2.5-flash",perplexityModel:"sonar-pro",exaSearchType:"auto",exaCategory:""},{id:"deep",label:"\u{1F3AF} Deep",description:"Expert analysis",model:"gemini-2.5-pro",perplexityModel:"sonar-deep-research",exaSearchType:"neural",exaCategory:"research paper"},{id:"reasoning",label:"\u{1F9E0} Reasoning",description:"Complex analysis",model:"gemini-2.5-pro",perplexityModel:"sonar-reasoning",exaSearchType:"neural",exaCategory:"research paper"},{id:"youtube",label:"\u{1F3AC} YouTube",description:"Video analysis",model:"gemini-2.5-pro",perplexityModel:"sonar-pro",exaSearchType:"auto",exaCategory:"",providerLock:"gemini",requiresUrl:!0}].forEach(d=>{let p=o.createEl("button",{cls:`research-mode-btn-small research-mode-${d.id}`,attr:{"data-mode":d.id},text:d.label});p.addEventListener("click",()=>{this.setResearchMode(d),o.querySelectorAll(".research-mode-btn-small").forEach(f=>f.removeClass("active")),p.addClass("active")})}),(c=o.querySelector('[data-mode="comprehensive"]'))==null||c.addClass("active"),s.onclick=()=>this.handleSend(n.value,!1),r.onclick=()=>this.handleSend(n.value,!1,!0);let a=()=>{n.style.height="auto",n.style.height=Math.min(n.scrollHeight,200)+"px"};n.addEventListener("input",a),n.addEventListener("keydown",d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),this.handleSend(n.value,!1))}),a()}async handleSend(e,n,t=!1){var p,m,f;if(!e.trim())return;let s=this.inputContainer.querySelector(".gemini-chat-input"),r=this.inputContainer.querySelector(".send-button"),l=this.inputContainer.querySelector(".save-button"),o=s.value;s.value="",s.disabled=!0,r.disabled=!0,l.disabled=!0,this.addMessage("user",e);let i=this.plugin.settings.provider,a=(m=(p=this.plugin.settings.providerSearchModes)==null?void 0:p[i])!=null?m:!0,c="Thinking...";a?c=`Searching the web with ${i}...`:c=`Chatting with ${i}...`;let d=this.addMessage("assistant",c,!0);if((f=this.currentResearchMode)!=null&&f.requiresUrl&&!this.isValidYouTubeUrl(e)&&!this.currentVideoContext){let u="\u274C YouTube mode requires a valid YouTube URL. Please paste a YouTube video URL first.";this.updateMessage(d,u);return}try{let u;a?u=await this.plugin.performWebSearch(e):i==="gemini"?u=await this.plugin.performGeminiChat(e,this.getChatHistory()):i==="perplexity"?u=await this.plugin.performPerplexityChat(e,this.getChatHistory()):u=await this.plugin.performWebSearch(e),this.updateMessage(d,u),n&&this.insertToActiveNote(u),t&&this.plugin.settings.chatSaveEnabled&&await this.saveToFolder()}catch(u){let y=`\u274C Error: ${u instanceof Error?u.message:String(u)}`;this.updateMessage(d,y),s.value=o}finally{s.disabled=!1,r.disabled=!1,l.disabled=!1,s.focus()}}getChatHistory(){if(!this.plugin.settings.contextMemoryEnabled)return[];let e=[];switch(this.messageContainer.querySelectorAll(".chat-message").forEach(t=>{var l;let s=t.getAttribute("data-role"),r=((l=t.querySelector(".message-content"))==null?void 0:l.textContent)||"";s&&r&&s!=="system"&&!r.includes("Searching the web...")&&!r.includes("Thinking...")&&!r.includes("Analyzing YouTube video...")&&e.push({role:s==="user"?"user":"assistant",content:r})}),this.plugin.settings.contextMemoryStrategy){case"recent":return e.slice(-this.plugin.settings.maxContextMessages);case"token-limit":let t=this.plugin.settings.maxContextMessages*100,s=0,r=[];for(let d=e.length-1;d>=0;d--){let p=Math.ceil(e[d].content.length/4);if(s+p>t)break;s+=p,r.unshift(e[d])}return r;case"summary":if(e.length<=this.plugin.settings.maxContextMessages)return e;let l=e[0],o=e.slice(-Math.floor(this.plugin.settings.maxContextMessages/2)),c={role:"system",content:`[Context Summary] Previous conversation included:
${e.slice(1,-Math.floor(this.plugin.settings.maxContextMessages/2)).map(d=>`${d.role}: ${d.content.substring(0,100)}...`).join(`
`)}`};return[l,c,...o];default:return e.slice(-this.plugin.settings.maxContextMessages)}}setResearchMode(e){this.currentResearchMode=e;let n=this.containerEl.querySelector(".model-dropdown");if(n&&this.updateModelDropdown(n,this.plugin.settings.provider),e.id==="youtube"){if(this.plugin.settings.provider!=="gemini"){this.plugin.settings.provider="gemini",this.plugin.saveSettings();let t=this.containerEl.querySelector(".provider-dropdown");t&&(t.value="gemini"),n&&this.updateModelDropdown(n,"gemini"),new g.Notice("\u{1F3AC} Switched to Gemini provider for YouTube video analysis")}this.plugin.settings.geminiModel="gemini-2.5-pro",this.plugin.saveSettings()}this.plugin.settings.provider==="gemini"?this.plugin.settings.geminiModel=e.model:this.plugin.settings.provider==="perplexity"?this.plugin.settings.perplexityModel=e.perplexityModel:this.plugin.settings.provider==="exa"&&(this.plugin.settings.exaSearchType=e.exaSearchType,this.plugin.settings.exaCategory=e.exaCategory),this.plugin.saveSettings(),this.addMessage("system",`Research mode set to ${e.label}: ${e.description}`)}updateModelDropdown(e,n){var s;e.empty(),this.getAvailableModels(n,(s=this.currentResearchMode)==null?void 0:s.id).forEach(r=>{let l=e.createEl("option",{value:r.id,text:r.displayName});this.isCurrentModel(r.id,n)&&(l.selected=!0)})}getAvailableModels(e,n){let t=[];switch(e){case"gemini":t.push({id:"gemini-2.5-pro",displayName:"Gemini 2.5 Pro (Best Quality)",compatible:["comprehensive","deep","reasoning","youtube"]},{id:"gemini-2.5-flash",displayName:"Gemini 2.5 Flash (Balanced)",compatible:["quick","comprehensive","deep"]},{id:"gemini-2.5-flash-lite",displayName:"Gemini 2.5 Flash Lite (Fastest)",compatible:["quick"]});break;case"perplexity":t.push({id:"sonar-reasoning-pro",displayName:"Sonar Reasoning Pro (Advanced)",compatible:["reasoning","deep"]},{id:"sonar-pro",displayName:"Sonar Pro (Advanced Search)",compatible:["comprehensive","deep"]},{id:"sonar",displayName:"Sonar (Standard)",compatible:["quick","comprehensive"]},{id:"sonar-deep-research",displayName:"Sonar Deep Research (Exhaustive)",compatible:["deep"]},{id:"sonar-reasoning",displayName:"Sonar Reasoning (Fast)",compatible:["reasoning"]});break;case"tavily":t.push({id:"tavily-search",displayName:"Tavily Search",compatible:["quick","comprehensive","deep"]});break;case"exa":t.push({id:"exa-neural",displayName:"Neural Search",compatible:["comprehensive","deep","reasoning"]});break}return n?t.filter(s=>s.compatible.includes(n)):t}isCurrentModel(e,n){var r;let t=(r=this.currentResearchMode)==null?void 0:r.id;if(!t)return!1;let s=this.plugin.settings.researchModeConfigs[t];switch(n){case"gemini":return s.geminiModel===e;case"perplexity":return s.perplexityModel===e;default:return!1}}async updateModelForCurrentMode(e){var o;let n=this.plugin.settings.provider,t=(o=this.currentResearchMode)==null?void 0:o.id;if(!t)return;let r=this.getAvailableModels(n,t).find(i=>i.id===e);if(!r){new g.Notice(`\u26A0\uFE0F Model ${e} not compatible with ${t} mode`);return}let l=t;switch(n){case"gemini":this.plugin.settings.researchModeConfigs[l].geminiModel=e;break;case"perplexity":this.plugin.settings.researchModeConfigs[l].perplexityModel=e;break}await this.plugin.saveSettings(),new g.Notice(`\u2705 Updated ${t} mode to use ${r.displayName}`)}addMessage(e,n,t=!1){let s=Date.now().toString(),r=this.messageContainer.createEl("div",{cls:`message ${e}`,attr:{"data-id":s,"data-role":e}});if(e==="user")r.createEl("div",{cls:"message-role",text:"You"});else if(e==="assistant"){let o=r.createEl("div",{cls:"message-role-header"});o.createEl("span",{cls:"message-role",text:"AI Assistant"});let i=o.createEl("button",{cls:"copy-button",text:"\u{1F4CB} Copy"});i.addEventListener("click",()=>{navigator.clipboard.writeText(n),i.textContent="\u2705 Copied!",setTimeout(()=>{i.textContent="\u{1F4CB} Copy"},2e3)})}let l=r.createEl("div",{cls:"message-content"});if(t){l.addClass("thinking");let a=l.createEl("div",{cls:"progress-container"}).createEl("div",{cls:"progress-bar"}).createEl("div",{cls:"progress-bar-fill"}),c=l.createEl("div",{cls:"thinking-text"});c.textContent=n;let d=0,p=setInterval(()=>{d+=Math.random()*15,d>=90&&(d=90,clearInterval(p)),a.style.width=`${d}%`},200);r.setAttribute("data-progress-interval",p.toString())}return l.addClass("selectable-text"),e==="assistant"&&!t?this.renderMarkdownContent(l,n):l.textContent=n,this.messageContainer.scrollTop=this.messageContainer.scrollHeight,s}updateMessage(e,n){let t=this.messageContainer.querySelector(`[data-id="${e}"]`);if(t){let s=t.getAttribute("data-progress-interval");s&&clearInterval(parseInt(s));let r=t.querySelector(".message-content");if(r){r.removeClass("thinking"),r.addClass("selectable-text");let l=r.querySelector(".progress-bar-fill");l?(l.style.width="100%",setTimeout(()=>{let i=r.querySelector(".progress-container");i&&i.remove();let a=r.querySelector(".thinking-text");a&&a.remove(),this.renderMarkdownContent(r,n),this.messageContainer.scrollTop=this.messageContainer.scrollHeight},300)):(this.renderMarkdownContent(r,n),this.messageContainer.scrollTop=this.messageContainer.scrollHeight);let o=t.querySelector(".copy-button");o&&(o.onclick=()=>{navigator.clipboard.writeText(n),o.textContent="\u2705 Copied!",setTimeout(()=>{o.textContent="\u{1F4CB} Copy"},2e3)})}}}insertToActiveNote(e){let n=this.app.workspace.getActiveViewOfType(g.MarkdownView);if(n){let t=n.editor,s=t.getCursor();t.replaceRange(`

${e}
`,s),new g.Notice("Response inserted to note")}else new g.Notice("No active note to insert into")}clearChat(){if(!(this.messageContainer&&this.messageContainer.children.length>1&&!confirm("Are you sure you want to start a new chat? This will clear the current conversation.")))if(this.messageContainer)this.messageContainer.addClass("clearing"),setTimeout(()=>{this.messageContainer.empty(),this.messageContainer.removeClass("clearing"),this.currentResearchMode={id:"comprehensive",label:"\u{1F50D} Comprehensive",description:"Balanced research with detailed analysis",model:"gemini-2.5-flash",perplexityModel:"sonar-pro",exaSearchType:"auto",exaCategory:""},this.containerEl.querySelectorAll(".research-mode-btn-small").forEach(r=>{r.removeClass("active"),r.getAttribute("data-mode")==="comprehensive"&&r.addClass("active")});let s=this.checkApiKey(this.plugin.settings.provider)?`\u{1F195} New conversation started! Ask me anything and I'll search the web for you using ${this.plugin.settings.provider}.`:`\u26A0\uFE0F New conversation started! Please configure your ${this.plugin.settings.provider} API key in plugin settings before starting.`;this.addMessage("system",s),setTimeout(()=>{let r=this.containerEl.querySelector(".gemini-chat-input");r&&(r.focus(),r.placeholder="Ask anything to start your new conversation...",setTimeout(()=>{r.placeholder="Ask anything..."},3e3))},100)},200);else{let n=this.containerEl.querySelector(".gemini-chat-input");n&&n.focus()}}checkApiKey(e){switch(e){case"gemini":return!!this.plugin.settings.geminiApiKey;case"perplexity":return!!this.plugin.settings.perplexityApiKey;case"tavily":return!!this.plugin.settings.tavilyApiKey;case"exa":return!!this.plugin.settings.exaApiKey;default:return!1}}renderMarkdownContent(e,n){e.empty();let t=n.split(`
`),s=e,r=!1,l=[];t.forEach(o=>{if(o.startsWith("```"))if(r){let a=e.createEl("pre").createEl("code");a.textContent=l.join(`
`),l=[],r=!1,s=e}else r=!0;else if(r)l.push(o);else if(o.startsWith("### ")){let i=e.createEl("h3");i.textContent=o.replace("### ",""),s=e}else if(o.startsWith("## ")){let i=e.createEl("h2");i.textContent=o.replace("## ",""),s=e}else if(o.startsWith("# ")){let i=e.createEl("h1");i.textContent=o.replace("# ",""),s=e}else if(o.startsWith("- ")||o.startsWith("* ")){s.tagName!=="UL"&&(s=e.createEl("ul"));let i=s.createEl("li");this.parseInlineMarkdown(i,o.replace(/^[*-] /,""))}else if(o.startsWith("**Sources:**")||o.startsWith("--- ")){if(o.startsWith("--- "))e.createEl("hr");else{let i=e.createEl("h4");i.textContent="Sources:"}s=e}else if(o.trim()==="")e.createEl("br"),s=e;else{s.tagName==="UL"&&(s=e);let i=e.createEl("p");this.parseInlineMarkdown(i,o)}})}parseInlineMarkdown(e,n){let t=n;t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t=t.replace(/`(.*?)`/g,"<code>$1</code>"),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="external-link">$1 \u{1F517}</a>'),t=t.replace(/(https?:\/\/[^\s<>"{}|\\^`[\]]+)/g,'<a href="$1" target="_blank" rel="noopener noreferrer" class="external-link">$1 \u{1F517}</a>'),t=t.replace(/\[(\d+)\]/g,`<a href="#citation-$1" class="citation-link" onclick="this.closest('.message-content').querySelector('h4:contains(Sources), strong:contains(Sources)')?.scrollIntoView({behavior: 'smooth', block: 'center'})">[$1]</a>`),e.innerHTML=t,e.querySelectorAll(".citation-link").forEach(r=>{r.addEventListener("click",l=>{l.preventDefault();let o=e.closest(".message-content");if(o){let i=Array.from(o.querySelectorAll("strong, h4")).find(a=>{var c;return(c=a.textContent)==null?void 0:c.includes("Sources")});i&&(i.scrollIntoView({behavior:"smooth",block:"center"}),i.style.backgroundColor="var(--interactive-accent)",i.style.color="white",i.style.padding="8px",i.style.borderRadius="4px",i.style.transition="all 0.3s ease",setTimeout(()=>{i.style.backgroundColor="",i.style.color="",i.style.padding=""},2e3))}})})}async saveToFolder(){try{let e=this.plugin.settings.chatFolderName,n=this.app.vault;n.getAbstractFileByPath(e)||await n.createFolder(e);let s=new Date().toISOString().slice(0,19).replace(/[T:]/g,"-"),l=(this.getFirstUserMessage()||"chat").slice(0,50).replace(/[^\w\s-]/g,"").replace(/\s+/g,"-"),o;switch(this.plugin.settings.chatNoteTemplate){case"timestamp-query":o=`${s}-${l}`;break;case"query-timestamp":o=`${l}-${s}`;break;case"query-only":o=l;break;case"counter":o=`chat-${n.getMarkdownFiles().filter(m=>m.path.startsWith(e)&&m.basename.startsWith("chat-")).length+1}`;break;default:o=`${s}-${l}`}let i=`${o}.md`,a=1;for(;n.getAbstractFileByPath(`${e}/${i}`);)i=`${o}-${a}.md`,a++;let c=this.formatChatNote(),d=`${e}/${i}`;await n.create(d,c),new g.Notice(`Chat saved to: ${d}`)}catch(e){new g.Notice(`Failed to save chat: ${e instanceof Error?e.message:String(e)}`),console.error("Save to folder error:",e)}}formatChatNote(){let e=new Date().toLocaleString(),n=this.plugin.settings.provider,t=this.currentResearchMode,s=`# AI Web Search Chat

`;return s+=`**Date:** ${e}
`,s+=`**Provider:** ${n}
`,s+=`**Research Mode:** ${t}

`,s+=`---

`,this.messageContainer.querySelectorAll(".message").forEach(l=>{var a,c;let o=l.querySelector(".message-role"),i=l.querySelector(".message-content");if(o&&i){let d=(a=o.textContent)==null?void 0:a.trim(),p=((c=i.textContent)==null?void 0:c.trim())||"";d==="You"?s+=`## \u{1F64B} You

${p}

`:d==="AI Assistant"&&!p.includes("Searching the web...")&&(s+=`## \u{1F916} AI Assistant

${p}

`)}}),s+=`
---
*Generated by AI Web Search Plugin*`,s}getFirstUserMessage(){var n;let e=this.messageContainer.querySelectorAll(".message.user .message-content");return e.length>0&&((n=e[0].textContent)==null?void 0:n.trim())||""}isValidYouTubeUrl(e){return/^https?:\/\/(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/|v\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})(?:\S+)?$/.test(e.trim())}extractYouTubeVideoId(e){let n=e.match(/(?:youtube\.com\/(?:watch\?v=|embed\/|v\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return n?n[1]:null}clearVideoContext(){this.currentVideoContext=null,this.updateVideoContextUI()}setVideoContext(e,n,t){this.currentVideoContext={url:e,videoId:n,title:t,analyzed:!0},this.updateVideoContextUI()}updateVideoContextUI(){var e;!this.videoContextContainer||!this.videoContextTitle||(this.currentVideoContext&&((e=this.currentResearchMode)==null?void 0:e.id)==="youtube"?(this.videoContextContainer.style.display="block",this.videoContextTitle.textContent=this.currentVideoContext.title||`Video ${this.currentVideoContext.videoId}`):this.videoContextContainer.style.display="none")}getVideoContext(){return this.currentVideoContext}async onClose(){}},N=class{constructor(h,e){this.app=h,this.plugin=e}open(){new g.Notice("Search modal coming soon...")}},B=class extends g.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"AI Web Search Settings"}),new g.Setting(e).setName("AI Provider").setDesc("Choose your preferred AI provider").addDropdown(n=>n.addOption("gemini","Google Gemini").addOption("perplexity","Perplexity AI").addOption("tavily","Tavily").addOption("exa","Exa").setValue(this.plugin.settings.provider).onChange(async t=>{this.plugin.settings.provider=t,await this.plugin.saveSettings()})),new g.Setting(e).setName("Gemini API Key").setDesc("Enter your Google AI Studio API key").addText(n=>n.setPlaceholder("Enter API key").setValue(this.plugin.settings.geminiApiKey).onChange(async t=>{this.plugin.settings.geminiApiKey=t,await this.plugin.saveSettings()})),new g.Setting(e).setName("Perplexity API Key").setDesc("Enter your Perplexity API key").addText(n=>n.setPlaceholder("Enter API key").setValue(this.plugin.settings.perplexityApiKey).onChange(async t=>{this.plugin.settings.perplexityApiKey=t,await this.plugin.saveSettings()})),new g.Setting(e).setName("Tavily API Key").setDesc("Enter your Tavily API key").addText(n=>n.setPlaceholder("Enter API key").setValue(this.plugin.settings.tavilyApiKey).onChange(async t=>{this.plugin.settings.tavilyApiKey=t,await this.plugin.saveSettings()})),new g.Setting(e).setName("Exa API Key").setDesc("Enter your Exa API key").addText(n=>n.setPlaceholder("Enter API key").setValue(this.plugin.settings.exaApiKey).onChange(async t=>{this.plugin.settings.exaApiKey=t,await this.plugin.saveSettings()})),new g.Setting(e).setName("Insert Mode").setDesc("How to insert search results").addDropdown(n=>n.addOption("replace","Replace Selection").addOption("append","Append to Document").setValue(this.plugin.settings.insertMode).onChange(async t=>{this.plugin.settings.insertMode=t,await this.plugin.saveSettings()})),new g.Setting(e).setName("Max Results").setDesc("Maximum number of search results").addSlider(n=>n.setLimits(1,20,1).setValue(this.plugin.settings.maxResults).setDynamicTooltip().onChange(async t=>{this.plugin.settings.maxResults=t,await this.plugin.saveSettings()})),new g.Setting(e).setName("Include Images").setDesc("Include images in search results when supported").addToggle(n=>n.setValue(this.plugin.settings.includeImages).onChange(async t=>{this.plugin.settings.includeImages=t,await this.plugin.saveSettings()})),new g.Setting(e).setName("Show Advanced Settings").setDesc("Show provider-specific advanced configuration options").addToggle(n=>n.setValue(this.plugin.settings.uiPreferences.showAdvancedSettings).onChange(async t=>{this.plugin.settings.uiPreferences.showAdvancedSettings=t,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.uiPreferences.showAdvancedSettings){let n=e.createDiv("advanced-settings-container");n.createEl("h3",{text:"Advanced Provider Settings"});let t=n.createDiv("advanced-tabs-container"),s=n.createDiv("advanced-content"),r=[{id:"gemini",label:"Gemini",method:()=>this.addGeminiAdvancedSettings(s)},{id:"perplexity",label:"Perplexity",method:()=>this.addPerplexityAdvancedSettings(s)},{id:"tavily",label:"Tavily",method:()=>this.addTavilyAdvancedSettings(s)},{id:"exa",label:"Exa",method:()=>this.addExaAdvancedSettings(s)}];r.forEach((l,o)=>{let i=t.createEl("button",{text:l.label,cls:o===0?"advanced-tab active":"advanced-tab"});i.onclick=()=>{t.querySelectorAll(".advanced-tab").forEach(a=>a.removeClass("active")),i.addClass("active"),s.empty(),l.method()}}),r[0].method()}}addGeminiAdvancedSettings(e){e.createEl("h5",{text:"Gemini Advanced Parameters"}),e.createEl("p",{text:"Configure advanced Gemini model parameters for fine-tuned responses. These settings affect all research modes.",cls:"settings-help-text"}),new g.Setting(e).setName("Gemini Model").setDesc("Choose the Gemini model variant (affects cost and capabilities)").addDropdown(t=>t.addOption("gemini-2.5-pro","Gemini 2.5 Pro (Best Quality)").addOption("gemini-2.5-flash","Gemini 2.5 Flash (Balanced)").addOption("gemini-2.5-flash-lite","Gemini 2.5 Flash Lite (Fastest)").setValue(this.plugin.settings.geminiModel||"gemini-2.5-flash").onChange(async s=>{this.plugin.settings.geminiModel=s,["quick","comprehensive","deep","reasoning","youtube"].forEach(l=>{this.plugin.settings.researchModeConfigs[l]&&(this.plugin.settings.researchModeConfigs[l].geminiModel=s)}),await this.plugin.saveSettings()})),new g.Setting(e).setName("Temperature").setDesc("Controls randomness: 0.0 = focused, 2.0 = creative (Default: 0.7)").addSlider(t=>t.setLimits(0,200,5).setValue((this.plugin.settings.researchModeConfigs.comprehensive.geminiParams.temperature||.7)*100).setDynamicTooltip().onChange(async s=>{let r=s/100;["quick","comprehensive","deep","reasoning","youtube"].forEach(o=>{var i;(i=this.plugin.settings.researchModeConfigs[o])!=null&&i.geminiParams&&(this.plugin.settings.researchModeConfigs[o].geminiParams.temperature=r)}),await this.plugin.saveSettings()})),new g.Setting(e).setName("Top P (Nucleus Sampling)").setDesc("Cumulative probability cutoff: 0.1 = conservative, 1.0 = diverse (Default: 0.8)").addSlider(t=>t.setLimits(10,100,5).setValue((this.plugin.settings.researchModeConfigs.comprehensive.geminiParams.topP||.8)*100).setDynamicTooltip().onChange(async s=>{let r=s/100;["quick","comprehensive","deep","reasoning","youtube"].forEach(o=>{var i;(i=this.plugin.settings.researchModeConfigs[o])!=null&&i.geminiParams&&(this.plugin.settings.researchModeConfigs[o].geminiParams.topP=r)}),await this.plugin.saveSettings()})),new g.Setting(e).setName("Top K").setDesc("Limits vocabulary to top K tokens: 1 = restrictive, 100 = diverse (Default: 40)").addSlider(t=>t.setLimits(1,100,1).setValue(this.plugin.settings.researchModeConfigs.comprehensive.geminiParams.topK||40).setDynamicTooltip().onChange(async s=>{["quick","comprehensive","deep","reasoning","youtube"].forEach(l=>{var o;(o=this.plugin.settings.researchModeConfigs[l])!=null&&o.geminiParams&&(this.plugin.settings.researchModeConfigs[l].geminiParams.topK=s)}),await this.plugin.saveSettings()})),new g.Setting(e).setName("Max Output Tokens").setDesc("Maximum response length: 256 = short, 8192 = very long (Default: 2048)").addSlider(t=>t.setLimits(256,8192,256).setValue(this.plugin.settings.researchModeConfigs.comprehensive.geminiParams.maxOutputTokens||2048).setDynamicTooltip().onChange(async s=>{["quick","comprehensive","deep","reasoning","youtube"].forEach(l=>{var o;(o=this.plugin.settings.researchModeConfigs[l])!=null&&o.geminiParams&&(this.plugin.settings.researchModeConfigs[l].geminiParams.maxOutputTokens=s)}),await this.plugin.saveSettings()})),e.createEl("h6",{text:"Content Safety Settings"}),e.createEl("p",{text:"Configure content filtering levels for different harm categories.",cls:"settings-help-text"}),[{key:"harassment",name:"Harassment",desc:"Malicious comments targeting identity/protected attributes"},{key:"hateSpeech",name:"Hate Speech",desc:"Content that promotes hatred toward groups"},{key:"sexuallyExplicit",name:"Sexually Explicit",desc:"Contains sexual or erotic content"},{key:"dangerousContent",name:"Dangerous Content",desc:"Promotes harmful or illegal activities"}].forEach(t=>{new g.Setting(e).setName(t.name).setDesc(t.desc).addDropdown(s=>s.addOption("BLOCK_NONE","None - Allow all content").addOption("BLOCK_ONLY_HIGH","High - Block only high-confidence harmful content").addOption("BLOCK_MEDIUM_AND_ABOVE","Medium+ - Block medium and high harmful content (Default)").addOption("BLOCK_LOW_AND_ABOVE","Low+ - Block low, medium, and high harmful content").setValue(this.plugin.settings.researchModeConfigs.comprehensive.geminiSafety[t.key]||"BLOCK_MEDIUM_AND_ABOVE").onChange(async r=>{["quick","comprehensive","deep","reasoning","youtube"].forEach(o=>{var i;(i=this.plugin.settings.researchModeConfigs[o])!=null&&i.geminiSafety&&(this.plugin.settings.researchModeConfigs[o].geminiSafety[t.key]=r)}),await this.plugin.saveSettings()}))})}addPerplexityAdvancedSettings(e){e.createEl("h5",{text:"Perplexity Advanced Parameters"}),e.createEl("p",{text:"Control Perplexity search depth and response characteristics.",cls:"settings-help-text"}),new g.Setting(e).setName("Perplexity Model").setDesc("Choose Perplexity AI model").addDropdown(b=>{b.addOption("sonar-reasoning-pro","Sonar Reasoning Pro (Advanced)").addOption("sonar-pro","Sonar Pro (Advanced Search)").addOption("sonar","Sonar (Standard)").addOption("sonar-deep-research","Sonar Deep Research (Exhaustive)").addOption("sonar-reasoning","Sonar Reasoning (Fast)").setValue(this.plugin.settings.perplexityModel||"sonar-pro").onChange(async v=>{this.plugin.settings.perplexityModel=v,Object.keys(this.plugin.settings.researchModeConfigs).forEach(C=>{this.plugin.settings.researchModeConfigs[C].perplexityModel&&(this.plugin.settings.researchModeConfigs[C].perplexityModel=v)}),await this.plugin.saveSettings()})});let n=e.createEl("div",{cls:"setting-item"}),t=n.createEl("div",{cls:"setting-item-info"});t.createEl("div",{cls:"setting-item-name",text:"Temperature"});let s=t.createEl("div",{cls:"setting-item-description"}),r=this.plugin.settings.perplexityTemperature||.2;s.textContent=`Creativity level (0.0-2.0). Current: ${r}`,n.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"0",max:"2.0",step:"0.1",value:r.toString()}}).addEventListener("input",async b=>{let v=parseFloat(b.target.value);this.plugin.settings.perplexityTemperature=v,s.textContent=`Creativity level (0.0-2.0). Current: ${v}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(C=>{this.plugin.settings.researchModeConfigs[C].perplexityTemperature=v}),await this.plugin.saveSettings()});let i=e.createEl("div",{cls:"setting-item"}),a=i.createEl("div",{cls:"setting-item-info"});a.createEl("div",{cls:"setting-item-name",text:"Max Tokens"});let c=a.createEl("div",{cls:"setting-item-description"}),d=this.plugin.settings.perplexityMaxTokens||1024;c.textContent=`Maximum response length (256-4096). Current: ${d}`,i.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"256",max:"4096",step:"64",value:d.toString()}}).addEventListener("input",async b=>{let v=parseInt(b.target.value);this.plugin.settings.perplexityMaxTokens=v,c.textContent=`Maximum response length (256-4096). Current: ${v}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(C=>{this.plugin.settings.researchModeConfigs[C].perplexityMaxTokens=v}),await this.plugin.saveSettings()});let f=e.createEl("div",{cls:"setting-item"}),u=f.createEl("div",{cls:"setting-item-info"});u.createEl("div",{cls:"setting-item-name",text:"Top P"});let y=u.createEl("div",{cls:"setting-item-description"}),x=this.plugin.settings.perplexityTopP||1;y.textContent=`Nucleus sampling (0.1-1.0). Current: ${x}`,f.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"0.1",max:"1.0",step:"0.05",value:x.toString()}}).addEventListener("input",async b=>{let v=parseFloat(b.target.value);this.plugin.settings.perplexityTopP=v,y.textContent=`Nucleus sampling (0.1-1.0). Current: ${v}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(C=>{this.plugin.settings.researchModeConfigs[C].perplexityTopP=v}),await this.plugin.saveSettings()});let E=e.createEl("div",{cls:"setting-item"}),O=E.createEl("div",{cls:"setting-item-info"});O.createEl("div",{cls:"setting-item-name",text:"Top K"});let L=O.createEl("div",{cls:"setting-item-description"}),K=this.plugin.settings.perplexityTopK||0;L.textContent=`Vocabulary limitation (0-100). Current: ${K}`,E.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"0",max:"100",step:"5",value:K.toString()}}).addEventListener("input",async b=>{let v=parseInt(b.target.value);this.plugin.settings.perplexityTopK=v,L.textContent=`Vocabulary limitation (0-100, 0=disabled). Current: ${v}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(C=>{this.plugin.settings.researchModeConfigs[C].perplexityTopK=v}),await this.plugin.saveSettings()});let V=e.createEl("div",{cls:"setting-item"}),$=V.createEl("div",{cls:"setting-item-info"});$.createEl("div",{cls:"setting-item-name",text:"Frequency Penalty"});let q=$.createEl("div",{cls:"setting-item-description"}),H=this.plugin.settings.perplexityFrequencyPenalty||0;q.textContent=`Reduce repetition (-2.0 to 2.0). Current: ${H}`,V.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"-2.0",max:"2.0",step:"0.1",value:H.toString()}}).addEventListener("input",async b=>{let v=parseFloat(b.target.value);this.plugin.settings.perplexityFrequencyPenalty=v,q.textContent=`Reduce repetition (-2.0 to 2.0). Current: ${v}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(C=>{this.plugin.settings.researchModeConfigs[C].perplexityFrequencyPenalty=v}),await this.plugin.saveSettings()});let F=e.createEl("div",{cls:"setting-item"}),U=F.createEl("div",{cls:"setting-item-info"});U.createEl("div",{cls:"setting-item-name",text:"Presence Penalty"});let z=U.createEl("div",{cls:"setting-item-description"}),W=this.plugin.settings.perplexityPresencePenalty||0;z.textContent=`Encourage new topics (-2.0 to 2.0). Current: ${W}`,F.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"-2.0",max:"2.0",step:"0.1",value:W.toString()}}).addEventListener("input",async b=>{let v=parseFloat(b.target.value);this.plugin.settings.perplexityPresencePenalty=v,z.textContent=`Encourage new topics (-2.0 to 2.0). Current: ${v}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(C=>{this.plugin.settings.researchModeConfigs[C].perplexityPresencePenalty=v}),await this.plugin.saveSettings()}),new g.Setting(e).setName("Return Citations").setDesc("Include source citations in responses").addToggle(b=>{var v;b.setValue((v=this.plugin.settings.perplexityReturnCitations)!=null?v:!0).onChange(async C=>{this.plugin.settings.perplexityReturnCitations=C,Object.keys(this.plugin.settings.researchModeConfigs).forEach(T=>{this.plugin.settings.researchModeConfigs[T].perplexityReturnCitations=C}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Return Images").setDesc("Include images in search results when available").addToggle(b=>{var v;b.setValue((v=this.plugin.settings.perplexityReturnImages)!=null?v:!1).onChange(async C=>{this.plugin.settings.perplexityReturnImages=C,Object.keys(this.plugin.settings.researchModeConfigs).forEach(T=>{this.plugin.settings.researchModeConfigs[T].perplexityReturnImages=C}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Return Related Questions").setDesc("Include suggested follow-up questions").addToggle(b=>{var v;b.setValue((v=this.plugin.settings.perplexityReturnRelated)!=null?v:!0).onChange(async C=>{this.plugin.settings.perplexityReturnRelated=C,Object.keys(this.plugin.settings.researchModeConfigs).forEach(T=>{this.plugin.settings.researchModeConfigs[T].perplexityReturnRelated=C}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Search Domain Time").setDesc("Time range for search results").addDropdown(b=>{b.addOption("","No time limit").addOption("hour","Past hour").addOption("day","Past day").addOption("week","Past week").addOption("month","Past month").addOption("year","Past year").setValue(this.plugin.settings.perplexitySearchDomainFilter||"").onChange(async v=>{this.plugin.settings.perplexitySearchDomainFilter=v,Object.keys(this.plugin.settings.researchModeConfigs).forEach(C=>{this.plugin.settings.researchModeConfigs[C].perplexitySearchDomainFilter=v}),await this.plugin.saveSettings()})})}addTavilyAdvancedSettings(e){e.createEl("h5",{text:"Tavily Advanced Parameters"}),e.createEl("p",{text:"Configure Tavily search depth and result filtering options.",cls:"settings-help-text"}),new g.Setting(e).setName("Search Depth").setDesc("Depth of search results to retrieve").addDropdown(f=>{f.addOption("basic","Basic - Fast results").addOption("advanced","Advanced - Comprehensive results").setValue(this.plugin.settings.tavilySearchDepth||"basic").onChange(async u=>{this.plugin.settings.tavilySearchDepth=u,Object.keys(this.plugin.settings.researchModeConfigs).forEach(y=>{this.plugin.settings.researchModeConfigs[y].tavilySearchDepth=u}),await this.plugin.saveSettings()})});let n=e.createEl("div",{cls:"setting-item"}),t=n.createEl("div",{cls:"setting-item-info"});t.createEl("div",{cls:"setting-item-name",text:"Max Results"});let s=t.createEl("div",{cls:"setting-item-description"}),r=this.plugin.settings.tavilyMaxResults||5;s.textContent=`Maximum number of results (1-20). Current: ${r}`,n.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"1",max:"20",step:"1",value:r.toString()}}).addEventListener("input",async f=>{let u=parseInt(f.target.value);this.plugin.settings.tavilyMaxResults=u,s.textContent=`Maximum number of results (1-20). Current: ${u}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(y=>{this.plugin.settings.researchModeConfigs[y].tavilyMaxResults=u}),await this.plugin.saveSettings()}),new g.Setting(e).setName("Include Domains").setDesc("Comma-separated list of domains to include (e.g., wikipedia.org, reddit.com)").addTextArea(f=>{f.setPlaceholder("Enter domains to include...").setValue(this.plugin.settings.tavilyIncludeDomains||"").onChange(async u=>{this.plugin.settings.tavilyIncludeDomains=u,Object.keys(this.plugin.settings.researchModeConfigs).forEach(y=>{this.plugin.settings.researchModeConfigs[y].tavilyIncludeDomains=u}),await this.plugin.saveSettings()}),f.inputEl.rows=2}),new g.Setting(e).setName("Exclude Domains").setDesc("Comma-separated list of domains to exclude (e.g., ads.com, spam.com)").addTextArea(f=>{f.setPlaceholder("Enter domains to exclude...").setValue(this.plugin.settings.tavilyExcludeDomains||"").onChange(async u=>{this.plugin.settings.tavilyExcludeDomains=u,Object.keys(this.plugin.settings.researchModeConfigs).forEach(y=>{this.plugin.settings.researchModeConfigs[y].tavilyExcludeDomains=u}),await this.plugin.saveSettings()}),f.inputEl.rows=2}),new g.Setting(e).setName("Include Answer").setDesc("Include a direct answer in addition to search results").addToggle(f=>{var u;f.setValue((u=this.plugin.settings.tavilyIncludeAnswer)!=null?u:!0).onChange(async y=>{this.plugin.settings.tavilyIncludeAnswer=y,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].tavilyIncludeAnswer=y}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Include Raw Content").setDesc("Include the raw HTML content of search results").addToggle(f=>{var u;f.setValue((u=this.plugin.settings.tavilyIncludeRawContent)!=null?u:!1).onChange(async y=>{this.plugin.settings.tavilyIncludeRawContent=y,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].tavilyIncludeRawContent=y}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Include Images").setDesc("Include images in search results when available").addToggle(f=>{var u;f.setValue((u=this.plugin.settings.tavilyIncludeImages)!=null?u:!1).onChange(async y=>{this.plugin.settings.tavilyIncludeImages=y,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].tavilyIncludeImages=y}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Topic").setDesc("Topic category for search context (general, news, etc.)").addDropdown(f=>{f.addOption("general","General").addOption("news","News").addOption("science","Science").addOption("technology","Technology").addOption("business","Business").addOption("health","Health").addOption("entertainment","Entertainment").addOption("sports","Sports").setValue(this.plugin.settings.tavilyTopic||"general").onChange(async u=>{this.plugin.settings.tavilyTopic=u,Object.keys(this.plugin.settings.researchModeConfigs).forEach(y=>{this.plugin.settings.researchModeConfigs[y].tavilyTopic=u}),await this.plugin.saveSettings()})});let i=e.createEl("div",{cls:"setting-item"}),a=i.createEl("div",{cls:"setting-item-info"});a.createEl("div",{cls:"setting-item-name",text:"Recent Content Days"});let c=a.createEl("div",{cls:"setting-item-description"}),d=this.plugin.settings.tavilyDays||0;c.textContent=`Limit to content from last N days (0=no limit). Current: ${d}`,i.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"0",max:"365",step:"1",value:d.toString()}}).addEventListener("input",async f=>{let u=parseInt(f.target.value);this.plugin.settings.tavilyDays=u,c.textContent=`Limit to content from last N days (0=no limit). Current: ${u}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(y=>{this.plugin.settings.researchModeConfigs[y].tavilyDays=u}),await this.plugin.saveSettings()})}addExaAdvancedSettings(e){e.createEl("h5",{text:"Exa Neural Search Advanced Parameters"}),e.createEl("p",{text:"Exa offers the most customization options for semantic search and content filtering.",cls:"settings-help-text"}),new g.Setting(e).setName("Search Type").setDesc("Type of search to perform").addDropdown(i=>{i.addOption("neural","Neural - Semantic understanding").addOption("keyword","Keyword - Traditional search").addOption("auto","Auto - Best of both").setValue(this.plugin.settings.exaSearchType||"neural").onChange(async a=>{this.plugin.settings.exaSearchType=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaSearchType=a}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Use Autoprompt").setDesc("Automatically enhance queries for better results").addToggle(i=>{var a;i.setValue((a=this.plugin.settings.exaUseAutoprompt)!=null?a:!0).onChange(async c=>{this.plugin.settings.exaUseAutoprompt=c,Object.keys(this.plugin.settings.researchModeConfigs).forEach(d=>{this.plugin.settings.researchModeConfigs[d].exaUseAutoprompt=c}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Category").setDesc("Content category to focus search on").addDropdown(i=>{i.addOption("","Any category").addOption("company","Company").addOption("research paper","Research Paper").addOption("news","News").addOption("github","GitHub").addOption("tweet","Tweet").addOption("movie","Movie").addOption("song","Song").addOption("personal site","Personal Site").addOption("pdf","PDF Document").setValue(this.plugin.settings.exaCategory||"").onChange(async a=>{this.plugin.settings.exaCategory=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaCategory=a}),await this.plugin.saveSettings()})});let n=e.createEl("div",{cls:"setting-item"}),t=n.createEl("div",{cls:"setting-item-info"});t.createEl("div",{cls:"setting-item-name",text:"Number of Results"});let s=t.createEl("div",{cls:"setting-item-description"}),r=this.plugin.settings.exaNumResults||10;s.textContent=`Number of results to return (1-20). Current: ${r}`,n.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"1",max:"20",step:"1",value:r.toString()}}).addEventListener("input",async i=>{let a=parseInt(i.target.value);this.plugin.settings.exaNumResults=a,s.textContent=`Number of results to return (1-20). Current: ${a}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaNumResults=a}),await this.plugin.saveSettings()}),new g.Setting(e).setName("Include Domains").setDesc("Comma-separated list of domains to include (e.g., wikipedia.org, arxiv.org)").addTextArea(i=>{i.setPlaceholder("Enter domains to include...").setValue(this.plugin.settings.exaIncludeDomains||"").onChange(async a=>{this.plugin.settings.exaIncludeDomains=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaIncludeDomains=a}),await this.plugin.saveSettings()}),i.inputEl.rows=2}),new g.Setting(e).setName("Exclude Domains").setDesc("Comma-separated list of domains to exclude (e.g., pinterest.com, quora.com)").addTextArea(i=>{i.setPlaceholder("Enter domains to exclude...").setValue(this.plugin.settings.exaExcludeDomains||"").onChange(async a=>{this.plugin.settings.exaExcludeDomains=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaExcludeDomains=a}),await this.plugin.saveSettings()}),i.inputEl.rows=2}),new g.Setting(e).setName("Start Crawl Date").setDesc("Only include results crawled after this date (YYYY-MM-DD format)").addText(i=>{i.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.exaStartCrawlDate||"").onChange(async a=>{this.plugin.settings.exaStartCrawlDate=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaStartCrawlDate=a}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("End Crawl Date").setDesc("Only include results crawled before this date (YYYY-MM-DD format)").addText(i=>{i.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.exaEndCrawlDate||"").onChange(async a=>{this.plugin.settings.exaEndCrawlDate=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaEndCrawlDate=a}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Start Published Date").setDesc("Only include results published after this date (YYYY-MM-DD format)").addText(i=>{i.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.exaStartPublishedDate||"").onChange(async a=>{this.plugin.settings.exaStartPublishedDate=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaStartPublishedDate=a}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("End Published Date").setDesc("Only include results published before this date (YYYY-MM-DD format)").addText(i=>{i.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.exaEndPublishedDate||"").onChange(async a=>{this.plugin.settings.exaEndPublishedDate=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(c=>{this.plugin.settings.researchModeConfigs[c].exaEndPublishedDate=a}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Include Text").setDesc("Include the text content of search results").addToggle(i=>{var a;i.setValue((a=this.plugin.settings.exaIncludeText)!=null?a:!0).onChange(async c=>{this.plugin.settings.exaIncludeText=c,Object.keys(this.plugin.settings.researchModeConfigs).forEach(d=>{this.plugin.settings.researchModeConfigs[d].exaIncludeText=c}),await this.plugin.saveSettings()})}),new g.Setting(e).setName("Include Highlights").setDesc("Include highlighted relevant excerpts from results").addToggle(i=>{var a;i.setValue((a=this.plugin.settings.exaIncludeHighlights)!=null?a:!0).onChange(async c=>{this.plugin.settings.exaIncludeHighlights=c,Object.keys(this.plugin.settings.researchModeConfigs).forEach(d=>{this.plugin.settings.researchModeConfigs[d].exaIncludeHighlights=c}),await this.plugin.saveSettings()})})}};
