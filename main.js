/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var Q=(M,y)=>{for(var e in y)L(M,e,{get:y[e],enumerable:!0})},J=(M,y,e,s)=>{if(y&&typeof y=="object"||typeof y=="function")for(let n of G(y))!j.call(M,n)&&n!==e&&L(M,n,{get:()=>y[n],enumerable:!(s=W(y,n))||s.enumerable});return M};var Z=M=>J(L({},"__esModule",{value:!0}),M);var ee={};Q(ee,{GeminiChatView:()=>T,default:()=>P});module.exports=Z(ee);var p=require("obsidian"),C=class{constructor(){this.debugMode=!0}static getInstance(){return C.instance||(C.instance=new C),C.instance}debug(y,e){this.debugMode&&console.log(`[AI Web Search Debug] ${y}`,e||"")}info(y,e){console.log(`[AI Web Search Info] ${y}`,e||"")}warn(y,e){console.warn(`[AI Web Search Warning] ${y}`,e||"")}error(y,e){console.error(`[AI Web Search Error] ${y}`,e||"")}},E=class{constructor(){this.metrics=new Map}static getInstance(){return E.instance||(E.instance=new E),E.instance}startTimer(y){this.metrics.set(y,Date.now())}endTimer(y){let e=this.metrics.get(y);if(!e)return 0;let s=Date.now()-e;return this.metrics.delete(y),C.getInstance().debug(`Performance: ${y} took ${s}ms`),s}logMetrics(y,e,s){C.getInstance().info(`Performance Metric: ${y}`,{duration:`${e}ms`,timestamp:new Date().toISOString(),...s})}},_=class{static validateApiKey(y){return typeof y=="string"&&y.length>0&&y.trim().length>0}static validateUrl(y){try{return new URL(y),!0}catch(e){return!1}}static validateYouTubeUrl(y){return this.validateUrl(y)?/^https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)/.test(y):!1}static validateQuery(y){return typeof y=="string"&&y.trim().length>0&&y.length<=1e4}static validateResearchMode(y){return["quick","comprehensive","deep","reasoning","youtube"].includes(y)}static validateProvider(y){return["gemini","perplexity","tavily","exa"].includes(y)}static sanitizeInput(y){return y.trim().replace(/[<>]/g,"")}},X={provider:"gemini",geminiApiKey:"",perplexityApiKey:"",tavilyApiKey:"",exaApiKey:"",insertMode:"replace",maxResults:5,includeImages:!1,chatFolderName:"AI Web Search Chats",chatNoteTemplate:"timestamp-query",chatSaveEnabled:!0,geminiModel:"gemini-2.5-flash",geminiTemperature:.7,geminiTopP:.8,geminiTopK:40,geminiMaxOutputTokens:2e3,geminiHarassmentFilter:"BLOCK_MEDIUM_AND_ABOVE",geminiHateSpeechFilter:"BLOCK_MEDIUM_AND_ABOVE",geminiSexuallyExplicitFilter:"BLOCK_MEDIUM_AND_ABOVE",geminiDangerousContentFilter:"BLOCK_MEDIUM_AND_ABOVE",perplexityModel:"sonar-pro",perplexityTemperature:.5,perplexityMaxTokens:1500,perplexityTopP:.8,perplexityTopK:30,perplexityFrequencyPenalty:0,perplexityPresencePenalty:0,perplexityReturnCitations:!0,perplexityReturnImages:!1,perplexityReturnRelated:!1,perplexitySearchDomainFilter:"",tavilySearchDepth:"basic",tavilyMaxResults:5,tavilyIncludeDomains:"",tavilyExcludeDomains:"",tavilyIncludeAnswer:!0,tavilyIncludeRawContent:!1,tavilyIncludeImages:!1,tavilyTopic:"",tavilyDays:7,exaSearchType:"auto",exaUseAutoprompt:!1,exaCategory:"",exaNumResults:10,exaIncludeDomains:"",exaExcludeDomains:"",exaStartCrawlDate:"",exaEndCrawlDate:"",exaStartPublishedDate:"",exaEndPublishedDate:"",exaIncludeText:!0,exaIncludeHighlights:!0,researchModeConfigs:{quick:{geminiModel:"gemini-2.5-flash-lite",perplexityModel:"sonar",geminiParams:{temperature:.5,topP:.7,topK:20,maxOutputTokens:1e3,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"},perplexityParams:{temperature:.4,max_tokens:800,top_p:.7,top_k:20,frequency_penalty:0,presence_penalty:0,stream:!1,search_domain_filter:[],search_recency_filter:"day",search_mode:"web",return_related_questions:!1,return_citations:!0,return_images:!1,search_context_size:3}},comprehensive:{geminiModel:"gemini-2.5-flash",perplexityModel:"sonar-pro",geminiParams:{temperature:.7,topP:.8,topK:40,maxOutputTokens:2e3,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"},perplexityParams:{temperature:.6,max_tokens:2e3,top_p:.8,top_k:40,frequency_penalty:.1,presence_penalty:.1,stream:!1,search_domain_filter:[],search_recency_filter:"week",search_mode:"web",return_related_questions:!0,return_citations:!0,return_images:!0,search_context_size:8}},deep:{geminiModel:"gemini-2.5-pro",perplexityModel:"sonar-deep-research",geminiParams:{temperature:.8,topP:.9,topK:60,maxOutputTokens:4e3,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"},perplexityParams:{temperature:.7,max_tokens:4e3,top_p:.9,top_k:60,frequency_penalty:.2,presence_penalty:.2,stream:!1,search_domain_filter:[],search_recency_filter:"month",search_mode:"academic",return_related_questions:!0,return_citations:!0,return_images:!0,search_context_size:12}},reasoning:{geminiModel:"gemini-2.5-pro",perplexityModel:"sonar-reasoning-pro",geminiParams:{temperature:.3,topP:.6,topK:20,maxOutputTokens:3e3,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"},perplexityParams:{temperature:.2,max_tokens:3e3,top_p:.6,top_k:20,frequency_penalty:0,presence_penalty:0,stream:!1,search_domain_filter:[],search_recency_filter:"month",search_mode:"web",return_related_questions:!1,return_citations:!0,return_images:!1,search_context_size:10}},youtube:{geminiModel:"gemini-2.5-pro",geminiParams:{temperature:.3,topP:.8,topK:40,maxOutputTokens:2048,responseMimeType:"text/plain",candidateCount:1,stopSequences:[],seed:null},geminiSafety:{harassment:"BLOCK_MEDIUM_AND_ABOVE",hateSpeech:"BLOCK_MEDIUM_AND_ABOVE",sexuallyExplicit:"BLOCK_MEDIUM_AND_ABOVE",dangerousContent:"BLOCK_MEDIUM_AND_ABOVE"}}},tavilyParams:{query:"",search_depth:"basic",include_answer:!0,include_images:!1,include_raw_content:!1,max_results:5,include_domains:[],exclude_domains:[],auto_parameters:{topic:"general",search_depth:"basic"},days:null,api_format:"json"},exaParams:{query:"",type:"auto",category:"",numResults:10,includeDomains:[],excludeDomains:[],startCrawlDate:"",endCrawlDate:"",startPublishedDate:"",endPublishedDate:"",includeText:[],excludeText:[],getText:!0,getHighlights:!0,getSummary:!0,userLocation:"US"},enableCustomPrompts:!1,quickPrompt:'### Quick Research Response Framework\\n\\nYou are an expert researcher providing concise, actionable insights. Focus on immediate value and clear conclusions.\\n\\n**Research Query:** \\"{query}\\"\\n\\n**Response Structure:**\\n## \u{1F3AF} Key Findings\\n- Present 2-3 most important insights\\n- Use bullet points for clarity\\n- Keep each point to 1-2 sentences\\n\\n## \u{1F4DA} Essential Sources\\nWhen referencing sources, use this format:\\n- **Source Name** - Brief description [^1]\\n- **Source Name** - Brief description [^2]\\n\\n## \u{1F517} Recommended Reading\\nFor additional external resources, format as:\\n- [Resource Title](https://example.com) - Why this is valuable\\n\\n---\\n### Citations\\n[^1]: Full citation with author, title, publication, date\\n[^2]: Full citation with author, title, publication, date\\n\\n**Guidelines:**\\n- Maximum 300 words total\\n- Prioritize recent, authoritative sources\\n- Include actionable next steps if relevant\\n- Use Obsidian-compatible markdown formatting',comprehensivePrompt:'### Comprehensive Research Analysis for Obsidian\\n\\nYou are a senior researcher conducting thorough analysis. Create well-structured content optimized for Obsidian knowledge management.\\n\\n**Research Topic:** \\"{query}\\"\\n\\n**Response Framework:**\\n\\n## \u{1F4CB} Executive Summary\\nBrief overview highlighting key themes and conclusions (2-3 sentences)\\n\\n## \u{1F50D} Detailed Analysis\\n\\n### Core Concepts\\n- **Concept 1**: Definition and significance [^1]\\n- **Concept 2**: Definition and significance [^2]\\n- **Concept 3**: Definition and significance [^3]\\n\\n### Current Landscape\\nAnalyze current state, trends, and developments with proper citations [^4][^5]\\n\\n### Multiple Perspectives\\n#### Academic Perspective\\nResearch findings and scholarly insights [^6]\\n\\n#### Industry Perspective\\nPractical applications and market trends [^7]\\n\\n#### Critical Analysis\\nLimitations, controversies, or gaps [^8]\\n\\n## \u{1F310} External Resources\\nFor deeper exploration:\\n- [Primary Resource](https://example.com) - Comprehensive overview\\n- [Research Database](https://example.com) - Latest studies\\n- [Expert Analysis](https://example.com) - Professional insights\\n\\n## \u{1F517} Related Topics for Your Vault\\nConsider exploring: [[Topic 1]], [[Topic 2]], [[Topic 3]]\\n\\n---\\n### Sources and Citations\\n[^1]: Author, Title, Publication, Year, URL\\n[^2]: Author, Title, Publication, Year, URL\\n[^3]: Author, Title, Publication, Year, URL\\n[^4]: Author, Title, Publication, Year, URL\\n[^5]: Author, Title, Publication, Year, URL\\n[^6]: Author, Title, Publication, Year, URL\\n[^7]: Author, Title, Publication, Year, URL\\n[^8]: Author, Title, Publication, Year, URL\\n\\n**Quality Standards:**\\n- 600-800 words with proper structure\\n- Minimum 8 quality citations with full bibliographic details\\n- Use Obsidian-compatible internal links for related concepts\\n- External links open in new browser tabs when clicked',deepPrompt:`### Deep Research Investigation for Advanced Knowledge Management\\n\\nYou are a leading expert conducting comprehensive multi-dimensional analysis. Create research-grade content structured for Obsidian's advanced features.\\n\\n**Research Question:** \\"{query}\\"\\n\\n## \u{1F3AF} Research Overview\\n**Scope**: Comprehensive multi-perspective analysis\\n**Approach**: Systematic investigation across disciplines\\n**Expected Outcome**: Research-grade insights with complete documentation\\n\\n## \u{1F4DA} Foundation Analysis\\n\\n### Historical Context\\nEvolution and development of the topic [^1][^2]\\n\\n### Theoretical Framework\\n- **Primary Theory A**: Core principles and applications [^3]\\n- **Primary Theory B**: Alternative approaches and methodologies [^4]\\n- **Synthesis**: Integration and comparative analysis [^5]\\n\\n## \u{1F52C} Multi-Dimensional Investigation\\n\\n### Dimension 1: Academic Research\\n**Methodology**: Systematic literature review\\n**Key Findings**: [^6][^7][^8]\\n- Finding 1 with supporting evidence\\n- Finding 2 with methodological details\\n- Finding 3 with statistical significance\\n\\n### Dimension 2: Professional Practice\\n**Industry Applications**: [^9][^10]\\n- Implementation strategies and success factors\\n- Challenges and mitigation approaches\\n- ROI and performance metrics\\n\\n### Dimension 3: Interdisciplinary Connections\\n**Cross-Field Insights**: [^11][^12]\\n- Connections to [[Related Field 1]]\\n- Applications in [[Related Field 2]]\\n- Emerging interdisciplinary opportunities\\n\\n### Dimension 4: Future Implications\\n**Trend Analysis**: [^13][^14]\\n- Short-term developments (1-2 years)\\n- Medium-term evolution (3-5 years)\\n- Long-term transformation (5+ years)\\n\\n## \u2696\uFE0F Critical Evaluation\\n\\n### Strengths and Advantages\\nEvidence-based assessment of positive aspects [^15]\\n\\n### Limitations and Challenges\\nSystematic analysis of constraints and difficulties [^16]\\n\\n### Controversies and Debates\\nBalanced examination of disputed areas [^17][^18]\\n\\n## \u{1F310} Comprehensive Resource Library\\n\\n### Primary Sources\\n- [Foundational Research](https://example.com) - Seminal papers and studies\\n- [Current Literature](https://example.com) - Recent peer-reviewed articles\\n- [Institutional Reports](https://example.com) - Official analyses and data\\n\\n### Secondary Sources\\n- [Expert Commentary](https://example.com) - Professional perspectives\\n- [Industry Analysis](https://example.com) - Market and trend reports\\n- [Educational Resources](https://example.com) - Learning and development materials\\n\\n### Specialized Databases\\n- [Academic Database](https://example.com) - Scholarly articles and citations\\n- [Professional Database](https://example.com) - Industry insights and case studies\\n- [Government Resources](https://example.com) - Policy and regulatory information\\n\\n## \u{1F517} Knowledge Graph Connections\\n**Vault Integration Suggestions:**\\n- Create new notes: [[Topic Analysis]], [[Methodology Review]], [[Implementation Guide]]\\n- Link to existing: [[Research Methods]], [[Industry Trends]], [[Theoretical Frameworks]]\\n- Tag suggestions: #research #analysis #[topic-specific-tags]\\n\\n## \u{1F4CA} Synthesis and Conclusions\\n\\n### Primary Conclusions\\nEvidence-based summary of key findings with confidence levels\\n\\n### Research Gaps\\nIdentified areas requiring further investigation\\n\\n### Actionable Recommendations\\nSpecific next steps for different stakeholder groups\\n\\n---\\n### Complete Bibliography\\n[^1]: Author, A. (Year). \\"Article Title,\\" *Journal Name*, Vol(Issue), pp. Pages. DOI/URL\\n[^2]: Author, B. (Year). *Book Title*. Publisher. ISBN. URL\\n[^3]: Author, C. (Year). \\"Chapter Title,\\" in *Book Title*, Editor (Ed.), Publisher, pp. Pages\\n[^4]: Organization. (Year). \\"Report Title.\\" *Publication Series*. Retrieved from URL\\n[^5]: Author, D. (Year). \\"Conference Paper Title,\\" *Conference Proceedings*, Location, Date\\n[^6]: Author, E. et al. (Year). \\"Research Article,\\" *Academic Journal*, Vol(Issue), pp. Pages\\n[^7]: Author, F. (Year). \\"Analysis Title,\\" *Professional Publication*, Date. URL\\n[^8]: Institution. (Year). \\"Study Report,\\" *Research Series*, Report Number. URL\\n[^9]: Author, G. (Year). \\"Industry Report,\\" *Business Publication*, Date. URL\\n[^10]: Expert, H. (Year). \\"Commentary Title,\\" *Expert Platform*, Date. URL\\n[^11]: Author, I. (Year). \\"Cross-Disciplinary Study,\\" *Interdisciplinary Journal*, Vol(Issue)\\n[^12]: Researcher, J. (Year). \\"Integration Analysis,\\" *Academic Publisher*, Location\\n[^13]: Analyst, K. (Year). \\"Future Trends Report,\\" *Research Institute*, Date. URL\\n[^14]: Futurist, L. (Year). \\"Projection Analysis,\\" *Think Tank Publication*, Date\\n[^15]: Evaluator, M. (Year). \\"Strengths Assessment,\\" *Evaluation Journal*, Vol(Issue)\\n[^16]: Critic, N. (Year). \\"Limitations Review,\\" *Critical Analysis Quarterly*, Vol(Issue)\\n[^17]: Debater, O. (Year). \\"Controversy Overview,\\" *Debate Forum*, Date. URL\\n[^18]: Scholar, P. (Year). \\"Dispute Analysis,\\" *Academic Review*, Vol(Issue), pp. Pages\\n\\n**Research Standards:**\\n- 1200-1500 words with academic rigor\\n- Minimum 18 high-quality citations with complete bibliographic information\\n- Multiple source types: peer-reviewed, professional, institutional\\n- Full integration with Obsidian linking and tagging systems\\n- Research-grade analysis suitable for academic or professional publication`,reasoningPrompt:`### Advanced Logical Reasoning Framework for Obsidian Knowledge Systems\\n\\nYou are a critical thinking expert with exceptional analytical capabilities. Conduct systematic logical analysis optimized for Obsidian's knowledge management features.\\n\\n**Reasoning Task:** \\"{query}\\"\\n\\n## \u{1F3AF} Objective Definition\\n**Primary Goal**: Deconstruct the query, evaluate evidence, and synthesize a logically sound conclusion.\\n**Key Questions**:\\n1. What are the core assumptions?\\n2. What is the quality of evidence?\\n3. What are the potential biases?\\n4. What are the logical implications?\\n\\n## \u{1F4DA} Evidence Deconstruction\\n\\n### Premise Identification\\n- **Premise 1**: [Statement] - (Source: [^1], Confidence: [High/Medium/Low])\\n- **Premise 2**: [Statement] - (Source: [^2], Confidence: [High/Medium/Low])\\n- **Premise 3**: [Statement] - (Source: [^3], Confidence: [High/Medium/Low])\\n\\n### Evidence Evaluation\\n- **Source Credibility**: Assessment of author, publication, and potential conflicts of interest [^4][^5]\\n- **Data Validity**: Methodological rigor, sample size, and statistical significance [^6][^7]\\n- **Logical Soundness**: Coherence and consistency of arguments [^8]\\n\\n## \u{1F9E0} Cognitive Bias Analysis\\n\\n### Potential Biases Detected\\n- **Confirmation Bias**: Tendency to favor information confirming existing beliefs [^9][^10]\\n- **Anchoring Bias**: Over-reliance on initial information [^11]\\n- **Availability Heuristic**: Overestimating importance of easily recalled information [^12]\\n- **Selection Bias**: Non-random sampling leading to skewed conclusions [^13]\\n\\n### Mitigation Strategies\\n- **Seeking Disconfirming Evidence**: Actively looking for data that challenges the premises [^14]\\n- **Considering Alternative Perspectives**: Exploring different viewpoints and frameworks [^15]\\n- **Blinding and Control Groups**: Methodological approaches to reduce bias in data collection [^16]\\n\\n## \u26D3\uFE0F Logical Inference and Synthesis\\n\\n### Argument Mapping\\n- **Logical Chain 1**: [Premise 1] + [Premise 2] -> [Intermediate Conclusion A] [^17]\\n- **Logical Chain 2**: [Intermediate Conclusion A] + [Premise 3] -> [Final Conclusion B] [^18]\\n\\n### Hypothesis Testing\\n- **Hypothesis H1**: [Statement] - (Supporting Evidence: [^19], Contradicting Evidence: [^20])\\n- **Hypothesis H2**: [Statement] - (Supporting Evidence: [^21], Contradicting Evidence: [^22])\\n\\n### Synthesis of Conclusions\\n- **Primary Conclusion**: [Synthesized statement] with [Confidence Level]\\n- **Secondary Conclusion**: [Alternative or nuanced finding]\\n- **Unresolved Issues**: [Questions requiring further analysis]\\n\\n## \u2696\uFE0F Uncertainty and Limitation Assessment\\n\\n### Quantifying Uncertainty\\n- **Confidence Intervals**: Statistical range of plausible values [^23]\\n- **Sensitivity Analysis**: Impact of changing key assumptions [^24]\\n- **Scenario Planning**: Exploring outcomes under different conditions [^25]\\n\\n### Acknowledged Limitations\\n- **Data Gaps**: Information that is unavailable or incomplete [^26]\\n- **Methodological Constraints**: Limitations of the research design [^27]\\n- **Scope Boundaries**: What is not covered by this analysis [^28]\\n\\n## \u{1F517} Knowledge Integration for Obsidian\\n\\n**Actionable Insights**:\\n- **Decision Point**: [Key decision this analysis informs]\\n- **Next Steps**: [Recommended actions based on conclusions]\\n\\n**Vault Connections**:\\n- **Create Notes**: [[Logical Deconstruction]], [[Bias Mitigation Strategies]], [[Evidence Evaluation Checklist]]\\n- **Link to Notes**: [[Critical Thinking]], [[Mental Models]], [[Argument Mapping]]\\n- **Tags**: #reasoning #logic #critical-thinking #[topic-specific]\\n\\n---\\n### Bibliography and Evidence Base\\n[^1]: Source for Premise 1\\n[^2]: Source for Premise 2\\n[^3]: Source for Premise 3\\n[^4]: Credibility assessment source\\n[^5]: Conflict of interest documentation\\n[^6]: Methodological review source\\n[^7]: Statistical analysis documentation\\n[^8]: Logical soundness evaluation\\n[^9]: Confirmation bias research\\n[^10]: Disconfirming evidence source\\n[^11]: Anchoring bias study\\n[^12]: Availability heuristic research\\n[^13]: Selection bias analysis\\n[^14]: Disconfirming evidence strategy source\\n[^15]: Alternative perspectives documentation\\n[^16]: Control group methodology source\\n[^17]: Logical chain 1 evidence\\n[^18]: Logical chain 2 evidence\\n[^19]: Hypothesis H1 support\\n[^20]: Hypothesis H1 contradiction\\n[^21]: Hypothesis H2 support\\n[^22]: Hypothesis H2 contradiction\\n[^23]: Confidence interval data source\\n[^24]: Sensitivity analysis report\\n[^25]: Scenario planning documentation\\n[^26]: Data gap analysis\\n[^27]: Methodological constraint source\\n[^28]: Scope definition document\\n\\n**Reasoning Standards**:\\n- 1000-1300 words with complete logical documentation\\n- Minimum 28 citations supporting the reasoning process\\n- Systematic bias detection and uncertainty quantification\\n- Full integration with Obsidian knowledge management features\\n- Professional-grade logical analysis suitable for strategic decision-making`,youtubePrompt:`### Comprehensive YouTube Video Analysis for Obsidian\\n\\n**Video URL:** {url}\\n\\nYou are a media analysis expert creating comprehensive video documentation for academic and professional knowledge management.\\n\\n## \u{1F4FA} Video Documentation Framework\\n\\n### Basic Information\\n**Title**: [Extract video title]\\n**Creator/Channel**: [Channel name and credentials]\\n**Duration**: [Video length]\\n**Upload Date**: [Publication date]\\n**URL**: [Video URL] [^1]\\n\\n### Content Analysis Structure\\n\\n## \u{1F3AF} Executive Summary\\nBrief overview of video's main purpose and key value (2-3 sentences)\\n\\n## \u{1F4DA} Content Breakdown\\n\\n### Primary Topics Covered\\n1. **Topic 1**: Key points and insights [^2]\\n2. **Topic 2**: Supporting arguments and evidence [^3]\\n3. **Topic 3**: Practical applications discussed [^4]\\n\\n### Key Insights and Data\\n- **Important Statistic/Claim 1**: [Quote with timestamp] [^5]\\n- **Important Statistic/Claim 2**: [Quote with timestamp] [^6]\\n- **Important Statistic/Claim 3**: [Quote with timestamp] [^7]\\n\\n### Notable Quotes\\n> \\"Significant quote 1\\" - [Speaker name, timestamp] [^8]\\n> \\"Significant quote 2\\" - [Speaker name, timestamp] [^9]\\n\\n## \u{1F50D} Critical Evaluation\\n\\n### Credibility Assessment\\n- **Speaker Credentials**: [Qualifications and expertise] [^10]\\n- **Source Quality**: [Evidence quality and citations used] [^11]\\n- **Bias Considerations**: [Potential limitations or perspectives] [^12]\\n\\n### Educational Value\\n- **Target Audience**: [Who benefits most from this content]\\n- **Learning Outcomes**: [What viewers should understand]\\n- **Practical Applications**: [How to apply the information]\\n\\n## \u{1F310} Related Resources\\nFor additional context and verification:\\n- [Primary Source/Research](https://example.com) - Original research mentioned\\n- [Expert Analysis](https://example.com) - Related expert commentary\\n- [Institutional Resource](https://example.com) - Official documentation\\n\\n## \u{1F517} Knowledge Vault Integration\\n**Suggested Internal Links**: [[Video Analysis Method]], [[Research Methodology]], [[Topic Category]]\\n**Recommended Tags**: #video-analysis #[topic-specific] #[creator-name] #research\\n**Related Notes**: Consider creating [[Follow-up Research]] and [[Implementation Plan]]\\n\\n---\\n### Video Citations and References\\n[^1]: Video Source: [Creator Name]. \\"[Video Title].\\" YouTube, [Upload Date]. {url}\\n[^2]: Reference for Topic 1 information - timestamp or external source\\n[^3]: Reference for Topic 2 content - timestamp or supporting research\\n[^4]: Reference for Topic 3 applications - timestamp or related documentation\\n[^5]: Timestamp reference for statistic/claim 1 - [mm:ss format]\\n[^6]: Timestamp reference for statistic/claim 2 - [mm:ss format]\\n[^7]: Timestamp reference for statistic/claim 3 - [mm:ss format]\\n[^8]: Quote reference with exact timestamp - [mm:ss format]\\n[^9]: Quote reference with exact timestamp - [mm:ss format]\\n[^10]: Speaker credential source - website, LinkedIn, or institutional affiliation\\n[^11]: Source quality documentation - research papers, data sources referenced\\n[^12]: Bias analysis source - independent evaluation or comparative analysis\\n\\n**Analysis Standards:**\\n- 600-800 words with comprehensive video documentation\\n- Minimum 12 citations including timestamps and external sources\\n- Full Obsidian compatibility with internal linking\\n- Professional media analysis suitable for academic reference\\n- Include actionable insights and practical applications\\n\\nPlease analyze the video thoroughly and provide detailed documentation.`,providerSearchModes:{gemini:!0,perplexity:!0,tavily:!0,exa:!0},contextMemoryEnabled:!0,maxContextMessages:10,contextMemoryStrategy:"recent",configurationPresets:{QuickFactCheck:{description:"Fast, concise answers for quick verification.",modeName:"quick",provider:"perplexity",parameters:{temperature:.2,max_tokens:500,search_recency_filter:"day"}},DeepDiveAnalysis:{description:"In-depth academic research for detailed papers.",modeName:"deep",provider:"gemini",parameters:{temperature:.8,topP:.9,maxOutputTokens:4e3}},CreativeBrainstorming:{description:"Generate creative ideas and outlines.",modeName:"comprehensive",provider:"gemini",parameters:{temperature:1.2,topP:.95}}},uiPreferences:{showAdvancedSettings:!1,showParameterTooltips:!0,autoSaveSettings:!0,showPerformanceMetrics:!1,compactMode:!1},researchModeModels:{quick:"gemini-2.5-flash-lite",comprehensive:"gemini-2.5-flash",deep:"gemini-2.5-pro",reasoning:"gemini-2.5-pro",youtube:"gemini-2.5-pro"}},A="gemini-chat-view",P=class extends p.Plugin{getCurrentResearchMode(){var e,s;try{let n=(s=(e=this.app.workspace.getLeavesOfType(A))==null?void 0:e[0])==null?void 0:s.view,i=n==null?void 0:n.currentResearchMode;return i&&_.validateResearchMode(i.id)?i.id:"comprehensive"}catch(n){return C.getInstance().warn("Failed to get current research mode, using default",n),"comprehensive"}}async onload(){let e=C.getInstance(),s=E.getInstance(),n="plugin-load";try{e.info("Plugin loading started"),s.startTimer(n),await this.loadSettings(),this.injectEnhancedCSS(),this.registerView(A,r=>new T(r,this)),this.addRibbonIcon("message-circle","Open AI Web Search Chat",()=>{this.activateView()}),this.addCommand({id:"gemini-web-search-selection",name:"Search Web for Selected Text",editorCallback:async(r,c)=>{let o=r.getSelection();o?await this.searchWeb(o,"replace"):new p.Notice("Please select some text first")}}),this.addCommand({id:"gemini-web-search-append",name:"Search Web for Selected Text (Append)",editorCallback:async(r,c)=>{let o=r.getSelection();o?await this.searchWeb(o,"append"):new p.Notice("Please select some text first")}}),this.addCommand({id:"open-ai-chat",name:"Open AI Web Search Chat",callback:()=>{this.activateView()}}),this.addCommand({id:"gemini-web-search-prompt",name:"AI Web Search: Custom query",editorCallback:(r,c)=>{this.promptForCustomSearch(r)}}),this.addCommand({id:"gemini-new-chat",name:"AI Web Search: Start New Chat",callback:()=>{this.activateView().then(()=>{var c;let r=(c=this.app.workspace.getLeavesOfType(A)[0])==null?void 0:c.view;r&&r.clearChat()})}}),this.addCommand({id:"test-perplexity-api",name:"AI Web Search: Test Perplexity API",callback:async()=>{await this.testPerplexityAPI()}}),this.addRibbonIcon("search","AI Web Search",()=>{this.showSearchModal()}),this.addSettingTab(new N(this.app,this));let i=s.endTimer(n);e.info(`Plugin loaded successfully in ${i}ms`)}catch(i){e.error("Plugin loading failed",i),new p.Notice(`AI Web Search Plugin failed to load: ${i}`)}}async loadSettings(){this.settings=Object.assign({},X,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}showSearchModal(){new B(this.app,this).open()}async activateView(){let{workspace:e}=this.app,s=null,n=e.getLeavesOfType(A);n.length>0?s=n[0]:(s=e.getRightLeaf(!1),s&&await s.setViewState({type:A,active:!0})),s&&e.revealLeaf(s)}async performWebSearch(e){let s=C.getInstance(),n=E.getInstance(),i=`web-search-${this.settings.provider}-${Date.now()}`;try{if(n.startTimer(i),s.debug("Starting web search",{provider:this.settings.provider,query:_.sanitizeInput(e).substring(0,100)+"..."}),!_.validateQuery(e))throw new Error("Invalid search query provided");if(!_.validateProvider(this.settings.provider))throw new Error(`Invalid provider: ${this.settings.provider}`);let r;switch(this.settings.provider){case"gemini":r=await this.searchWithGemini(e);break;case"perplexity":r=await this.searchWithPerplexity(e);break;case"tavily":r=await this.searchWithTavily(e);break;case"exa":r=await this.searchWithExa(e);break;default:throw new Error(`Invalid provider: ${this.settings.provider}`)}let c=n.endTimer(i);return n.logMetrics("web-search",c,{provider:this.settings.provider,queryLength:e.length,resultLength:r.length}),r}catch(r){n.endTimer(i),s.error("Web search failed",r);let c=r instanceof Error?r.message:String(r);return`Search failed for: "${e}"

Error: ${c}

Please check your API configuration and try again.`}}async performGeminiChat(e,s){var r,c,o,t;if(!this.settings.geminiApiKey)throw new Error("Gemini API key not configured");let n=C.getInstance();n.debug("Starting Gemini chat",{query:e,historyLength:s.length});let i=[];s.forEach(a=>{i.push({role:a.role==="user"?"user":"model",parts:[{text:a.content}]})}),i.push({role:"user",parts:[{text:e}]});try{let l=(await(0,p.requestUrl)({url:`https://generativelanguage.googleapis.com/v1beta/models/${this.settings.geminiModel}:generateContent`,method:"POST",headers:{"Content-Type":"application/json","x-goog-api-key":this.settings.geminiApiKey},body:JSON.stringify({contents:i,generationConfig:{temperature:.7,maxOutputTokens:2048,topP:.8,topK:40}})})).json;if(l.candidates&&((t=(o=(c=(r=l.candidates[0])==null?void 0:r.content)==null?void 0:c.parts)==null?void 0:o[0])!=null&&t.text))return l.candidates[0].content.parts[0].text;throw new Error("No valid response from Gemini API")}catch(a){n.error("Gemini chat failed",a);let l=a instanceof Error?a.message:String(a);throw new Error(`Gemini chat failed: ${l}`)}}async performPerplexityChat(e,s){var c,o;if(!this.settings.perplexityApiKey)throw new Error("Perplexity API key not configured");let n=C.getInstance();n.debug("Starting Perplexity chat",{query:e,historyLength:s.length});let i=[];s.forEach(t=>{i.push({role:t.role,content:t.content})}),i.push({role:"user",content:e});let r={model:this.settings.perplexityModel,messages:i,temperature:this.settings.perplexityTemperature,max_tokens:this.settings.perplexityMaxTokens,top_p:this.settings.perplexityTopP,top_k:this.settings.perplexityTopK,frequency_penalty:this.settings.perplexityFrequencyPenalty,presence_penalty:this.settings.perplexityPresencePenalty};try{let a=(await(0,p.requestUrl)({url:"https://api.perplexity.ai/chat/completions",method:"POST",headers:{Authorization:`Bearer ${this.settings.perplexityApiKey}`,"Content-Type":"application/json"},body:JSON.stringify(r)})).json;if(a.choices&&((o=(c=a.choices[0])==null?void 0:c.message)!=null&&o.content))return a.choices[0].message.content;throw new Error("No valid response from Perplexity API")}catch(t){n.error("Perplexity chat failed",t);let a=t instanceof Error?t.message:String(t);throw new Error(`Perplexity chat failed: ${a}`)}}async searchWithGemini(e){var r,c,o;let s=C.getInstance(),n=E.getInstance(),i=`gemini-search-${Date.now()}`;try{if(n.startTimer(i),s.debug("Starting Gemini search",{queryLength:e.length}),!_.validateApiKey(this.settings.geminiApiKey))throw new Error("Gemini API key not configured or invalid");let t=(r=this.app.workspace.getLeavesOfType(A)[0])==null?void 0:r.view,a=t==null?void 0:t.currentResearchMode,l=this.settings.researchModeConfigs.comprehensive.geminiParams;if(a&&_.validateResearchMode(a.id))switch(a.id){case"quick":l=this.settings.researchModeConfigs.quick.geminiParams;break;case"comprehensive":l=this.settings.researchModeConfigs.comprehensive.geminiParams;break;case"deep":l=this.settings.researchModeConfigs.deep.geminiParams;break;case"reasoning":l=this.settings.researchModeConfigs.reasoning.geminiParams;break;case"youtube":l=this.settings.researchModeConfigs.youtube.geminiParams;break}let d=e;if(this.settings.enableCustomPrompts&&a)switch(a.id){case"quick":d=this.settings.quickPrompt.replace("{query}",e);break;case"comprehensive":d=this.settings.comprehensivePrompt.replace("{query}",e);break;case"deep":d=this.settings.deepPrompt.replace("{query}",e);break;case"reasoning":d=this.settings.reasoningPrompt.replace("{query}",e);break;case"youtube":d=`Analyze this YouTube video and provide a comprehensive summary and insights: ${e}`;break;default:d=this.settings.comprehensivePrompt.replace("{query}",e)}else if(a)switch(a.id){case"quick":d=`### Task: Provide Quick and Accurate Response

You are a domain expert with extensive knowledge. Please answer the following question concisely and accurately:

**Question:** "${e}"

**Output Requirements:**
- Provide direct and concise answers (2-3 sentences maximum)
- Focus on the 2-3 most important points
- Use clear, easy-to-understand language
- If uncertain, state "Need more information to provide accurate answer"

**Format:** Direct answer without lengthy explanations.`;break;case"comprehensive":d=`### Framework: Comprehensive Analysis

**Task:** Comprehensive analysis of the topic: "${e}"

**Response Structure:**
1. **Overview** (2-3 introductory sentences)
2. **Key Aspects** (3-4 important dimensions)
3. **Context and Applications** (why this matters)
4. **Concrete Examples** (1-2 illustrative cases)
5. **Conclusions and Future Directions**

**Requirements:** 400-600 words, professional but accessible, cite sources when available.`;break;case"deep":d=`### Framework: Deep Research

**Task:** In-depth research on: "${e}"

**Analysis includes:**
1. **Foundation Analysis** - History, origins, definitions
2. **Current Landscape** - Present state, trends  
3. **Multiple Perspectives** - Views from different fields
4. **Deep Analysis** - Causes, effects, interconnections
5. **Future Implications** - Projected impacts, practical applications
6. **Critical Assessment** - Strengths, limitations, controversies

**Requirements:** 800-1200 words, comprehensive and insightful perspective, clear structure.`;break;case"reasoning":d=`### Framework: Logical Reasoning

**Analysis Task:** "${e}"

**Thinking Process:**
1. **Problem Decomposition** - Identify core components
2. **Multi-dimensional Analysis** - Logic, context, different perspectives
3. **Evidence Evaluation** - Categorize reliability levels
4. **Synthetic Reasoning** - Logic chain and alternative hypotheses
5. **Structured Conclusion** - Conclusion, confidence level, limitations

**Requirements:** Critical thinking, excellent logical analysis, self-check for logical gaps.`;break;case"youtube":d=`### YouTube Video Analysis for Obsidian Knowledge Management

**Video URL:** ${e}

You are a media analysis expert creating comprehensive video documentation for academic and professional knowledge management.

## \u{1F4FA} Video Documentation Framework

### Basic Information
**Title**: [Extract video title]  
**Creator/Channel**: [Channel name and credentials]  
**Duration**: [Video length]  
**Upload Date**: [Publication date]  
**URL**: [Video URL] [^1]

### Content Analysis Structure

## \u{1F3AF} Executive Summary
Brief overview of video's main purpose and key value (2-3 sentences)

## \u{1F4DA} Content Breakdown

### Primary Topics Covered
1. **Topic 1**: Key points and insights [^2]
2. **Topic 2**: Supporting arguments and evidence [^3]  
3. **Topic 3**: Practical applications discussed [^4]

### Key Insights and Data
- **Important Statistic/Claim 1**: [Quote with timestamp] [^5]
- **Important Statistic/Claim 2**: [Quote with timestamp] [^6]
- **Important Statistic/Claim 3**: [Quote with timestamp] [^7]

### Notable Quotes
> "Significant quote 1" - [Speaker name, timestamp] [^8]
> "Significant quote 2" - [Speaker name, timestamp] [^9]

## \u{1F50D} Critical Evaluation

### Credibility Assessment
- **Speaker Credentials**: [Qualifications and expertise] [^10]
- **Source Quality**: [Evidence quality and citations used] [^11]
- **Bias Considerations**: [Potential limitations or perspectives] [^12]

### Educational Value
- **Target Audience**: [Who benefits most from this content]
- **Learning Outcomes**: [What viewers should understand]
- **Practical Applications**: [How to apply the information]

## \u{1F310} Related Resources
For additional context and verification:
- [Primary Source/Research](https://example.com) - Original research mentioned
- [Expert Analysis](https://example.com) - Related expert commentary  
- [Institutional Resource](https://example.com) - Official documentation

## \u{1F517} Knowledge Vault Integration
**Suggested Internal Links**: [[Video Analysis Method]], [[Research Methodology]], [[Topic Category]]  
**Recommended Tags**: #video-analysis #[topic-specific] #[creator-name] #research  
**Related Notes**: Consider creating [[Follow-up Research]] and [[Implementation Plan]]

---
### Video Citations and References
[^1]: Video Source: [Creator Name]. "[Video Title]." YouTube, [Upload Date]. [Full URL]
[^2]: Reference for Topic 1 information - timestamp or external source
[^3]: Reference for Topic 2 content - timestamp or supporting research
[^4]: Reference for Topic 3 applications - timestamp or related documentation
[^5]: Timestamp reference for statistic/claim 1 - [mm:ss format]
[^6]: Timestamp reference for statistic/claim 2 - [mm:ss format]  
[^7]: Timestamp reference for statistic/claim 3 - [mm:ss format]
[^8]: Quote reference with exact timestamp - [mm:ss format]
[^9]: Quote reference with exact timestamp - [mm:ss format]
[^10]: Speaker credential source - website, LinkedIn, or institutional affiliation
[^11]: Source quality documentation - research papers, data sources referenced
[^12]: Bias analysis source - independent evaluation or comparative analysis

**Analysis Standards:**
- 600-800 words with comprehensive video documentation
- Minimum 12 citations including timestamps and external sources
- Full Obsidian compatibility with internal linking
- Professional media analysis suitable for academic reference
- Include actionable insights and practical applications`;break;default:d=`Please provide comprehensive analysis on: "${e}" with accurate information and reliable sources.`}let g=`https://generativelanguage.googleapis.com/v1beta/models/${this.settings.geminiModel}:generateContent?key=${this.settings.geminiApiKey}`,u;if((a==null?void 0:a.id)==="youtube"&&(t!=null&&t.getVideoContext())){let k=t.getVideoContext();if(!k)return"Error: No video context available";let S=k.url;u={contents:[{parts:[{text:t.isValidYouTubeUrl(e)?d:`Based on the YouTube video at ${S}, please answer this question: "${e}"

**Context:** You are analyzing the video content to provide a specific answer.
**Requirements:** 
- Focus on answering the specific question asked
- Reference relevant parts of the video content
- Provide accurate and detailed information
- Include timestamps or specific examples when relevant`},{fileData:{mimeType:"video/*",fileUri:S}}]}],generationConfig:{temperature:l.temperature,topP:l.topP,topK:l.topK,maxOutputTokens:l.maxOutputTokens}}}else u={contents:[{parts:[{text:d}]}],tools:[{google_search:{}}],generationConfig:{temperature:l.temperature,topP:l.topP,topK:l.topK,maxOutputTokens:l.maxOutputTokens}};let v=(c=(await(0,p.requestUrl)({url:g,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).json.candidates)==null?void 0:c[0];if(!v)throw new Error("No response from Gemini");let w=v.content.parts[0].text;if((o=v.groundingMetadata)!=null&&o.groundingChunks){w+=`

--- 
**Sources:**
`;let k=new Set;v.groundingMetadata.groundingChunks.forEach(S=>{var O;(O=S.web)!=null&&O.uri&&k.add(`- [${S.web.title||S.web.uri}](${S.web.uri})`)}),w+=Array.from(k).join(`
`)}let R=n.endTimer(i);return n.logMetrics("gemini-search",R,{queryLength:e.length,resultLength:w.length,researchMode:a==null?void 0:a.id}),w}catch(t){n.endTimer(i),s.error("Gemini search failed",t);let a=t instanceof Error?t.message:String(t);throw new Error(`Gemini search failed: ${a}`)}}async searchWeb(e,s){try{let n;switch(this.settings.provider){case"gemini":n=await this.searchWithGemini(e);break;case"perplexity":n=await this.searchWithPerplexity(e);break;case"tavily":n=await this.searchWithTavily(e);break;case"exa":n=await this.searchWithExa(e);break;default:throw new Error(`Unknown provider: ${this.settings.provider}`)}this.insertResult(n,s)}catch(n){new p.Notice(`Search failed: ${n.message}`)}}async searchWithPerplexity(e){var r,c;if(!this.settings.perplexityApiKey)throw new Error("Perplexity API key not configured");let s=C.getInstance(),n=E.getInstance(),i=`perplexity-search-${Date.now()}`;try{n.startTimer(i),s.debug("Starting Perplexity search",{query:e});let o=this.getCurrentResearchMode(),t,a;o==="youtube"?(t=this.settings.researchModeConfigs.comprehensive.perplexityParams,a=this.settings.researchModeConfigs.comprehensive.perplexityModel):(t=this.settings.researchModeConfigs[o].perplexityParams,a=this.settings.researchModeConfigs[o].perplexityModel);let l={model:a,messages:[{role:"user",content:e}],temperature:t.temperature,max_tokens:t.max_tokens,top_p:t.top_p,top_k:t.top_k,frequency_penalty:t.frequency_penalty,presence_penalty:t.presence_penalty,stream:!1,search_domain_filter:t.search_domain_filter.length>0?t.search_domain_filter:void 0,search_recency_filter:t.search_recency_filter,return_related_questions:t.return_related_questions,return_citations:t.return_citations,return_images:t.return_images};Object.keys(l).forEach(h=>{l[h]===void 0&&delete l[h]}),s.debug("Perplexity API request",{model:a,params:l});let d=await(0,p.requestUrl)({url:"https://api.perplexity.ai/chat/completions",method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.settings.perplexityApiKey}`},body:JSON.stringify(l)}),g=n.endTimer(i);if(n.logMetrics("Perplexity Search",g,{queryLength:e.length,model:a,maxTokens:t.max_tokens}),d.status!==200)throw new Error(`Perplexity API error: ${d.status} - ${d.text}`);let u=d.json;s.debug("Perplexity search results received",{choices:((r=u.choices)==null?void 0:r.length)||0,model:u.model});let m=`# Perplexity Search Results

**Query:** ${e}

`;if(m+=`**Model:** ${u.model||a}

`,u.choices&&u.choices.length>0){let h=u.choices[0];h.message&&h.message.content&&(m+=`## AI Response

${h.message.content}

`),h.citations&&h.citations.length>0&&(m+=`## Sources

`,h.citations.forEach((v,w)=>{m+=`${w+1}. [${v.title||v.url}](${v.url})
`}),m+=`
`),h.related_questions&&h.related_questions.length>0&&(m+=`## Related Questions

`,h.related_questions.forEach(v=>{m+=`- ${v}
`}),m+=`
`)}return u.usage&&(m+=`## Usage Statistics

`,m+=`- **Prompt Tokens:** ${u.usage.prompt_tokens||"N/A"}
`,m+=`- **Completion Tokens:** ${u.usage.completion_tokens||"N/A"}
`,m+=`- **Total Tokens:** ${u.usage.total_tokens||"N/A"}

`),m+=`
---
*Search performed using Perplexity API (${a}) on ${new Date().toISOString()}*
`,s.info("Perplexity search completed successfully",{duration:g,model:u.model,tokensUsed:((c=u.usage)==null?void 0:c.total_tokens)||0}),m}catch(o){let t=n.endTimer(i);throw s.error("Perplexity search failed",o),n.logMetrics("Perplexity Search (Failed)",t,{error:o.message,queryLength:e.length}),new Error(`Perplexity search failed: ${o.message}`)}}async searchWithTavily(e){var r,c;if(!this.settings.tavilyApiKey)throw new Error("Tavily API key not configured");let s=C.getInstance(),n=E.getInstance(),i=`tavily-search-${Date.now()}`;try{n.startTimer(i),s.debug("Starting Tavily search",{query:e});let o={api_key:this.settings.tavilyApiKey,query:e,search_depth:this.settings.tavilySearchDepth,include_answer:this.settings.tavilyIncludeAnswer,include_images:this.settings.tavilyIncludeImages,include_raw_content:this.settings.tavilyIncludeRawContent,max_results:this.settings.tavilyMaxResults,include_domains:this.settings.tavilyIncludeDomains?this.settings.tavilyIncludeDomains.split(",").map(g=>g.trim()):void 0,exclude_domains:this.settings.tavilyExcludeDomains?this.settings.tavilyExcludeDomains.split(",").map(g=>g.trim()):void 0,topic:this.settings.tavilyTopic,days:this.settings.tavilyDays};Object.keys(o).forEach(g=>{o[g]===void 0&&delete o[g]}),s.debug("Tavily API request body",o);let t=await(0,p.requestUrl)({url:"https://api.tavily.com/search",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),a=n.endTimer(i);if(n.logMetrics("Tavily Search",a,{queryLength:e.length,maxResults:this.settings.tavilyMaxResults,searchDepth:this.settings.tavilySearchDepth}),t.status!==200)throw new Error(`Tavily API error: ${t.status} - ${t.text}`);let l=t.json;s.debug("Tavily search results received",{resultsCount:((r=l.results)==null?void 0:r.length)||0,hasAnswer:!!l.answer});let d=`# Tavily Search Results

**Query:** ${e}

`;return l.answer&&(d+=`## AI Summary

${l.answer}

`),l.results&&l.results.length>0&&(d+=`## Search Results

`,l.results.forEach((g,u)=>{d+=`### ${u+1}. ${g.title}

`,g.url&&(d+=`**URL:** [${g.url}](${g.url})

`),g.content&&(d+=`**Content:** ${g.content}

`),g.score&&(d+=`**Relevance Score:** ${(g.score*100).toFixed(1)}%

`),d+=`---

`})),this.settings.tavilyIncludeImages&&l.images&&l.images.length>0&&(d+=`## Related Images

`,l.images.forEach((g,u)=>{g.url&&(d+=`![Image ${u+1}](${g.url})

`)})),d+=`
---
*Search performed using Tavily API on ${new Date().toISOString()}*
`,s.info("Tavily search completed successfully",{resultsCount:((c=l.results)==null?void 0:c.length)||0,duration:a}),d}catch(o){let t=n.endTimer(i);throw s.error("Tavily search failed",o),n.logMetrics("Tavily Search (Failed)",t,{error:o.message,queryLength:e.length}),new Error(`Tavily search failed: ${o.message}`)}}async searchWithExa(e){var r,c,o;if(!this.settings.exaApiKey)throw new Error("Exa API key not configured");let s=C.getInstance(),n=E.getInstance(),i=`exa-search-${Date.now()}`;try{n.startTimer(i),s.debug("Starting Exa search",{query:e});let t={query:e,type:this.settings.exaSearchType,numResults:this.settings.exaNumResults,includeDomains:this.settings.exaIncludeDomains?this.settings.exaIncludeDomains.split(",").map(u=>u.trim()):void 0,excludeDomains:this.settings.exaExcludeDomains?this.settings.exaExcludeDomains.split(",").map(u=>u.trim()):void 0,startCrawlDate:this.settings.exaStartCrawlDate||void 0,endCrawlDate:this.settings.exaEndCrawlDate||void 0,startPublishedDate:this.settings.exaStartPublishedDate||void 0,endPublishedDate:this.settings.exaEndPublishedDate||void 0,category:this.settings.exaCategory||void 0,useAutoprompt:this.settings.exaUseAutoprompt,contents:{text:this.settings.exaIncludeText,highlights:this.settings.exaIncludeHighlights}};Object.keys(t).forEach(u=>{t[u]===void 0&&delete t[u]}),t.contents&&(Object.keys(t.contents).forEach(u=>{t.contents[u]===void 0&&delete t.contents[u]}),Object.keys(t.contents).length===0&&delete t.contents),s.debug("Exa API request body",t);let a=await(0,p.requestUrl)({url:"https://api.exa.ai/search",method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.settings.exaApiKey},body:JSON.stringify(t)}),l=n.endTimer(i);if(n.logMetrics("Exa Search",l,{queryLength:e.length,numResults:this.settings.exaParams.numResults,searchType:this.settings.exaParams.type}),a.status!==200)throw new Error(`Exa API error: ${a.status} - ${a.text}`);let d=a.json;s.debug("Exa search results received",{resultsCount:((r=d.results)==null?void 0:r.length)||0,searchType:d.resolvedSearchType});let g=`# Exa Search Results

**Query:** ${e}

`;return d.resolvedSearchType&&(g+=`**Search Type:** ${d.resolvedSearchType}

`),d.context&&(g+=`## AI Context Summary

${d.context}

`),d.results&&d.results.length>0&&(g+=`## Search Results

`,d.results.forEach((u,m)=>{if(g+=`### ${m+1}. ${u.title}

`,u.url&&(g+=`**URL:** [${u.url}](${u.url})

`),u.author&&(g+=`**Author:** ${u.author}

`),u.publishedDate){let h=new Date(u.publishedDate).toLocaleDateString();g+=`**Published:** ${h}

`}u.score&&(g+=`**Relevance Score:** ${(u.score*100).toFixed(1)}%

`),u.text&&(g+=`**Content:**
${u.text}

`),u.highlights&&u.highlights.length>0&&(g+=`**Key Highlights:**
`,u.highlights.forEach(h=>{g+=`- ${h}
`}),g+=`
`),u.summary&&(g+=`**Summary:** ${u.summary}

`),u.subpages&&u.subpages.length>0&&(g+=`**Related Pages:**
`,u.subpages.slice(0,3).forEach(h=>{g+=`- [${h.title}](${h.url})
`}),g+=`
`),g+=`---

`})),d.costDollars&&(g+=`## Search Cost

`,g+=`**Total Cost:** $${d.costDollars.total}

`),g+=`
---
*Search performed using Exa API on ${new Date().toISOString()}*
`,s.info("Exa search completed successfully",{resultsCount:((c=d.results)==null?void 0:c.length)||0,duration:l,cost:((o=d.costDollars)==null?void 0:o.total)||0}),g}catch(t){let a=n.endTimer(i);throw s.error("Exa search failed",t),n.logMetrics("Exa Search (Failed)",a,{error:t.message,queryLength:e.length}),new Error(`Exa search failed: ${t.message}`)}}insertResult(e,s){let n=this.app.workspace.getActiveViewOfType(p.MarkdownView);if(!n){new p.Notice("No active markdown view");return}let i=n.editor;if(s==="replace")i.replaceSelection(e);else{let r=i.getCursor();i.replaceRange(`

`+e,r)}}promptForCustomSearch(e){let s=prompt("Enter your search query:");s&&this.searchWeb(s,"append")}async testPerplexityAPI(){try{let e=await this.searchWithPerplexity("test query");new p.Notice("Perplexity API test successful"),console.log("Perplexity test result:",e)}catch(e){new p.Notice(`Perplexity API test failed: ${e.message}`),console.error("Perplexity test error:",e)}}injectEnhancedCSS(){let e=`
		/* Enhanced Settings CSS for AI Web Search Plugin */
		.gemini-settings-container {
			font-family: var(--font-interface);
			line-height: var(--line-height-normal);
		}
		
		/* Chat Container - Responsive and Theme-aware */
		.gemini-chat-container {
			display: flex;
			flex-direction: column;
			height: 100%;
			background: var(--background-primary);
			color: var(--text-normal);
			font-family: var(--font-interface);
		}
		
		/* Chat Header - Mobile-responsive */
		.gemini-chat-header {
			padding: var(--size-4-2) var(--size-4-3);
			border-bottom: 1px solid var(--background-modifier-border);
			background: var(--background-secondary);
			flex-shrink: 0;
		}
		
		.title-container {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: var(--size-4-1);
			flex-wrap: wrap;
			gap: var(--size-4-1);
		}
		
		.title-container h3 {
			margin: 0;
			font-size: var(--font-ui-medium);
			font-weight: var(--font-weight-medium);
			color: var(--text-normal);
		}
		
		/* New Chat Button - Touch-friendly */
		.new-chat-button {
			display: flex;
			align-items: center;
			gap: var(--size-2-1);
			padding: var(--size-2-1) var(--size-4-1);
			background: var(--interactive-accent);
			color: var(--text-on-accent);
			border: none;
			border-radius: var(--radius-s);
			cursor: pointer;
			font-size: var(--font-ui-small);
			font-weight: var(--font-weight-medium);
			transition: all 0.2s ease;
			min-height: 32px; /* Touch-friendly minimum */
		}
		
		.new-chat-button:hover {
			background: var(--interactive-accent-hover);
			transform: translateY(-1px);
		}
		
		.new-chat-button svg {
			width: 14px;
			height: 14px;
			flex-shrink: 0;
		}
		
		/* Provider Container - Responsive */
		.provider-container {
			display: flex;
			align-items: center;
			gap: var(--size-2-2);
			flex-wrap: wrap;
		}
		
		.provider-label {
			font-size: var(--font-ui-small);
			color: var(--text-muted);
			font-weight: var(--font-weight-medium);
		}
		
		.provider-dropdown {
			padding: var(--size-2-1) var(--size-2-3);
			background: var(--background-primary);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			color: var(--text-normal);
			font-size: var(--font-ui-small);
			min-width: 160px;
			cursor: pointer;
		}
		
		.provider-dropdown:focus {
			outline: 2px solid var(--interactive-accent);
			outline-offset: 2px;
		}
		
		/* Messages Container - Responsive and scrollable */
		.gemini-chat-messages {
			flex: 1;
			overflow-y: auto;
			padding: var(--size-4-2);
			scroll-behavior: smooth;
		}
		
		/* Message Styling - Improved readability */
		.message {
			margin-bottom: var(--size-4-3);
			padding: var(--size-4-2);
			border-radius: var(--radius-m);
			word-wrap: break-word;
			line-height: var(--line-height-normal);
		}
		
		.message.user {
			background: var(--background-modifier-form-field);
			border: 1px solid var(--background-modifier-border);
			margin-left: 10%;
		}
		
		.message.assistant {
			background: var(--background-secondary);
			border: 1px solid var(--background-modifier-border);
			margin-right: 10%;
		}
		
		.message.system {
			background: var(--background-modifier-success);
			border: 1px solid var(--color-green);
			text-align: center;
			font-style: italic;
			margin: var(--size-4-1) 20%;
		}
		
		/* Message Role Headers */
		.message-role, .message-role-header {
			font-weight: var(--font-weight-bold);
			font-size: var(--font-ui-small);
			color: var(--text-accent);
			margin-bottom: var(--size-2-2);
			display: flex;
			align-items: center;
			justify-content: space-between;
		}
		
		/* Message Content - Responsive text */
		.message-content {
			font-size: max(var(--font-ui-medium), 16px); /* Minimum 16px for mobile */
			color: var(--text-normal);
			white-space: pre-wrap;
			word-break: break-word;
		}
		
		.message-content.selectable-text {
			user-select: text;
			-webkit-user-select: text;
		}
		
		/* Copy Button - Touch-friendly */
		.copy-button {
			background: var(--interactive-normal);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			padding: var(--size-2-1) var(--size-2-2);
			font-size: var(--font-ui-smaller);
			color: var(--text-muted);
			cursor: pointer;
			transition: all 0.2s ease;
			min-height: 28px;
			min-width: 60px;
		}
		
		.copy-button:hover {
			background: var(--interactive-hover);
			color: var(--text-normal);
		}
		
		/* Progress Bar - Smooth animations */
		.progress-container {
			margin: var(--size-2-2) 0;
		}
		
		.progress-bar {
			width: 100%;
			height: 4px;
			background: var(--background-modifier-border);
			border-radius: var(--radius-s);
			overflow: hidden;
		}
		
		.progress-bar-fill {
			height: 100%;
			background: var(--interactive-accent);
			transition: width 0.3s ease;
			border-radius: inherit;
		}
		
		.thinking-text {
			color: var(--text-muted);
			font-style: italic;
			margin-top: var(--size-2-2);
		}
		
		/* Input Container - Responsive and accessible */
		.gemini-chat-input-container {
			padding: var(--size-4-2);
			background: var(--background-primary);
			border-top: 1px solid var(--background-modifier-border);
			flex-shrink: 0;
		}
		
		.input-group {
			display: flex;
			flex-direction: column;
			gap: var(--size-2-3);
		}
		
		.gemini-chat-input {
			width: 100%;
			min-height: 60px;
			max-height: 200px;
			padding: var(--size-4-1) var(--size-4-2);
			background: var(--background-primary);
			border: 2px solid var(--background-modifier-border);
			border-radius: var(--radius-m);
			color: var(--text-normal);
			font-size: max(var(--font-ui-medium), 16px); /* Minimum 16px for mobile */
			font-family: var(--font-interface);
			resize: vertical;
			line-height: var(--line-height-normal);
		}
		
		.gemini-chat-input:focus {
			outline: none;
			border-color: var(--interactive-accent);
			box-shadow: 0 0 0 2px var(--interactive-accent-hover);
		}
		
		.gemini-chat-input::placeholder {
			color: var(--text-faint);
		}
		
		/* Button Group - Responsive layout */
		.button-group {
			display: flex;
			gap: var(--size-2-2);
			flex-wrap: wrap;
		}
		
		.send-button, .save-button {
			flex: 1;
			min-width: 100px;
			padding: var(--size-2-3) var(--size-4-2);
			border: none;
			border-radius: var(--radius-m);
			font-size: var(--font-ui-medium);
			font-weight: var(--font-weight-medium);
			cursor: pointer;
			transition: all 0.2s ease;
			min-height: 40px; /* Touch-friendly */
		}
		
		.send-button {
			background: var(--interactive-accent);
			color: var(--text-on-accent);
		}
		
		.send-button:hover {
			background: var(--interactive-accent-hover);
		}
		
		.save-button {
			background: var(--interactive-normal);
			color: var(--text-normal);
			border: 1px solid var(--background-modifier-border);
		}
		
		.save-button:hover {
			background: var(--interactive-hover);
		}
		
		/* Research Mode Buttons - Mobile-first responsive */
		.research-mode-container-bottom {
			margin-top: var(--size-4-2);
			padding-top: var(--size-4-1);
			border-top: 1px solid var(--background-modifier-border);
		}
		
		.research-mode-label-small {
			font-size: var(--font-ui-small);
			color: var(--text-muted);
			margin-bottom: var(--size-2-2);
			font-weight: var(--font-weight-medium);
		}
		
		.research-mode-buttons-bottom {
			display: flex;
			gap: var(--size-2-1);
			flex-wrap: wrap;
		}
		
		.research-mode-btn-small {
			flex: 1;
			min-width: calc(50% - var(--size-2-1)); /* 2 per row on mobile */
			padding: var(--size-2-1) var(--size-2-2);
			background: var(--background-secondary);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-s);
			color: var(--text-normal);
			font-size: max(var(--font-ui-small), 14px); /* Minimum readable size */
			font-weight: var(--font-weight-medium);
			cursor: pointer;
			transition: all 0.2s ease;
			text-align: center;
			min-height: 36px; /* Touch-friendly */
		}
		
		.research-mode-btn-small:hover {
			background: var(--interactive-hover);
			border-color: var(--interactive-accent);
		}
		
		.research-mode-btn-small.active {
			background: var(--interactive-accent);
			color: var(--text-on-accent);
			border-color: var(--interactive-accent);
		}
		
		/* Advanced Settings - Responsive tabs */
		.setting-section {
			margin-bottom: var(--size-4-3);
			border: 1px solid var(--background-modifier-border);
			border-radius: var(--radius-m);
			overflow: hidden;
			background: var(--background-primary);
		}
		
		.advanced-tabs-container {
			display: flex;
			border-bottom: 1px solid var(--background-modifier-border);
			overflow-x: auto;
			scrollbar-width: none;
			-ms-overflow-style: none;
		}
		
		.advanced-tabs-container::-webkit-scrollbar {
			display: none;
		}
		
		.advanced-tab {
			flex: 1;
			min-width: 100px;
			padding: var(--size-4-1) var(--size-4-2);
			background: var(--background-secondary);
			border: none;
			cursor: pointer;
			transition: all 0.2s ease;
			font-size: var(--font-ui-medium);
			color: var(--text-normal);
			white-space: nowrap;
		}
		
		.advanced-tab:hover {
			background: var(--interactive-hover);
		}
		
		.advanced-tab.active {
			background: var(--background-primary);
			border-bottom: 2px solid var(--interactive-accent);
			color: var(--text-accent);
		}
		
		.advanced-content {
			padding: var(--size-4-3);
		}
		
		.settings-help-text {
			font-size: var(--font-ui-small);
			color: var(--text-muted);
			margin-top: var(--size-2-2);
			line-height: var(--line-height-normal);
		}
		
		/* Markdown Content Styling */
		.message-content h1, .message-content h2, .message-content h3 {
			color: var(--text-normal);
			margin: var(--size-4-2) 0 var(--size-2-3) 0;
			font-weight: var(--font-weight-bold);
		}
		
		.message-content h1 { font-size: var(--font-ui-large); }
		.message-content h2 { font-size: var(--font-ui-medium); }
		.message-content h3 { font-size: var(--font-ui-medium); }
		
		.message-content p {
			margin: var(--size-2-3) 0;
			line-height: var(--line-height-normal);
		}
		
		.message-content ul, .message-content ol {
			margin: var(--size-2-3) 0;
			padding-left: var(--size-4-4);
		}
		
		.message-content li {
			margin: var(--size-2-1) 0;
			line-height: var(--line-height-normal);
		}
		
		.message-content code {
			background: var(--background-modifier-border);
			padding: var(--size-2-1) var(--size-2-2);
			border-radius: var(--radius-s);
			font-family: var(--font-monospace);
			font-size: var(--font-ui-small);
			color: var(--text-normal);
		}
		
		.message-content pre {
			background: var(--background-modifier-border);
			padding: var(--size-4-2);
			border-radius: var(--radius-m);
			overflow-x: auto;
			margin: var(--size-4-2) 0;
		}
		
		.message-content .external-link {
			color: var(--text-accent);
			text-decoration: underline;
			text-decoration-color: var(--text-accent);
		}
		
		.message-content .external-link:hover {
			color: var(--text-accent-hover);
		}
		
		.message-content .citation-link {
			color: var(--text-accent);
			text-decoration: none;
			font-weight: var(--font-weight-medium);
			cursor: pointer;
		}
		
		.message-content .citation-link:hover {
			background: var(--background-modifier-hover);
			border-radius: var(--radius-s);
			padding: 0 var(--size-2-1);
		}
		
		/* Responsive Design - Mobile adjustments */
		@media (max-width: 768px) {
			.title-container {
				flex-direction: column;
				align-items: stretch;
				gap: var(--size-2-2);
			}
			
			.provider-container {
				justify-content: center;
			}
			
			.message.user {
				margin-left: 5%;
			}
			
			.message.assistant {
				margin-right: 5%;
			}
			
			.message.system {
				margin: var(--size-2-2) 10%;
			}
			
			.research-mode-btn-small {
				min-width: calc(100% - var(--size-2-1)); /* Full width on very small screens */
			}
			
			.button-group {
				flex-direction: column;
			}
			
			.send-button, .save-button {
				flex: none;
			}
		}
		
		/* Animation for clearing chat */
		.clearing {
			opacity: 0;
			transform: translateY(-10px);
			transition: all 0.2s ease;
		}
		
		/* Focus visible for accessibility */
		.research-mode-btn-small:focus-visible,
		.new-chat-button:focus-visible,
		.copy-button:focus-visible,
		.send-button:focus-visible,
		.save-button:focus-visible {
			outline: 2px solid var(--interactive-accent);
			outline-offset: 2px;
		}
		`,s=document.createElement("style");s.textContent=e,document.head.appendChild(s)}},T=class extends p.ItemView{constructor(e,s){super(e);this.currentVideoContext=null;this.plugin=s}getViewType(){return A}getDisplayText(){return"AI Web Search Chat"}getIcon(){return"message-circle"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("gemini-chat-container");let s=e.createEl("div",{cls:"gemini-chat-header"}),n=s.createEl("div",{cls:"title-container"});n.createEl("h3",{text:"AI Web Search Chat"});let i=n.createEl("button",{cls:"new-chat-button",title:"Start a new conversation (Ctrl/Cmd + N)",attr:{"aria-label":"Start new chat conversation",role:"button"}});i.innerHTML=`
			<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
				<line x1="12" y1="8" x2="12" y2="16"></line>
				<line x1="8" y1="12" x2="16" y2="12"></line>
			</svg>
			<span>New Chat</span>
		`,i.addEventListener("click",()=>{this.clearChat()}),this.containerEl.addEventListener("keydown",g=>{(g.ctrlKey||g.metaKey)&&g.key==="n"&&!g.shiftKey&&!g.altKey&&(g.preventDefault(),this.clearChat())});let r=s.createEl("div",{cls:"provider-container"});r.createEl("span",{text:"Provider: ",cls:"provider-label"});let c=r.createEl("select",{cls:"provider-dropdown"}),o=c.createEl("option",{value:"gemini",text:`Google Gemini ${this.checkApiKey("gemini")?"\u2713":"\u26A0\uFE0F"}`}),t=c.createEl("option",{value:"perplexity",text:`Perplexity AI ${this.checkApiKey("perplexity")?"\u2713":"\u26A0\uFE0F"}`}),a=c.createEl("option",{value:"tavily",text:`Tavily Search ${this.checkApiKey("tavily")?"\u2713":"\u26A0\uFE0F"}`}),l=c.createEl("option",{value:"exa",text:`Exa AI Search ${this.checkApiKey("exa")?"\u2713":"\u26A0\uFE0F"}`});c.value=this.plugin.settings.provider,this.messageContainer=e.createEl("div",{cls:"gemini-chat-messages"}),this.inputContainer=e.createEl("div",{cls:"gemini-chat-input-container"}),this.createInputArea(),this.currentResearchMode={id:"comprehensive",label:"\u{1F50D} Comprehensive",description:"Balanced research with detailed analysis",model:"gemini-2.5-flash",perplexityModel:"sonar-pro",exaSearchType:"auto",exaCategory:""},this.checkApiKey(this.plugin.settings.provider)?this.addMessage("system",`Welcome! Ask me anything and I'll search the web for you using ${this.plugin.settings.provider}.`):this.addMessage("system",`\u26A0\uFE0F Welcome! Please configure your ${this.plugin.settings.provider} API key in plugin settings before starting.`)}createInputArea(){var l;this.inputContainer.empty();let e=this.inputContainer.createEl("div",{cls:"input-group"}),s=e.createEl("textarea",{cls:"gemini-chat-input",attr:{placeholder:"Ask anything...",rows:"3"}}),n=e.createEl("div",{cls:"button-group"}),i=n.createEl("button",{cls:"send-button",text:"Send"}),r=n.createEl("button",{cls:"save-button",text:"Send & Save",attr:{title:"Send query and save chat to folder"}}),c=this.inputContainer.createEl("div",{cls:"research-mode-container-bottom"});c.createEl("div",{text:"Research Mode:",cls:"research-mode-label-small"});let o=c.createEl("div",{cls:"research-mode-buttons-bottom"});[{id:"quick",label:"\u26A1 Quick",description:"Fast answers",model:"gemini-2.5-flash-lite",perplexityModel:"sonar",exaSearchType:"fast",exaCategory:""},{id:"comprehensive",label:"\u{1F50D} Comprehensive",description:"Balanced research",model:"gemini-2.5-flash",perplexityModel:"sonar-pro",exaSearchType:"auto",exaCategory:""},{id:"deep",label:"\u{1F3AF} Deep",description:"Expert analysis",model:"gemini-2.5-pro",perplexityModel:"sonar-deep-research",exaSearchType:"neural",exaCategory:"research paper"},{id:"reasoning",label:"\u{1F9E0} Reasoning",description:"Complex analysis",model:"gemini-2.5-pro",perplexityModel:"sonar-reasoning",exaSearchType:"neural",exaCategory:"research paper"},{id:"youtube",label:"\u{1F3AC} YouTube",description:"Video analysis",model:"gemini-2.5-pro",perplexityModel:"sonar-pro",exaSearchType:"auto",exaCategory:"",providerLock:"gemini",requiresUrl:!0}].forEach(d=>{let g=o.createEl("button",{cls:`research-mode-btn-small research-mode-${d.id}`,attr:{"data-mode":d.id},text:d.label});g.addEventListener("click",()=>{this.setResearchMode(d),o.querySelectorAll(".research-mode-btn-small").forEach(m=>m.removeClass("active")),g.addClass("active")})}),(l=o.querySelector('[data-mode="comprehensive"]'))==null||l.addClass("active"),i.onclick=()=>this.handleSend(s.value,!1),r.onclick=()=>this.handleSend(s.value,!1,!0);let a=()=>{s.style.height="auto",s.style.height=Math.min(s.scrollHeight,200)+"px"};s.addEventListener("input",a),s.addEventListener("keydown",d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),this.handleSend(s.value,!1))}),a()}async handleSend(e,s,n=!1){var g,u;if(!e.trim())return;let i=this.inputContainer.querySelector(".gemini-chat-input"),r=this.inputContainer.querySelector(".send-button"),c=this.inputContainer.querySelector(".save-button"),o=i.value;i.value="",i.disabled=!0,r.disabled=!0,c.disabled=!0,this.addMessage("user",e);let t=this.plugin.settings.provider,a=(u=(g=this.plugin.settings.providerSearchModes)==null?void 0:g[t])!=null?u:!0,l="Thinking...";a?l=`Searching the web with ${t}...`:l=`Chatting with ${t}...`;let d=this.addMessage("assistant",l,!0);try{let m;a?m=await this.plugin.performWebSearch(e):t==="gemini"?m=await this.plugin.performGeminiChat(e,this.getChatHistory()):t==="perplexity"?m=await this.plugin.performPerplexityChat(e,this.getChatHistory()):m=await this.plugin.performWebSearch(e),this.updateMessage(d,m),s&&this.insertToActiveNote(m),n&&this.plugin.settings.chatSaveEnabled&&await this.saveToFolder()}catch(m){let h=`\u274C Error: ${m instanceof Error?m.message:String(m)}`;this.updateMessage(d,h),i.value=o}finally{i.disabled=!1,r.disabled=!1,c.disabled=!1,i.focus()}}getChatHistory(){if(!this.plugin.settings.contextMemoryEnabled)return[];let e=[];switch(this.messageContainer.querySelectorAll(".chat-message").forEach(n=>{var c;let i=n.getAttribute("data-role"),r=((c=n.querySelector(".message-content"))==null?void 0:c.textContent)||"";i&&r&&i!=="system"&&!r.includes("Searching the web...")&&!r.includes("Thinking...")&&!r.includes("Analyzing YouTube video...")&&e.push({role:i==="user"?"user":"assistant",content:r})}),this.plugin.settings.contextMemoryStrategy){case"recent":return e.slice(-this.plugin.settings.maxContextMessages);case"token-limit":let n=this.plugin.settings.maxContextMessages*100,i=0,r=[];for(let c=e.length-1;c>=0;c--){let o=Math.ceil(e[c].content.length/4);if(i+o>n)break;i+=o,r.unshift(e[c])}return r;case"summary":return e.slice(-this.plugin.settings.maxContextMessages);default:return e.slice(-this.plugin.settings.maxContextMessages)}}setResearchMode(e){if(this.currentResearchMode=e,e.id==="youtube"){if(this.plugin.settings.provider!=="gemini"){this.plugin.settings.provider="gemini",this.plugin.saveSettings();let s=this.containerEl.querySelector(".provider-dropdown");s&&(s.value="gemini"),new p.Notice("\u{1F3AC} Switched to Gemini provider for YouTube video analysis")}this.plugin.settings.geminiModel="gemini-2.5-pro",this.plugin.saveSettings()}this.plugin.settings.provider==="gemini"?this.plugin.settings.geminiModel=e.model:this.plugin.settings.provider==="perplexity"?this.plugin.settings.perplexityModel=e.perplexityModel:this.plugin.settings.provider==="exa"&&(this.plugin.settings.exaSearchType=e.exaSearchType,this.plugin.settings.exaCategory=e.exaCategory),this.plugin.saveSettings(),this.addMessage("system",`Research mode set to ${e.label}: ${e.description}`)}addMessage(e,s,n=!1){let i=Date.now().toString(),r=this.messageContainer.createEl("div",{cls:`message ${e}`,attr:{"data-id":i,"data-role":e}});if(e==="user")r.createEl("div",{cls:"message-role",text:"You"});else if(e==="assistant"){let o=r.createEl("div",{cls:"message-role-header"});o.createEl("span",{cls:"message-role",text:"AI Assistant"});let t=o.createEl("button",{cls:"copy-button",text:"\u{1F4CB} Copy"});t.addEventListener("click",()=>{navigator.clipboard.writeText(s),t.textContent="\u2705 Copied!",setTimeout(()=>{t.textContent="\u{1F4CB} Copy"},2e3)})}let c=r.createEl("div",{cls:"message-content"});if(n){c.addClass("thinking");let a=c.createEl("div",{cls:"progress-container"}).createEl("div",{cls:"progress-bar"}).createEl("div",{cls:"progress-bar-fill"}),l=c.createEl("div",{cls:"thinking-text"});l.textContent=s;let d=0,g=setInterval(()=>{d+=Math.random()*15,d>=90&&(d=90,clearInterval(g)),a.style.width=`${d}%`},200);r.setAttribute("data-progress-interval",g.toString())}return c.addClass("selectable-text"),e==="assistant"&&!n?this.renderMarkdownContent(c,s):c.textContent=s,this.messageContainer.scrollTop=this.messageContainer.scrollHeight,i}updateMessage(e,s){let n=this.messageContainer.querySelector(`[data-id="${e}"]`);if(n){let i=n.getAttribute("data-progress-interval");i&&clearInterval(parseInt(i));let r=n.querySelector(".message-content");if(r){r.removeClass("thinking"),r.addClass("selectable-text");let c=r.querySelector(".progress-bar-fill");c?(c.style.width="100%",setTimeout(()=>{let t=r.querySelector(".progress-container");t&&t.remove();let a=r.querySelector(".thinking-text");a&&a.remove(),this.renderMarkdownContent(r,s),this.messageContainer.scrollTop=this.messageContainer.scrollHeight},300)):(this.renderMarkdownContent(r,s),this.messageContainer.scrollTop=this.messageContainer.scrollHeight);let o=n.querySelector(".copy-button");o&&(o.onclick=()=>{navigator.clipboard.writeText(s),o.textContent="\u2705 Copied!",setTimeout(()=>{o.textContent="\u{1F4CB} Copy"},2e3)})}}}insertToActiveNote(e){let s=this.app.workspace.getActiveViewOfType(p.MarkdownView);if(s){let n=s.editor,i=n.getCursor();n.replaceRange(`

${e}
`,i),new p.Notice("Response inserted to note")}else new p.Notice("No active note to insert into")}clearChat(){if(!(this.messageContainer&&this.messageContainer.children.length>1&&!confirm("Are you sure you want to start a new chat? This will clear the current conversation.")))if(this.messageContainer)this.messageContainer.addClass("clearing"),setTimeout(()=>{this.messageContainer.empty(),this.messageContainer.removeClass("clearing"),this.currentResearchMode={id:"comprehensive",label:"\u{1F50D} Comprehensive",description:"Balanced research with detailed analysis",model:"gemini-2.5-flash",perplexityModel:"sonar-pro",exaSearchType:"auto",exaCategory:""},this.containerEl.querySelectorAll(".research-mode-btn-small").forEach(r=>{r.removeClass("active"),r.getAttribute("data-mode")==="comprehensive"&&r.addClass("active")});let i=this.checkApiKey(this.plugin.settings.provider)?`\u{1F195} New conversation started! Ask me anything and I'll search the web for you using ${this.plugin.settings.provider}.`:`\u26A0\uFE0F New conversation started! Please configure your ${this.plugin.settings.provider} API key in plugin settings before starting.`;this.addMessage("system",i),setTimeout(()=>{let r=this.containerEl.querySelector(".gemini-chat-input");r&&(r.focus(),r.placeholder="Ask anything to start your new conversation...",setTimeout(()=>{r.placeholder="Ask anything..."},3e3))},100)},200);else{let s=this.containerEl.querySelector(".gemini-chat-input");s&&s.focus()}}checkApiKey(e){switch(e){case"gemini":return!!this.plugin.settings.geminiApiKey;case"perplexity":return!!this.plugin.settings.perplexityApiKey;case"tavily":return!!this.plugin.settings.tavilyApiKey;case"exa":return!!this.plugin.settings.exaApiKey;default:return!1}}renderMarkdownContent(e,s){e.empty();let n=s.split(`
`),i=e,r=!1,c=[];n.forEach(o=>{if(o.startsWith("```"))if(r){let a=e.createEl("pre").createEl("code");a.textContent=c.join(`
`),c=[],r=!1,i=e}else r=!0;else if(r)c.push(o);else if(o.startsWith("### ")){let t=e.createEl("h3");t.textContent=o.replace("### ",""),i=e}else if(o.startsWith("## ")){let t=e.createEl("h2");t.textContent=o.replace("## ",""),i=e}else if(o.startsWith("# ")){let t=e.createEl("h1");t.textContent=o.replace("# ",""),i=e}else if(o.startsWith("- ")||o.startsWith("* ")){i.tagName!=="UL"&&(i=e.createEl("ul"));let t=i.createEl("li");this.parseInlineMarkdown(t,o.replace(/^[*-] /,""))}else if(o.startsWith("**Sources:**")||o.startsWith("--- ")){if(o.startsWith("--- "))e.createEl("hr");else{let t=e.createEl("h4");t.textContent="Sources:"}i=e}else if(o.trim()==="")e.createEl("br"),i=e;else{i.tagName==="UL"&&(i=e);let t=e.createEl("p");this.parseInlineMarkdown(t,o)}})}parseInlineMarkdown(e,s){let n=s;n=n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),n=n.replace(/\*(.*?)\*/g,"<em>$1</em>"),n=n.replace(/`(.*?)`/g,"<code>$1</code>"),n=n.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="external-link">$1 \u{1F517}</a>'),n=n.replace(/(https?:\/\/[^\s<>"{}|\\^`[\]]+)/g,'<a href="$1" target="_blank" rel="noopener noreferrer" class="external-link">$1 \u{1F517}</a>'),n=n.replace(/\[(\d+)\]/g,`<a href="#citation-$1" class="citation-link" onclick="this.closest('.message-content').querySelector('h4:contains(Sources), strong:contains(Sources)')?.scrollIntoView({behavior: 'smooth', block: 'center'})">[$1]</a>`),e.innerHTML=n,e.querySelectorAll(".citation-link").forEach(r=>{r.addEventListener("click",c=>{c.preventDefault();let o=e.closest(".message-content");if(o){let t=Array.from(o.querySelectorAll("strong, h4")).find(a=>{var l;return(l=a.textContent)==null?void 0:l.includes("Sources")});t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.backgroundColor="var(--interactive-accent)",t.style.color="white",t.style.padding="8px",t.style.borderRadius="4px",t.style.transition="all 0.3s ease",setTimeout(()=>{t.style.backgroundColor="",t.style.color="",t.style.padding=""},2e3))}})})}async saveToFolder(){try{let e=this.plugin.settings.chatFolderName,s=this.app.vault;s.getAbstractFileByPath(e)||await s.createFolder(e);let i=new Date().toISOString().slice(0,19).replace(/[T:]/g,"-"),c=(this.getFirstUserMessage()||"chat").slice(0,50).replace(/[^\w\s-]/g,"").replace(/\s+/g,"-"),o;switch(this.plugin.settings.chatNoteTemplate){case"timestamp-query":o=`${i}-${c}`;break;case"query-timestamp":o=`${c}-${i}`;break;case"query-only":o=c;break;case"counter":o=`chat-${s.getMarkdownFiles().filter(u=>u.path.startsWith(e)&&u.basename.startsWith("chat-")).length+1}`;break;default:o=`${i}-${c}`}let t=`${o}.md`,a=1;for(;s.getAbstractFileByPath(`${e}/${t}`);)t=`${o}-${a}.md`,a++;let l=this.formatChatNote(),d=`${e}/${t}`;await s.create(d,l),new p.Notice(`Chat saved to: ${d}`)}catch(e){new p.Notice(`Failed to save chat: ${e instanceof Error?e.message:String(e)}`),console.error("Save to folder error:",e)}}formatChatNote(){let e=new Date().toLocaleString(),s=this.plugin.settings.provider,n=this.currentResearchMode,i=`# AI Web Search Chat

`;return i+=`**Date:** ${e}
`,i+=`**Provider:** ${s}
`,i+=`**Research Mode:** ${n}

`,i+=`---

`,this.messageContainer.querySelectorAll(".message").forEach(c=>{var a,l;let o=c.querySelector(".message-role"),t=c.querySelector(".message-content");if(o&&t){let d=(a=o.textContent)==null?void 0:a.trim(),g=((l=t.textContent)==null?void 0:l.trim())||"";d==="You"?i+=`## \u{1F64B} You

${g}

`:d==="AI Assistant"&&!g.includes("Searching the web...")&&(i+=`## \u{1F916} AI Assistant

${g}

`)}}),i+=`
---
*Generated by AI Web Search Plugin*`,i}getFirstUserMessage(){var s;let e=this.messageContainer.querySelectorAll(".message.user .message-content");return e.length>0&&((s=e[0].textContent)==null?void 0:s.trim())||""}isValidYouTubeUrl(e){return/^https?:\/\/(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/|v\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})(?:\S+)?$/.test(e.trim())}extractYouTubeVideoId(e){let s=e.match(/(?:youtube\.com\/(?:watch\?v=|embed\/|v\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return s?s[1]:null}clearVideoContext(){this.currentVideoContext=null,this.updateVideoContextUI()}setVideoContext(e,s,n){this.currentVideoContext={url:e,videoId:s,title:n,analyzed:!0},this.updateVideoContextUI()}updateVideoContextUI(){var e;!this.videoContextContainer||!this.videoContextTitle||(this.currentVideoContext&&((e=this.currentResearchMode)==null?void 0:e.id)==="youtube"?(this.videoContextContainer.style.display="block",this.videoContextTitle.textContent=this.currentVideoContext.title||`Video ${this.currentVideoContext.videoId}`):this.videoContextContainer.style.display="none")}getVideoContext(){return this.currentVideoContext}async onClose(){}},B=class{constructor(y,e){this.app=y,this.plugin=e}open(){new p.Notice("Search modal coming soon...")}},N=class extends p.PluginSettingTab{constructor(e,s){super(e,s);this.plugin=s}display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"AI Web Search Settings"}),new p.Setting(e).setName("AI Provider").setDesc("Choose your preferred AI provider").addDropdown(s=>s.addOption("gemini","Google Gemini").addOption("perplexity","Perplexity AI").addOption("tavily","Tavily").addOption("exa","Exa").setValue(this.plugin.settings.provider).onChange(async n=>{this.plugin.settings.provider=n,await this.plugin.saveSettings()})),new p.Setting(e).setName("Gemini API Key").setDesc("Enter your Google AI Studio API key").addText(s=>s.setPlaceholder("Enter API key").setValue(this.plugin.settings.geminiApiKey).onChange(async n=>{this.plugin.settings.geminiApiKey=n,await this.plugin.saveSettings()})),new p.Setting(e).setName("Perplexity API Key").setDesc("Enter your Perplexity API key").addText(s=>s.setPlaceholder("Enter API key").setValue(this.plugin.settings.perplexityApiKey).onChange(async n=>{this.plugin.settings.perplexityApiKey=n,await this.plugin.saveSettings()})),new p.Setting(e).setName("Tavily API Key").setDesc("Enter your Tavily API key").addText(s=>s.setPlaceholder("Enter API key").setValue(this.plugin.settings.tavilyApiKey).onChange(async n=>{this.plugin.settings.tavilyApiKey=n,await this.plugin.saveSettings()})),new p.Setting(e).setName("Exa API Key").setDesc("Enter your Exa API key").addText(s=>s.setPlaceholder("Enter API key").setValue(this.plugin.settings.exaApiKey).onChange(async n=>{this.plugin.settings.exaApiKey=n,await this.plugin.saveSettings()})),new p.Setting(e).setName("Insert Mode").setDesc("How to insert search results").addDropdown(s=>s.addOption("replace","Replace Selection").addOption("append","Append to Document").setValue(this.plugin.settings.insertMode).onChange(async n=>{this.plugin.settings.insertMode=n,await this.plugin.saveSettings()})),new p.Setting(e).setName("Max Results").setDesc("Maximum number of search results").addSlider(s=>s.setLimits(1,20,1).setValue(this.plugin.settings.maxResults).setDynamicTooltip().onChange(async n=>{this.plugin.settings.maxResults=n,await this.plugin.saveSettings()})),new p.Setting(e).setName("Include Images").setDesc("Include images in search results when supported").addToggle(s=>s.setValue(this.plugin.settings.includeImages).onChange(async n=>{this.plugin.settings.includeImages=n,await this.plugin.saveSettings()})),new p.Setting(e).setName("Show Advanced Settings").setDesc("Show provider-specific advanced configuration options").addToggle(s=>s.setValue(this.plugin.settings.uiPreferences.showAdvancedSettings).onChange(async n=>{this.plugin.settings.uiPreferences.showAdvancedSettings=n,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.uiPreferences.showAdvancedSettings){let s=e.createDiv("advanced-settings-container");s.createEl("h3",{text:"Advanced Provider Settings"});let n=s.createDiv("advanced-tabs-container"),i=s.createDiv("advanced-content"),r=[{id:"gemini",label:"Gemini",method:()=>this.addGeminiAdvancedSettings(i)},{id:"perplexity",label:"Perplexity",method:()=>this.addPerplexityAdvancedSettings(i)},{id:"tavily",label:"Tavily",method:()=>this.addTavilyAdvancedSettings(i)},{id:"exa",label:"Exa",method:()=>this.addExaAdvancedSettings(i)}];r.forEach((c,o)=>{let t=n.createEl("button",{text:c.label,cls:o===0?"advanced-tab active":"advanced-tab"});t.onclick=()=>{n.querySelectorAll(".advanced-tab").forEach(a=>a.removeClass("active")),t.addClass("active"),i.empty(),c.method()}}),r[0].method()}}addGeminiAdvancedSettings(e){e.createEl("h5",{text:"Gemini Advanced Parameters"}),e.createEl("p",{text:"Configure advanced Gemini model parameters for fine-tuned responses. These settings affect all research modes.",cls:"settings-help-text"}),new p.Setting(e).setName("Gemini Model").setDesc("Choose the Gemini model variant (affects cost and capabilities)").addDropdown(n=>n.addOption("gemini-2.5-pro","Gemini 2.5 Pro (Best quality, slower)").addOption("gemini-2.5-flash","Gemini 2.5 Flash (Balanced)").addOption("gemini-2.5-flash-lite","Gemini 2.5 Flash Lite (Fastest, lowest cost)").setValue(this.plugin.settings.geminiModel||"gemini-2.5-flash").onChange(async i=>{this.plugin.settings.geminiModel=i,["quick","comprehensive","deep","reasoning","youtube"].forEach(c=>{this.plugin.settings.researchModeConfigs[c]&&(this.plugin.settings.researchModeConfigs[c].geminiModel=i)}),await this.plugin.saveSettings()})),new p.Setting(e).setName("Temperature").setDesc("Controls randomness: 0.0 = focused, 2.0 = creative (Default: 0.7)").addSlider(n=>n.setLimits(0,200,5).setValue((this.plugin.settings.researchModeConfigs.comprehensive.geminiParams.temperature||.7)*100).setDynamicTooltip().onChange(async i=>{let r=i/100;["quick","comprehensive","deep","reasoning","youtube"].forEach(o=>{var t;(t=this.plugin.settings.researchModeConfigs[o])!=null&&t.geminiParams&&(this.plugin.settings.researchModeConfigs[o].geminiParams.temperature=r)}),await this.plugin.saveSettings()})),new p.Setting(e).setName("Top P (Nucleus Sampling)").setDesc("Cumulative probability cutoff: 0.1 = conservative, 1.0 = diverse (Default: 0.8)").addSlider(n=>n.setLimits(10,100,5).setValue((this.plugin.settings.researchModeConfigs.comprehensive.geminiParams.topP||.8)*100).setDynamicTooltip().onChange(async i=>{let r=i/100;["quick","comprehensive","deep","reasoning","youtube"].forEach(o=>{var t;(t=this.plugin.settings.researchModeConfigs[o])!=null&&t.geminiParams&&(this.plugin.settings.researchModeConfigs[o].geminiParams.topP=r)}),await this.plugin.saveSettings()})),new p.Setting(e).setName("Top K").setDesc("Limits vocabulary to top K tokens: 1 = restrictive, 100 = diverse (Default: 40)").addSlider(n=>n.setLimits(1,100,1).setValue(this.plugin.settings.researchModeConfigs.comprehensive.geminiParams.topK||40).setDynamicTooltip().onChange(async i=>{["quick","comprehensive","deep","reasoning","youtube"].forEach(c=>{var o;(o=this.plugin.settings.researchModeConfigs[c])!=null&&o.geminiParams&&(this.plugin.settings.researchModeConfigs[c].geminiParams.topK=i)}),await this.plugin.saveSettings()})),new p.Setting(e).setName("Max Output Tokens").setDesc("Maximum response length: 256 = short, 8192 = very long (Default: 2048)").addSlider(n=>n.setLimits(256,8192,256).setValue(this.plugin.settings.researchModeConfigs.comprehensive.geminiParams.maxOutputTokens||2048).setDynamicTooltip().onChange(async i=>{["quick","comprehensive","deep","reasoning","youtube"].forEach(c=>{var o;(o=this.plugin.settings.researchModeConfigs[c])!=null&&o.geminiParams&&(this.plugin.settings.researchModeConfigs[c].geminiParams.maxOutputTokens=i)}),await this.plugin.saveSettings()})),e.createEl("h6",{text:"Content Safety Settings"}),e.createEl("p",{text:"Configure content filtering levels for different harm categories.",cls:"settings-help-text"}),[{key:"harassment",name:"Harassment",desc:"Malicious comments targeting identity/protected attributes"},{key:"hateSpeech",name:"Hate Speech",desc:"Content that promotes hatred toward groups"},{key:"sexuallyExplicit",name:"Sexually Explicit",desc:"Contains sexual or erotic content"},{key:"dangerousContent",name:"Dangerous Content",desc:"Promotes harmful or illegal activities"}].forEach(n=>{new p.Setting(e).setName(n.name).setDesc(n.desc).addDropdown(i=>i.addOption("BLOCK_NONE","None - Allow all content").addOption("BLOCK_ONLY_HIGH","High - Block only high-confidence harmful content").addOption("BLOCK_MEDIUM_AND_ABOVE","Medium+ - Block medium and high harmful content (Default)").addOption("BLOCK_LOW_AND_ABOVE","Low+ - Block low, medium, and high harmful content").setValue(this.plugin.settings.researchModeConfigs.comprehensive.geminiSafety[n.key]||"BLOCK_MEDIUM_AND_ABOVE").onChange(async r=>{["quick","comprehensive","deep","reasoning","youtube"].forEach(o=>{var t;(t=this.plugin.settings.researchModeConfigs[o])!=null&&t.geminiSafety&&(this.plugin.settings.researchModeConfigs[o].geminiSafety[n.key]=r)}),await this.plugin.saveSettings()}))})}addPerplexityAdvancedSettings(e){e.createEl("h5",{text:"Perplexity Advanced Parameters"}),e.createEl("p",{text:"Control Perplexity search depth and response characteristics.",cls:"settings-help-text"}),new p.Setting(e).setName("Model").setDesc("Choose Perplexity AI model").addDropdown(b=>{b.addOption("llama-3.1-sonar-small-128k-online","Llama 3.1 Sonar Small (128k)").addOption("llama-3.1-sonar-large-128k-online","Llama 3.1 Sonar Large (128k)").addOption("llama-3.1-sonar-huge-128k-online","Llama 3.1 Sonar Huge (128k)").addOption("llama-3.1-70b-instruct","Llama 3.1 70B Instruct").addOption("llama-3.1-8b-instruct","Llama 3.1 8B Instruct").setValue(this.plugin.settings.perplexityModel||"llama-3.1-sonar-small-128k-online").onChange(async f=>{this.plugin.settings.perplexityModel=f,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].perplexityModel=f}),await this.plugin.saveSettings()})});let s=e.createEl("div",{cls:"setting-item"}),n=s.createEl("div",{cls:"setting-item-info"});n.createEl("div",{cls:"setting-item-name",text:"Temperature"});let i=n.createEl("div",{cls:"setting-item-description"}),r=this.plugin.settings.perplexityTemperature||.2;i.textContent=`Creativity level (0.0-2.0). Current: ${r}`,s.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"0",max:"2.0",step:"0.1",value:r.toString()}}).addEventListener("input",async b=>{let f=parseFloat(b.target.value);this.plugin.settings.perplexityTemperature=f,i.textContent=`Creativity level (0.0-2.0). Current: ${f}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].perplexityTemperature=f}),await this.plugin.saveSettings()});let t=e.createEl("div",{cls:"setting-item"}),a=t.createEl("div",{cls:"setting-item-info"});a.createEl("div",{cls:"setting-item-name",text:"Max Tokens"});let l=a.createEl("div",{cls:"setting-item-description"}),d=this.plugin.settings.perplexityMaxTokens||1024;l.textContent=`Maximum response length (256-4096). Current: ${d}`,t.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"256",max:"4096",step:"64",value:d.toString()}}).addEventListener("input",async b=>{let f=parseInt(b.target.value);this.plugin.settings.perplexityMaxTokens=f,l.textContent=`Maximum response length (256-4096). Current: ${f}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].perplexityMaxTokens=f}),await this.plugin.saveSettings()});let m=e.createEl("div",{cls:"setting-item"}),h=m.createEl("div",{cls:"setting-item-info"});h.createEl("div",{cls:"setting-item-name",text:"Top P"});let v=h.createEl("div",{cls:"setting-item-description"}),w=this.plugin.settings.perplexityTopP||1;v.textContent=`Nucleus sampling (0.1-1.0). Current: ${w}`,m.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"0.1",max:"1.0",step:"0.05",value:w.toString()}}).addEventListener("input",async b=>{let f=parseFloat(b.target.value);this.plugin.settings.perplexityTopP=f,v.textContent=`Nucleus sampling (0.1-1.0). Current: ${f}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].perplexityTopP=f}),await this.plugin.saveSettings()});let S=e.createEl("div",{cls:"setting-item"}),O=S.createEl("div",{cls:"setting-item-info"});O.createEl("div",{cls:"setting-item-name",text:"Top K"});let I=O.createEl("div",{cls:"setting-item-description"}),K=this.plugin.settings.perplexityTopK||0;I.textContent=`Vocabulary limitation (0-100). Current: ${K}`,S.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"0",max:"100",step:"5",value:K.toString()}}).addEventListener("input",async b=>{let f=parseInt(b.target.value);this.plugin.settings.perplexityTopK=f,I.textContent=`Vocabulary limitation (0-100, 0=disabled). Current: ${f}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].perplexityTopK=f}),await this.plugin.saveSettings()});let V=e.createEl("div",{cls:"setting-item"}),$=V.createEl("div",{cls:"setting-item-info"});$.createEl("div",{cls:"setting-item-name",text:"Frequency Penalty"});let H=$.createEl("div",{cls:"setting-item-description"}),q=this.plugin.settings.perplexityFrequencyPenalty||0;H.textContent=`Reduce repetition (-2.0 to 2.0). Current: ${q}`,V.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"-2.0",max:"2.0",step:"0.1",value:q.toString()}}).addEventListener("input",async b=>{let f=parseFloat(b.target.value);this.plugin.settings.perplexityFrequencyPenalty=f,H.textContent=`Reduce repetition (-2.0 to 2.0). Current: ${f}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].perplexityFrequencyPenalty=f}),await this.plugin.saveSettings()});let U=e.createEl("div",{cls:"setting-item"}),Y=U.createEl("div",{cls:"setting-item-info"});Y.createEl("div",{cls:"setting-item-name",text:"Presence Penalty"});let F=Y.createEl("div",{cls:"setting-item-description"}),z=this.plugin.settings.perplexityPresencePenalty||0;F.textContent=`Encourage new topics (-2.0 to 2.0). Current: ${z}`,U.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"-2.0",max:"2.0",step:"0.1",value:z.toString()}}).addEventListener("input",async b=>{let f=parseFloat(b.target.value);this.plugin.settings.perplexityPresencePenalty=f,F.textContent=`Encourage new topics (-2.0 to 2.0). Current: ${f}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].perplexityPresencePenalty=f}),await this.plugin.saveSettings()}),new p.Setting(e).setName("Return Citations").setDesc("Include source citations in responses").addToggle(b=>{var f;b.setValue((f=this.plugin.settings.perplexityReturnCitations)!=null?f:!0).onChange(async x=>{this.plugin.settings.perplexityReturnCitations=x,Object.keys(this.plugin.settings.researchModeConfigs).forEach(D=>{this.plugin.settings.researchModeConfigs[D].perplexityReturnCitations=x}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Return Images").setDesc("Include images in search results when available").addToggle(b=>{var f;b.setValue((f=this.plugin.settings.perplexityReturnImages)!=null?f:!1).onChange(async x=>{this.plugin.settings.perplexityReturnImages=x,Object.keys(this.plugin.settings.researchModeConfigs).forEach(D=>{this.plugin.settings.researchModeConfigs[D].perplexityReturnImages=x}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Return Related Questions").setDesc("Include suggested follow-up questions").addToggle(b=>{var f;b.setValue((f=this.plugin.settings.perplexityReturnRelated)!=null?f:!0).onChange(async x=>{this.plugin.settings.perplexityReturnRelated=x,Object.keys(this.plugin.settings.researchModeConfigs).forEach(D=>{this.plugin.settings.researchModeConfigs[D].perplexityReturnRelated=x}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Search Domain Time").setDesc("Time range for search results").addDropdown(b=>{b.addOption("","No time limit").addOption("hour","Past hour").addOption("day","Past day").addOption("week","Past week").addOption("month","Past month").addOption("year","Past year").setValue(this.plugin.settings.perplexitySearchDomainFilter||"").onChange(async f=>{this.plugin.settings.perplexitySearchDomainFilter=f,Object.keys(this.plugin.settings.researchModeConfigs).forEach(x=>{this.plugin.settings.researchModeConfigs[x].perplexitySearchDomainFilter=f}),await this.plugin.saveSettings()})})}addTavilyAdvancedSettings(e){e.createEl("h5",{text:"Tavily Advanced Parameters"}),e.createEl("p",{text:"Configure Tavily search depth and result filtering options.",cls:"settings-help-text"}),new p.Setting(e).setName("Search Depth").setDesc("Depth of search results to retrieve").addDropdown(m=>{m.addOption("basic","Basic - Fast results").addOption("advanced","Advanced - Comprehensive results").setValue(this.plugin.settings.tavilySearchDepth||"basic").onChange(async h=>{this.plugin.settings.tavilySearchDepth=h,Object.keys(this.plugin.settings.researchModeConfigs).forEach(v=>{this.plugin.settings.researchModeConfigs[v].tavilySearchDepth=h}),await this.plugin.saveSettings()})});let s=e.createEl("div",{cls:"setting-item"}),n=s.createEl("div",{cls:"setting-item-info"});n.createEl("div",{cls:"setting-item-name",text:"Max Results"});let i=n.createEl("div",{cls:"setting-item-description"}),r=this.plugin.settings.tavilyMaxResults||5;i.textContent=`Maximum number of results (1-20). Current: ${r}`,s.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"1",max:"20",step:"1",value:r.toString()}}).addEventListener("input",async m=>{let h=parseInt(m.target.value);this.plugin.settings.tavilyMaxResults=h,i.textContent=`Maximum number of results (1-20). Current: ${h}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(v=>{this.plugin.settings.researchModeConfigs[v].tavilyMaxResults=h}),await this.plugin.saveSettings()}),new p.Setting(e).setName("Include Domains").setDesc("Comma-separated list of domains to include (e.g., wikipedia.org, reddit.com)").addTextArea(m=>{m.setPlaceholder("Enter domains to include...").setValue(this.plugin.settings.tavilyIncludeDomains||"").onChange(async h=>{this.plugin.settings.tavilyIncludeDomains=h,Object.keys(this.plugin.settings.researchModeConfigs).forEach(v=>{this.plugin.settings.researchModeConfigs[v].tavilyIncludeDomains=h}),await this.plugin.saveSettings()}),m.inputEl.rows=2}),new p.Setting(e).setName("Exclude Domains").setDesc("Comma-separated list of domains to exclude (e.g., ads.com, spam.com)").addTextArea(m=>{m.setPlaceholder("Enter domains to exclude...").setValue(this.plugin.settings.tavilyExcludeDomains||"").onChange(async h=>{this.plugin.settings.tavilyExcludeDomains=h,Object.keys(this.plugin.settings.researchModeConfigs).forEach(v=>{this.plugin.settings.researchModeConfigs[v].tavilyExcludeDomains=h}),await this.plugin.saveSettings()}),m.inputEl.rows=2}),new p.Setting(e).setName("Include Answer").setDesc("Include a direct answer in addition to search results").addToggle(m=>{var h;m.setValue((h=this.plugin.settings.tavilyIncludeAnswer)!=null?h:!0).onChange(async v=>{this.plugin.settings.tavilyIncludeAnswer=v,Object.keys(this.plugin.settings.researchModeConfigs).forEach(w=>{this.plugin.settings.researchModeConfigs[w].tavilyIncludeAnswer=v}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Include Raw Content").setDesc("Include the raw HTML content of search results").addToggle(m=>{var h;m.setValue((h=this.plugin.settings.tavilyIncludeRawContent)!=null?h:!1).onChange(async v=>{this.plugin.settings.tavilyIncludeRawContent=v,Object.keys(this.plugin.settings.researchModeConfigs).forEach(w=>{this.plugin.settings.researchModeConfigs[w].tavilyIncludeRawContent=v}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Include Images").setDesc("Include images in search results when available").addToggle(m=>{var h;m.setValue((h=this.plugin.settings.tavilyIncludeImages)!=null?h:!1).onChange(async v=>{this.plugin.settings.tavilyIncludeImages=v,Object.keys(this.plugin.settings.researchModeConfigs).forEach(w=>{this.plugin.settings.researchModeConfigs[w].tavilyIncludeImages=v}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Topic").setDesc("Topic category for search context (general, news, etc.)").addDropdown(m=>{m.addOption("general","General").addOption("news","News").addOption("science","Science").addOption("technology","Technology").addOption("business","Business").addOption("health","Health").addOption("entertainment","Entertainment").addOption("sports","Sports").setValue(this.plugin.settings.tavilyTopic||"general").onChange(async h=>{this.plugin.settings.tavilyTopic=h,Object.keys(this.plugin.settings.researchModeConfigs).forEach(v=>{this.plugin.settings.researchModeConfigs[v].tavilyTopic=h}),await this.plugin.saveSettings()})});let t=e.createEl("div",{cls:"setting-item"}),a=t.createEl("div",{cls:"setting-item-info"});a.createEl("div",{cls:"setting-item-name",text:"Recent Content Days"});let l=a.createEl("div",{cls:"setting-item-description"}),d=this.plugin.settings.tavilyDays||0;l.textContent=`Limit to content from last N days (0=no limit). Current: ${d}`,t.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"0",max:"365",step:"1",value:d.toString()}}).addEventListener("input",async m=>{let h=parseInt(m.target.value);this.plugin.settings.tavilyDays=h,l.textContent=`Limit to content from last N days (0=no limit). Current: ${h}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(v=>{this.plugin.settings.researchModeConfigs[v].tavilyDays=h}),await this.plugin.saveSettings()})}addExaAdvancedSettings(e){e.createEl("h5",{text:"Exa Neural Search Advanced Parameters"}),e.createEl("p",{text:"Exa offers the most customization options for semantic search and content filtering.",cls:"settings-help-text"}),new p.Setting(e).setName("Search Type").setDesc("Type of search to perform").addDropdown(t=>{t.addOption("neural","Neural - Semantic understanding").addOption("keyword","Keyword - Traditional search").addOption("auto","Auto - Best of both").setValue(this.plugin.settings.exaSearchType||"neural").onChange(async a=>{this.plugin.settings.exaSearchType=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaSearchType=a}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Use Autoprompt").setDesc("Automatically enhance queries for better results").addToggle(t=>{var a;t.setValue((a=this.plugin.settings.exaUseAutoprompt)!=null?a:!0).onChange(async l=>{this.plugin.settings.exaUseAutoprompt=l,Object.keys(this.plugin.settings.researchModeConfigs).forEach(d=>{this.plugin.settings.researchModeConfigs[d].exaUseAutoprompt=l}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Category").setDesc("Content category to focus search on").addDropdown(t=>{t.addOption("","Any category").addOption("company","Company").addOption("research paper","Research Paper").addOption("news","News").addOption("github","GitHub").addOption("tweet","Tweet").addOption("movie","Movie").addOption("song","Song").addOption("personal site","Personal Site").addOption("pdf","PDF Document").setValue(this.plugin.settings.exaCategory||"").onChange(async a=>{this.plugin.settings.exaCategory=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaCategory=a}),await this.plugin.saveSettings()})});let s=e.createEl("div",{cls:"setting-item"}),n=s.createEl("div",{cls:"setting-item-info"});n.createEl("div",{cls:"setting-item-name",text:"Number of Results"});let i=n.createEl("div",{cls:"setting-item-description"}),r=this.plugin.settings.exaNumResults||10;i.textContent=`Number of results to return (1-20). Current: ${r}`,s.createEl("div",{cls:"setting-item-control"}).createEl("input",{type:"range",cls:"slider",attr:{min:"1",max:"20",step:"1",value:r.toString()}}).addEventListener("input",async t=>{let a=parseInt(t.target.value);this.plugin.settings.exaNumResults=a,i.textContent=`Number of results to return (1-20). Current: ${a}`,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaNumResults=a}),await this.plugin.saveSettings()}),new p.Setting(e).setName("Include Domains").setDesc("Comma-separated list of domains to include (e.g., wikipedia.org, arxiv.org)").addTextArea(t=>{t.setPlaceholder("Enter domains to include...").setValue(this.plugin.settings.exaIncludeDomains||"").onChange(async a=>{this.plugin.settings.exaIncludeDomains=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaIncludeDomains=a}),await this.plugin.saveSettings()}),t.inputEl.rows=2}),new p.Setting(e).setName("Exclude Domains").setDesc("Comma-separated list of domains to exclude (e.g., pinterest.com, quora.com)").addTextArea(t=>{t.setPlaceholder("Enter domains to exclude...").setValue(this.plugin.settings.exaExcludeDomains||"").onChange(async a=>{this.plugin.settings.exaExcludeDomains=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaExcludeDomains=a}),await this.plugin.saveSettings()}),t.inputEl.rows=2}),new p.Setting(e).setName("Start Crawl Date").setDesc("Only include results crawled after this date (YYYY-MM-DD format)").addText(t=>{t.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.exaStartCrawlDate||"").onChange(async a=>{this.plugin.settings.exaStartCrawlDate=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaStartCrawlDate=a}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("End Crawl Date").setDesc("Only include results crawled before this date (YYYY-MM-DD format)").addText(t=>{t.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.exaEndCrawlDate||"").onChange(async a=>{this.plugin.settings.exaEndCrawlDate=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaEndCrawlDate=a}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Start Published Date").setDesc("Only include results published after this date (YYYY-MM-DD format)").addText(t=>{t.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.exaStartPublishedDate||"").onChange(async a=>{this.plugin.settings.exaStartPublishedDate=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaStartPublishedDate=a}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("End Published Date").setDesc("Only include results published before this date (YYYY-MM-DD format)").addText(t=>{t.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.exaEndPublishedDate||"").onChange(async a=>{this.plugin.settings.exaEndPublishedDate=a,Object.keys(this.plugin.settings.researchModeConfigs).forEach(l=>{this.plugin.settings.researchModeConfigs[l].exaEndPublishedDate=a}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Include Text").setDesc("Include the text content of search results").addToggle(t=>{var a;t.setValue((a=this.plugin.settings.exaIncludeText)!=null?a:!0).onChange(async l=>{this.plugin.settings.exaIncludeText=l,Object.keys(this.plugin.settings.researchModeConfigs).forEach(d=>{this.plugin.settings.researchModeConfigs[d].exaIncludeText=l}),await this.plugin.saveSettings()})}),new p.Setting(e).setName("Include Highlights").setDesc("Include highlighted relevant excerpts from results").addToggle(t=>{var a;t.setValue((a=this.plugin.settings.exaIncludeHighlights)!=null?a:!0).onChange(async l=>{this.plugin.settings.exaIncludeHighlights=l,Object.keys(this.plugin.settings.researchModeConfigs).forEach(d=>{this.plugin.settings.researchModeConfigs[d].exaIncludeHighlights=l}),await this.plugin.saveSettings()})})}};
